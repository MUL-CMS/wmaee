<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>wmaee.codes.pyiron.pyiron_GRACE_job API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../../../index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;
                Module Index
            </a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Grace">Grace</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Grace.__init__">Grace</a>
                        </li>
                        <li>
                                <a class="variable" href="#Grace.structure">structure</a>
                        </li>
                        <li>
                                <a class="variable" href="#Grace.input">input</a>
                        </li>
                        <li>
                                <a class="variable" href="#Grace.fmax">fmax</a>
                        </li>
                        <li>
                                <a class="variable" href="#Grace.max_iter">max_iter</a>
                        </li>
                        <li>
                                <a class="variable" href="#Grace.model">model</a>
                        </li>
                        <li>
                                <a class="function" href="#Grace.available_models">available_models</a>
                        </li>
                        <li>
                                <a class="function" href="#Grace.calc_static">calc_static</a>
                        </li>
                        <li>
                                <a class="function" href="#Grace.calc_minimize">calc_minimize</a>
                        </li>
                        <li>
                                <a class="function" href="#Grace.calc_md">calc_md</a>
                        </li>
                        <li>
                                <a class="function" href="#Grace.write_input">write_input</a>
                        </li>
                        <li>
                                <a class="function" href="#Grace.collect_output">collect_output</a>
                        </li>
                        <li>
                                <a class="function" href="#Grace.get_structure">get_structure</a>
                        </li>
                        <li>
                                <a class="function" href="#Grace.compress">compress</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CalcParams">CalcParams</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CalcParams.__init__">CalcParams</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
wmaee<wbr>.codes<wbr>.pyiron<wbr>.pyiron_GRACE_job    </h1>

                
                        <input id="mod-pyiron_GRACE_job-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-pyiron_GRACE_job-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># Metadata</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;David Holec, Amin Sakic&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;David Holec&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;david.holec@unileoben.ac.at&quot;</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;2025-08-03&quot;</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.11&quot;</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">pyiron_atomistics.atomistics.job.atomistic</span><span class="w"> </span><span class="kn">import</span> <span class="n">AtomisticGenericJob</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">pyiron_atomistics</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyiron_to_ase</span><span class="p">,</span> <span class="n">ase_to_pyiron</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">pyiron_base</span><span class="w"> </span><span class="kn">import</span> <span class="n">GenericParameters</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="c1"># from tensorpotential.calculator import grace_fm</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="c1"># from tensorpotential.calculator import TPCalculator</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">ase</span><span class="w"> </span><span class="kn">import</span> <span class="n">Atoms</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">ase.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">write</span><span class="p">,</span> <span class="n">read</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">ase.io.trajectory</span><span class="w"> </span><span class="kn">import</span> <span class="n">Trajectory</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">ase.constraints</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExpCellFilter</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">wmaee.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">EV_PER_ANG3_TO_GPA</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="n">_grace_models</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>    <span class="s2">&quot;GRACE-1L-MP-r6&quot;</span><span class="p">,</span> <span class="s2">&quot;GRACE-2L-MP-r5&quot;</span><span class="p">,</span> <span class="s2">&quot;GRACE-2L-MP-r6&quot;</span><span class="p">,</span> <span class="s2">&quot;GRACE-FS-OAM&quot;</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>    <span class="s2">&quot;GRACE-FS-OAM&quot;</span><span class="p">,</span> <span class="s2">&quot;GRACE-1L-OAM&quot;</span><span class="p">,</span> <span class="s2">&quot;GRACE-2L-OAM&quot;</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>    <span class="s2">&quot;GRACE-FS-OMAT&quot;</span><span class="p">,</span> <span class="s2">&quot;GRACE-1L-OMAT&quot;</span><span class="p">,</span> <span class="s2">&quot;GRACE-2L-OMAT&quot;</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="s2">&quot;GRACE-1L-OMAT-medium-base&quot;</span><span class="p">,</span> <span class="s2">&quot;GRACE-1L-OMAT-medium-ft-E&quot;</span><span class="p">,</span> <span class="s2">&quot;GRACE-1L-OMAT-large-base&quot;</span><span class="p">,</span> <span class="s2">&quot;GRACE-1L-OMAT-large-ft-E&quot;</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>    <span class="s2">&quot;GRACE-2L-OMAT-medium-base&quot;</span><span class="p">,</span> <span class="s2">&quot;GRACE-2L-OMAT-medium-ft-E&quot;</span><span class="p">,</span> <span class="s2">&quot;GRACE-2L-OMAT-large-base&quot;</span><span class="p">,</span> <span class="s2">&quot;GRACE-2L-OMAT-large-ft-E&quot;</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="p">]</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Grace</span><span class="p">(</span><span class="n">AtomisticGenericJob</span><span class="p">):</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    Custom job class for using Grace within the pyiron framework.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    This class provides methods to perform static calculations, structure relaxation,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    and molecular dynamics simulations using Grace UMLIPs.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    Attributes</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    ----------</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    structure : pyiron.atomistics.structure.atoms.Atoms</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        Structure associated with the job.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    input : CalcParams</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">        Input parameters for the Grace calculations.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">job_name</span><span class="p">):</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        Initialize the Grace job.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        Parameters</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">        ----------</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">        project : pyiron.Project</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">            The pyiron project in which the job resides.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        job_name : str</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">            Name of the job.</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Grace</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">job_name</span><span class="p">)</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">CalcParams</span><span class="p">()</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">file_exists</span><span class="p">:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="c1"># executable is in pyiron_resources/grace/bin</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_executable_activate</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s1">&#39;grace&#39;</span><span class="p">)</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="nd">@property</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fmax</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        Maximum force tolerance for ionic relaxation.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">        This property controls the maximum force tolerance (in eV/Å) used during ionic relaxation.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">        Returns</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        -------</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        float</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">            Maximum force tolerance (eV/Å).</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;ionic_force_tolerance&#39;</span><span class="p">]</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="nd">@fmax</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmax</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        Set the maximum force tolerance for ionic relaxation.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        Parameters</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">        ----------</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        fmax : float</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">            Maximum force tolerance (eV/Å).</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;ionic_force_tolerance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmax</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>    <span class="nd">@property</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">max_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        Get the maximum number of iterations for relaxation or MD run.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">        Returns</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        -------</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        int</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">            Maximum number of iterations.</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>    <span class="nd">@max_iter</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">max_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        Set the maximum number of iterations for relaxation or MD run.</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">        Parameters</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">        ----------</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        max_iter : int</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">            Maximum number of iterations.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_iter</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="nd">@property</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">        Return the current GRACE model.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">    </span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">        Returns</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        -------</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">        str</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">            The selected GRACE model name.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>    <span class="nd">@model</span><span class="o">.</span><span class="n">setter</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        Set the GRACE model name.</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">    </span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">        Parameters</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">        ----------</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">        model : str</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">            Name of the GRACE model to use. Must be one of the supported</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">            GRACE model identifiers:</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">    </span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">            - &quot;GRACE-1L-MP-r6&quot;</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">            - &quot;GRACE-2L-MP-r5&quot;</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">            - &quot;GRACE-2L-MP-r6&quot;</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">            - &quot;GRACE-FS-OAM&quot;</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">            - &quot;GRACE-1L-OAM&quot;</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">            - &quot;GRACE-2L-OAM&quot;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">            - &quot;GRACE-FS-OMAT&quot;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">            - &quot;GRACE-1L-OMAT&quot;</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">            - &quot;GRACE-2L-OMAT&quot;</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">            - &quot;GRACE-1L-OMAT-medium-base&quot;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">            - &quot;GRACE-1L-OMAT-medium-ft-E&quot;</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">            - &quot;GRACE-1L-OMAT-large-base&quot;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">            - &quot;GRACE-1L-OMAT-large-ft-E&quot;</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">            - &quot;GRACE-2L-OMAT-medium-base&quot;</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">            - &quot;GRACE-2L-OMAT-medium-ft-E&quot;</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">            - &quot;GRACE-2L-OMAT-large-base&quot;</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">            - &quot;GRACE-2L-OMAT-large-ft-E&quot;</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">    </span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">        Raises</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        ------</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">        ValueError</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">            If `model` is not a valid GRACE model identifier.</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="k">if</span> <span class="n">model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_grace_models</span><span class="p">:</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown grace model: </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">available_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">        Return the list of supported GRACE models.</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">    </span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        Returns</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">        -------</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">        list of str</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">            All valid GRACE model identifiers.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="k">return</span> <span class="n">_grace_models</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>    
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>    <span class="c1">####################################################</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>    <span class="c1">### --- IMPLEMENTATION OF STATIC CALCULATION --- ###</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>    <span class="c1">####################################################</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_static</span><span class="p">(</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="n">grace_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="o">*</span><span class="n">_grace_models</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GRACE-2L-OMAT&quot;</span><span class="p">,</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>    <span class="p">):</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">        Perform a static calculation.</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">    </span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">        Parameters</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">        ----------</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        grace_model : Literal[*_grace_models], optional</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">            GRACE model to use for the relaxation.  </span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">            Must be one of the supported models, which can be obtained via </span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">            :meth:`available_models`. Default is ``&quot;GRACE-2L-OMAT&quot;``.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">    </span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">        Raises</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">        ------</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">        ValueError</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">            If the structure has not been set before calling this method.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">    </span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        Notes</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">        -----</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">        This method configures the GRACE calculator for a static calculation</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">        using the provided GRACE model.  </span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">        A structure must be assigned to the instance prior to calling</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        ``calc_static``.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">    </span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        Returns</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        -------</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">        None</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>                <span class="s1">&#39;Structure must be set before calling calc_static().&#39;</span><span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">grace_model</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_write_calc_static</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">        Write the calculation script for performing static calculations.</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">        This method generates a Python script that uses Grace for static calculations</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">        and writes it to a file in the working directory.</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="n">script</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>            <span class="s1">&#39;from tensorpotential.calculator import grace_fm&#39;</span><span class="p">,</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>            <span class="s1">&#39;from ase.io import read&#39;</span><span class="p">,</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>            <span class="s1">&#39;from ase.io.cif import write_cif&#39;</span><span class="p">,</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>            <span class="s1">&#39;initial_structure = read(&quot;structure.cif&quot;)&#39;</span><span class="p">,</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="sa">f</span><span class="s1">&#39;initial_structure.calc = grace_fm(&quot;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&quot;)&#39;</span><span class="p">,</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>            <span class="s1">&#39;# perform the static calculation&#39;</span><span class="p">,</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>            <span class="s1">&#39;energy_pot = initial_structure.get_total_energy()&#39;</span><span class="p">,</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="s1">&#39;forces = initial_structure.get_forces()&#39;</span><span class="p">,</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="s1">&#39;stresses = initial_structure.get_stress()&#39;</span><span class="p">,</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>            <span class="s1">&#39;# write the results to an output file&#39;</span><span class="p">,</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>            <span class="s1">&#39;with open(&quot;log.out&quot;, &quot;w&quot;) as f:&#39;</span><span class="p">,</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="s1">&#39;    f.write(&quot;step</span><span class="se">\t</span><span class="s1">energy_pot</span><span class="se">\t</span><span class="s1">forces</span><span class="se">\t</span><span class="s1">stresses</span><span class="se">\\</span><span class="s1">n&quot;)&#39;</span><span class="p">,</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>            <span class="s1">&#39;    f.write(f&quot;1</span><span class="se">\\</span><span class="s1">t</span><span class="si">{energy_pot}</span><span class="se">\\</span><span class="s1">t{forces.tolist()}</span><span class="se">\\</span><span class="s1">t{stresses.tolist()}</span><span class="se">\\</span><span class="s1">n&quot;)&#39;</span><span class="p">,</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>            <span class="s1">&#39;# write the final structure to a CIF file&#39;</span><span class="p">,</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="s1">&#39;write_cif(&quot;final_structure.cif&quot;, initial_structure)&#39;</span><span class="p">,</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="p">]</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s1">&#39;calc_script.py&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">script</span><span class="p">))</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_calc_static</span><span class="p">(</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;log.out&#39;</span><span class="p">,</span> 
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">        Parse the output of a static calculation and return optimization results.</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">    </span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">        This method reads a static calculation output file and extracts the </span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">        optimization steps and energy information, returning them as a DataFrame.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">    </span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">        Parameters</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">        ----------</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">        output : str, optional</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">            Name of the output file to parse. Default is &#39;log.out&#39;.</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">        skip : int, optional</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">            Number of rows to skip at the start of the file before parsing. Default is 0.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">    </span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        Returns</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">        -------</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">        pd.DataFrame or None</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">            A DataFrame containing the optimization results if parsing succeeds,</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">            otherwise None.</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">output</span><span class="p">),</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>                <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\t+&quot;</span><span class="p">,</span> 
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>            <span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="c1"># convert strings to np.array</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stresses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot parse output from </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1"> file.&#39;</span><span class="p">)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>            <span class="k">return</span> <span class="kc">None</span>        
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>    
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>    <span class="c1">##########################################################</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="c1">### --- IMPLEMENTATION OF MINIMIZATION CALCULATION --- ###</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>    <span class="c1">##########################################################</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>    
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_minimize</span><span class="p">(</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="n">grace_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="o">*</span><span class="n">_grace_models</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GRACE-2L-OMAT&quot;</span><span class="p">,</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>        <span class="n">algorithm</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;FIRE&quot;</span><span class="p">,</span> <span class="s2">&quot;BFGS&quot;</span><span class="p">,</span> <span class="s2">&quot;LBFGS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;FIRE&quot;</span><span class="p">,</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="n">algorithm_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="n">relax_cell</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        <span class="n">relax_cell_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>        <span class="n">ionic_force_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>        <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="n">n_print</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;relax.traj&quot;</span><span class="p">,</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">        Perform a structure relaxation (geometry optimization).</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">    </span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">        Parameters</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">        ----------</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">        grace_model : Literal[*_grace_models], optional</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">            GRACE model to use for the relaxation.  </span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">            Must be one of the supported models, which can be obtained via </span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">            :meth:`available_models`. Default is ``&quot;GRACE-2L-OMAT&quot;``.</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">    </span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">        algorithm : {&quot;FIRE&quot;, &quot;BFGS&quot;, &quot;LBFGS&quot;}, optional</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">            Ionic relaxation algorithm from ASE.  </span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">            Default is ``&quot;FIRE&quot;``.</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">    </span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        algorithm_kwargs : dict, optional</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">            Additional keyword arguments passed to the relaxation algorithm.  </span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">            Default is ``None``.</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">    </span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">        relax_cell : bool, optional</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">            If ``True``, optimize the simulation cell in addition to ionic positions.  </span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">            Default is ``False``.</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">    </span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">        relax_cell_kwargs : dict, optional</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">            Additional keyword arguments for cell relaxation.  </span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">            Default is ``None``.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">    </span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="sd">        ionic_force_tolerance : float, optional</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">            Force convergence criterion in eV/Å.  </span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">            Default is ``0.001``.</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">    </span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">        max_iter : int, optional</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">            Maximum number of optimization steps.  </span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">            Default is ``500``.</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">    </span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">        n_print : int, optional</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="sd">            Logging frequency for structures and stresses.  </span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">            Default is ``1``.</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">    </span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">        save_path : str or None, optional</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">            Path to save the relaxation trajectory.  </span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">            If ``None``, no trajectory is written.  </span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">            Default is ``&quot;relax.traj&quot;``.</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">    </span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">        Returns</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">        -------</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">        None</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">calc_minimize</span><span class="p">(</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>            <span class="n">ionic_energy_tolerance</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>            <span class="n">ionic_force_tolerance</span><span class="o">=</span><span class="n">ionic_force_tolerance</span><span class="p">,</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>            <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="p">)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="c1"># Saving the parameters in dictionary</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;minimize&#39;</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grace_model</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;algo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">algorithm</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;algo_kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">algorithm_kwargs</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;relax_cell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relax_cell</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;relax_cell_kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relax_cell_kwargs</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;ionic_force_tolerance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ionic_force_tolerance</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;n_print&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_print</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_iter</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">save_path</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>    
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_write_calc_minimize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        Write the calculation script for performing structure relaxation.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        This method generates a Python script that uses Grace for structure</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        relaxation and writes it to a file in the working directory.</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="c1"># Grace model</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="n">algo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;algo&#39;</span><span class="p">,</span> <span class="s1">&#39;FIRE&#39;</span><span class="p">)</span> <span class="c1"># ASE optimizer</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="k">if</span> <span class="n">algo</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;FIRE&#39;</span><span class="p">,</span> <span class="s1">&#39;BFGS&#39;</span><span class="p">,</span> <span class="s1">&#39;LBFGS&#39;</span><span class="p">]:</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>                <span class="sa">f</span><span class="s2">&quot;Unsupported optimizer: </span><span class="si">{</span><span class="n">algo</span><span class="si">}</span><span class="s2">. Supported optimizers are: FIRE, BFGS, LBFGS.&quot;</span><span class="p">)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>        <span class="c1"># ASE optimizer kwargs</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="n">algo_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;algo_kwargs&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>        <span class="n">save_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="s1">&#39;relax.traj&#39;</span><span class="p">)</span> <span class="c1"># Add trajectory parameter</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="n">algo_kwargs</span><span class="p">[</span><span class="s1">&#39;trajectory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="n">algo_kwargs</span><span class="p">[</span><span class="s1">&#39;loginterval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;n_print&#39;</span><span class="p">]</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>        <span class="c1"># Reformat dictionary to string</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="n">algo_kwargs_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">algo_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="c1"># Cell relaxation</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="n">relax_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;relax_cell&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        <span class="c1"># Cell relaxation kwargs ---&gt; see ase.constraints.ExpCellFilter</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="n">relax_cell_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;relax_cell_kwargs&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="c1"># Reformat dictionary to string</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="n">relax_cell_kwargs_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">relax_cell_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>        <span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="c1"># Set parameters for minimization</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>        <span class="n">params_run</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;fmax=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;ionic_force_tolerance&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, steps=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> 
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="c1"># Save parameters in        </span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;relax_cell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relax_cell</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">save_path</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>        
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="c1"># Somewhat hidden feature of adding custom fixes</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="c1"># TODO: Document? Make it a more &quot;official&quot; paramerer?</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="n">fixes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixes&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fixes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>            <span class="n">fixes</span> <span class="o">=</span> <span class="p">[</span><span class="n">fixes</span><span class="p">]</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fixes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>            <span class="k">pass</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Fixes are neither string or array of strings. Ignoring&#39;</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>            <span class="n">fixes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="n">fix_imports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fix_imports&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fix_imports</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>                
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>            <span class="n">fix_imports</span> <span class="o">=</span> <span class="p">[</span><span class="n">fix_imports</span><span class="p">]</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fix_imports</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>            <span class="k">pass</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Fix imports are neither string or array of strings. Ignoring&#39;</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>            <span class="n">fix_imports</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>            
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>        <span class="n">script</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>            <span class="s1">&#39;from tensorpotential.calculator import grace_fm&#39;</span><span class="p">,</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>            <span class="s1">&#39;from ase.io import read&#39;</span><span class="p">,</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>            <span class="s1">&#39;from ase.io.cif import write_cif&#39;</span><span class="p">,</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>            <span class="s1">&#39;from ase.io.trajectory import Trajectory&#39;</span><span class="p">,</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>            <span class="sa">f</span><span class="s1">&#39;from ase.optimize import </span><span class="si">{</span><span class="n">algo</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="p">]</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="k">if</span> <span class="n">relax_cell</span><span class="p">:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;from ase.constraints import ExpCellFilter as ECF&#39;</span><span class="p">]</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fix_imports</span><span class="p">:</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="n">f</span><span class="p">]</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>            <span class="sa">f</span><span class="s1">&#39;struct = read(&quot;structure.cif&quot;)&#39;</span><span class="p">,</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>            <span class="sa">f</span><span class="s1">&#39;struct.calc = grace_fm(&quot;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&quot;)&#39;</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>        <span class="p">]</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fixes</span><span class="p">:</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;struct.set_constraint(</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">relax_cell</span><span class="p">:</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>                <span class="sa">f</span><span class="s1">&#39;relaxation = </span><span class="si">{</span><span class="n">algo</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">(atoms=struct, </span><span class="si">{</span><span class="n">algo_kwargs_str</span><span class="si">}</span><span class="s1">).run(</span><span class="si">{</span><span class="n">params_run</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,]</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>                <span class="sa">f</span><span class="s1">&#39;relaxation = </span><span class="si">{</span><span class="n">algo</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">(ECF(atoms=struct, </span><span class="si">{</span><span class="n">relax_cell_kwargs_str</span><span class="si">}</span><span class="s1">), </span><span class="si">{</span><span class="n">algo_kwargs_str</span><span class="si">}</span><span class="s1">).run(</span><span class="si">{</span><span class="n">params_run</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;write_cif(&quot;final_structure.cif&quot;, struct)&#39;</span><span class="p">]</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s1">&#39;calc_script.py&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">script</span><span class="p">))</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_calc_minimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;error.out&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">        Parse the output of a minimization.</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">        This function reads the minimization output file and returns the</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">        corresponding DataFrame containing the optimization step and energy information.</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">        Parameters</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        ----------</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">        output : str, optional</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">            The name of the output file to parse, by default &#39;error.out&#39;.</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">        Returns</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">        -------</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">        pd.DataFrame or None</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">            A DataFrame containing the optimization results, or None if parsing fails.</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>        <span class="c1"># ASE optimizer</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="n">algo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;algo&#39;</span><span class="p">,</span> <span class="s1">&#39;FIRE&#39;</span><span class="p">)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>            <span class="c1"># Find the header line dynamically</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">output</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Step&#39;</span><span class="p">):</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>                    <span class="n">header_idx</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>                    <span class="k">break</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No table header found in </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>            <span class="n">table_lines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>            <span class="c1"># Ensure that the line contains the expected algorithm</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">header_idx</span><span class="p">:]:</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>                <span class="k">if</span> <span class="n">algo</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Step&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>                    <span class="n">table_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>            <span class="c1"># Read table into DataFrame</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>            <span class="n">table_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">table_lines</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">table_str</span><span class="p">),</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>                             <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot parse output from </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1"> file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>    <span class="c1">################################################</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>    <span class="c1">### --- IMPLEMENTATION OF MD CALCULATION --- ###</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>    <span class="c1">################################################</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_md</span><span class="p">(</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>        <span class="n">grace_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="o">*</span><span class="n">_grace_models</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GRACE-2L-OMAT&quot;</span><span class="p">,</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>        <span class="n">ensemble</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;NVT&quot;</span><span class="p">,</span> <span class="s2">&quot;nvt&quot;</span><span class="p">,</span> <span class="s2">&quot;Langevin&quot;</span><span class="p">,</span> <span class="s2">&quot;langevin&quot;</span><span class="p">,</span> <span class="s2">&quot;NPT&quot;</span><span class="p">,</span> <span class="s2">&quot;npt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NVT&quot;</span><span class="p">,</span> 
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">300.0</span><span class="p">,</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>        <span class="n">starting_temperature</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="n">pressure</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>        <span class="n">time_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>        <span class="n">n_ionic_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>        <span class="n">n_print</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="n">temperature_damping_timescale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">,</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>        <span class="n">pressure_damping_timescale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>        <span class="n">trajectory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;md_run.traj&quot;</span><span class="p">,</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="n">logfile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;md_run.log&quot;</span><span class="p">,</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>        <span class="n">random_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>    <span class="p">):</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="sd">        Run a molecular dynamics simulation using a GRACE foundation model.</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">    </span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">        Parameters</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a><span class="sd">        ----------</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a><span class="sd">        grace_model : Literal[*_grace_models], optional</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a><span class="sd">            GRACE model to use for the relaxation.  </span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a><span class="sd">            Must be one of the supported models, which can be obtained via </span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a><span class="sd">            :meth:`available_models`. Default is ``&quot;GRACE-2L-OMAT&quot;``.</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a><span class="sd">    </span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a><span class="sd">        ensemble : {&quot;NVT&quot;, &quot;nvt&quot;, &quot;Langevin&quot;, &quot;langevin&quot;, &quot;NPT&quot;, &quot;npt&quot;}, optional</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a><span class="sd">            Type of statistical ensemble:</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a><span class="sd">            - &quot;NVT&quot; or &quot;Langevin&quot;: constant volume and temperature.</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a><span class="sd">            - &quot;NPT&quot;: constant pressure and temperature.</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a><span class="sd">            Case-insensitive (default is &quot;NVT&quot;).</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a><span class="sd">    </span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a><span class="sd">        temperature : float, optional</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a><span class="sd">            Target simulation temperature in Kelvin (default is 300.0).</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="sd">    </span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a><span class="sd">        starting_temperature : int or None, optional</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a><span class="sd">            Initial temperature of the system in Kelvin. If None, uses</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">            the target `temperature` (default is None).</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a><span class="sd">    </span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a><span class="sd">        pressure : float or None, optional</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a><span class="sd">            Target external pressure in GPa for NPT runs. Ignored if ensemble</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a><span class="sd">            is NVT or Langevin (default is None).</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a><span class="sd">    </span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a><span class="sd">        time_step : float, optional</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a><span class="sd">            Integration time step in femtoseconds (default is 2.0 fs).</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="sd">    </span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="sd">        n_ionic_steps : int, optional</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">            Number of MD steps to perform (default is 100).</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a><span class="sd">    </span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="sd">        n_print : int, optional</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a><span class="sd">            Frequency of log printing and trajectory writing (default is 10).</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="sd">    </span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a><span class="sd">        temperature_damping_timescale : float, optional</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">            Thermostat coupling time in femtoseconds (default is 100.0 fs).</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="sd">    </span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="sd">        pressure_damping_timescale : float or None, optional</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a><span class="sd">            Barostat coupling time in femtoseconds. Only relevant for NPT runs</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="sd">            (default is None).</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a><span class="sd">    </span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a><span class="sd">        trajectory : str, optional</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="sd">            Output trajectory file name (default is &quot;md_run.traj&quot;).</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a><span class="sd">    </span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a><span class="sd">        logfile : str, optional</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a><span class="sd">            Output log file name (default is &quot;md_run.log&quot;).</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">    </span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="sd">        random_seed : int or None, optional</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="sd">            Seed for random velocity initialization. If None, system clock</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">            is used (default is None).</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">            </span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">        mask : None, sequence of 3 ints (0/1), or (3,3) array-like, optional</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="sd">            Specify which components of the computational box (strain tensor)</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="sd">            are allowed to change under the barostat (default is None equalling</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a><span class="sd">            to *No mask*). Only relevant for NPT simulations; it has no effect </span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">            for NVT / Langevin ensembles.</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;md&#39;</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>        <span class="n">ensemble</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>        <span class="k">if</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;langevin&#39;</span><span class="p">,</span> <span class="s1">&#39;nvt&#39;</span><span class="p">]:</span> <span class="c1">#requested NVT, ignore NPT settings</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>            <span class="n">pressure</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>        <span class="k">if</span> <span class="n">pressure</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>            <span class="n">pressure_damping_timescale</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">calc_md</span><span class="p">(</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>            <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>            <span class="n">pressure</span><span class="o">=</span><span class="n">pressure</span><span class="p">,</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>            <span class="n">n_ionic_steps</span><span class="o">=</span><span class="n">n_ionic_steps</span><span class="p">,</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>            <span class="n">time_step</span><span class="o">=</span><span class="n">time_step</span><span class="p">,</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>            <span class="n">n_print</span><span class="o">=</span><span class="n">n_print</span><span class="p">,</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>            <span class="n">temperature_damping_timescale</span><span class="o">=</span><span class="n">temperature_damping_timescale</span><span class="p">,</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>            <span class="n">pressure_damping_timescale</span><span class="o">=</span><span class="n">pressure_damping_timescale</span><span class="p">,</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>        <span class="p">)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grace_model</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;ensemble&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;trajectory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trajectory</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;logfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logfile</span> 
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>        <span class="k">if</span> <span class="n">starting_temperature</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>            <span class="n">starting_temperature</span> <span class="o">=</span> <span class="n">temperature</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;starting_temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">starting_temperature</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;random_seed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_seed</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_write_calc_md</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a><span class="sd">        Write the calculation script for performing molecular dynamics (MD).</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a><span class="sd">        This method generates a Python script that uses CHGNet for running MD</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a><span class="sd">        simulations and writes it to a file in the working directory.</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>        <span class="c1"># Somewhat hidden feature of adding custom fixes</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>        <span class="c1"># TODO: Document? Make it a more &quot;official&quot; paramerer?</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>        <span class="n">fixes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixes&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fixes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>            <span class="n">fixes</span> <span class="o">=</span> <span class="p">[</span><span class="n">fixes</span><span class="p">]</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fixes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>            <span class="k">pass</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>                <span class="s1">&#39;Fixes are neither string or array of strings. Ignoring&#39;</span><span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>            <span class="n">fixes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>        <span class="n">fix_imports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fix_imports&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fix_imports</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>            <span class="n">fix_imports</span> <span class="o">=</span> <span class="p">[</span><span class="n">fix_imports</span><span class="p">]</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fix_imports</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>            <span class="k">pass</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>                <span class="s1">&#39;fix_imports are neither string or array of strings. Ignoring&#39;</span><span class="p">)</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>            <span class="n">fix_imports</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>        
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>        <span class="n">script</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>            <span class="s1">&#39;from tensorpotential.calculator import grace_fm&#39;</span><span class="p">,</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>            <span class="s1">&#39;from ase.md.velocitydistribution import MaxwellBoltzmannDistribution&#39;</span><span class="p">,</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>            <span class="s1">&#39;from ase.io import read&#39;</span><span class="p">,</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>            <span class="s1">&#39;from ase.io.cif import write_cif&#39;</span><span class="p">,</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>            <span class="s1">&#39;from ase.io.trajectory import Trajectory&#39;</span><span class="p">,</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>            <span class="s1">&#39;from ase import units&#39;</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>        <span class="p">]</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fix_imports</span><span class="p">:</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="n">f</span><span class="p">]</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>            <span class="s1">&#39;struct = read(&quot;structure.cif&quot;)&#39;</span><span class="p">,]</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fixes</span><span class="p">:</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;struct.set_constraint(</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>            <span class="sa">f</span><span class="s1">&#39;calc = grace_fm(&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;)&#39;</span><span class="p">,</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>            <span class="s1">&#39;struct.calc = calc&#39;</span><span class="p">,</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>        <span class="p">]</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;random_seed&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>                <span class="s1">&#39;import numpy as np&#39;</span><span class="p">,</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>                <span class="sa">f</span><span class="s1">&#39;np.random.seed(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;random_seed&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>            <span class="p">]</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>            <span class="sa">f</span><span class="s1">&#39;MaxwellBoltzmannDistribution(struct, temperature_K=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;starting_temperature&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>        <span class="p">]</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;ensemble&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;langevin&#39;</span><span class="p">:</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>                <span class="s1">&#39;from ase.md.langevin import Langevin&#39;</span><span class="p">,</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>                <span class="sa">f</span><span class="s1">&#39;dyn = Langevin(struct, timestep=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;time_step&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, temperature_K=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, friction=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;temperature_damping_timescale&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>                <span class="p">]</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>            <span class="n">pressure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">pressure</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>                <span class="n">pressure</span> <span class="o">/=</span> <span class="n">EV_PER_ANG3_TO_GPA</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>            <span class="n">pfactor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;pressure_damping_timescale&quot;</span><span class="p">]</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">pfactor</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>                <span class="n">pfactor</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">pfactor</span><span class="si">}</span><span class="s1">*units.fs&#39;</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>                <span class="s1">&#39;from ase.md.npt import NPT&#39;</span><span class="p">,</span>                
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>                <span class="sa">f</span><span class="s1">&#39;dyn = NPT(struct, timestep=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;time_step&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">*units.fs, temperature_K=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, ttime=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;temperature_damping_timescale&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">*units.fs, externalstress=</span><span class="si">{</span><span class="n">pressure</span><span class="si">}</span><span class="s1">, pfactor=</span><span class="si">{</span><span class="n">pfactor</span><span class="si">}</span><span class="s1"> , mask=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>                <span class="p">]</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>            <span class="sa">f</span><span class="s1">&#39;traj = Trajectory(&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;trajectory&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;, &quot;w&quot;, struct)&#39;</span><span class="p">,</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>            <span class="sa">f</span><span class="s1">&#39;dyn.attach(traj.write, interval=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;n_print&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>            <span class="sa">f</span><span class="s1">&#39;logfile = open(&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;logfile&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;, &quot;w&quot;)&#39;</span><span class="p">,</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>            <span class="s1">&#39;logfile.write(&quot;step</span><span class="se">\\</span><span class="s1">tTime</span><span class="se">\\</span><span class="s1">tEtot</span><span class="se">\\</span><span class="s1">tEpot</span><span class="se">\\</span><span class="s1">tEkin</span><span class="se">\\</span><span class="s1">tT</span><span class="se">\\</span><span class="s1">tVol</span><span class="se">\\</span><span class="s1">ta</span><span class="se">\\</span><span class="s1">tb</span><span class="se">\\</span><span class="s1">tc</span><span class="se">\\</span><span class="s1">tsigma_xx</span><span class="se">\\</span><span class="s1">tsigma_yy</span><span class="se">\\</span><span class="s1">tsigma_zz</span><span class="se">\\</span><span class="s1">tsigma_yz</span><span class="se">\\</span><span class="s1">tsigma_xz</span><span class="se">\\</span><span class="s1">tsigma_xy</span><span class="se">\\</span><span class="s1">n&quot;)&#39;</span><span class="p">,</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>            <span class="s1">&#39;def print_status():&#39;</span><span class="p">,</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>            <span class="s1">&#39;    values = [dyn.nsteps, dyn.nsteps*dyn.dt]&#39;</span><span class="p">,</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>            <span class="s1">&#39;    values += [struct.get_potential_energy()+struct.get_kinetic_energy()]&#39;</span><span class="p">,</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>            <span class="s1">&#39;    values += [struct.get_potential_energy(), struct.get_kinetic_energy()]&#39;</span><span class="p">,</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>            <span class="s1">&#39;    values += [struct.get_temperature()]&#39;</span><span class="p">,</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>            <span class="s1">&#39;    values += [struct.get_volume()]+list(struct.cell.lengths())&#39;</span><span class="p">,</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>            <span class="s1">&#39;    values += list(struct.get_stress())&#39;</span><span class="p">,</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a>            <span class="s1">&#39;    status = &quot;</span><span class="se">\\</span><span class="s1">t&quot;.join(str(v) for v in values)&#39;</span><span class="p">,</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>            <span class="s1">&#39;    print(status)&#39;</span><span class="p">,</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>            <span class="s1">&#39;    logfile.write(status+&quot;</span><span class="se">\\</span><span class="s1">n&quot;)&#39;</span><span class="p">,</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>            <span class="s1">&#39;    logfile.flush()&#39;</span><span class="p">,</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>            <span class="sa">f</span><span class="s1">&#39;dyn.attach(print_status, interval=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;n_print&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>            <span class="sa">f</span><span class="s1">&#39;dyn.run(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;n_ionic_steps&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>            <span class="s1">&#39;write_cif(&quot;final_structure.cif&quot;, struct)&#39;</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>        <span class="p">]</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s1">&#39;calc_script.py&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">script</span><span class="p">))</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_calc_md</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;md_run.log&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a><span class="sd">        Parse the output of a molecular dynamics (MD) simulation.</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a><span class="sd">        This function reads the MD log file and returns the corresponding DataFrame</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a><span class="sd">        containing time, total energy, potential energy, kinetic energy, and temperature.</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a><span class="sd">        Parameters</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a><span class="sd">        ----------</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a><span class="sd">        output : str, optional</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a><span class="sd">            The name of the MD log file to parse, by default &#39;md_run.log&#39;.</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a><span class="sd">        Returns</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a><span class="sd">        -------</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a><span class="sd">        pd.DataFrame or None</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a><span class="sd">            A DataFrame containing the MD simulation results, or None if parsing fails.</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>            <span class="c1"># df = pd.read_csv(</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>            <span class="c1">#     os.path.join(self.working_directory, output),</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>            <span class="c1">#     skiprows=1,</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>            <span class="c1">#     sep=r&#39;\s+&#39;</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>            <span class="c1"># )</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">output</span><span class="p">),</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a>                <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\t+&quot;</span><span class="p">,</span> 
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>                <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a>            <span class="p">)</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot parse output from </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1"> file.&#39;</span><span class="p">)</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>    <span class="c1">###############################</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>    <span class="c1">### --- COMMON FUNCTION --- ###</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a>    <span class="c1">###############################</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write_input</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a><span class="sd">        Write input files required for the Grace calculation.</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a><span class="sd">        This function writes the structure file (`structure.cif`), stores the input</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a><span class="sd">        dictionary to the HDF5 format, and delegates further writing depending on the</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a><span class="sd">        calculation mode (MD or static/minimize).</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a><span class="sd">        Returns</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a><span class="sd">        -------</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a><span class="sd">        None</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>        <span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s1">&#39;structure.cif&#39;</span><span class="p">),</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>              <span class="n">pyiron_to_ase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">))</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">:</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_calc_static</span><span class="p">()</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;minimize&#39;</span><span class="p">:</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_calc_minimize</span><span class="p">()</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;md&#39;</span><span class="p">:</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_calc_md</span><span class="p">()</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a>                <span class="s2">&quot;No calculation type set. Use calc_static(), calc_minimize() or calc_md() first.&quot;</span><span class="p">)</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a>            
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collect_output</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a><span class="sd">        Collect and store the results of a calculation.</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a><span class="sd">    </span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a><span class="sd">        This method parses the final structure, trajectory, and other output properties</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a><span class="sd">        from the calculation and stores them in HDF5 format. The internal structure</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a><span class="sd">        is updated, and various properties such as energies, structure, forces, and </span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a><span class="sd">        stresses are saved to the output group.</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a><span class="sd">    </span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a><span class="sd">        Returns</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a><span class="sd">        -------</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a><span class="sd">        None</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">voigt_to_tensor</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a>            <span class="c1"># s is a 6-element array from atoms.get_stress()</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a>                <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a>                <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a>                <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a>            <span class="p">])</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a>        <span class="n">relaxed_ase_structure</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s1">&#39;final_structure.cif&#39;</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;cif&#39;</span><span class="p">)</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a>        <span class="n">relaxed_pyiron_structure</span> <span class="o">=</span> <span class="n">ase_to_pyiron</span><span class="p">(</span><span class="n">relaxed_ase_structure</span><span class="p">)</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a>        <span class="c1"># Store the relaxed structure in the HDF5 group</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a>            <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;structure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relaxed_pyiron_structure</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">relaxed_pyiron_structure</span>  <span class="c1"># Update the job&#39;s structure</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a>        <span class="c1"># Parse trajectory from minimize</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;minimize&#39;</span><span class="p">,</span> <span class="s1">&#39;md&#39;</span><span class="p">]:</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a>            <span class="c1"># For minimize and md, we expect a trajectory file with the relaxed structure</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;minimize&#39;</span><span class="p">:</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a>                <span class="n">traj_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a>                <span class="n">traj</span> <span class="o">=</span> <span class="n">Trajectory</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">traj_file</span><span class="p">))</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos">829</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos">830</span></a>                <span class="n">traj_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;trajectory&#39;</span><span class="p">]</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos">831</span></a>                <span class="n">traj</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">traj_file</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos">832</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos">833</span></a>                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos">834</span></a>                    <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">])</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos">835</span></a>                    <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">positions</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">])</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos">836</span></a>                    <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;stresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos">837</span></a>                        <span class="p">[</span><span class="n">voigt_to_tensor</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">get_stress</span><span class="p">())</span><span class="o">*</span><span class="n">EV_PER_ANG3_TO_GPA</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">])</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos">838</span></a>                    <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">get_forces</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">])</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos">839</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos">840</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos">841</span></a>                    <span class="sa">f</span><span class="s1">&#39;Cannot parse output from </span><span class="si">{</span><span class="n">traj_file</span><span class="si">}</span><span class="s1"> file.&#39;</span><span class="p">)</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos">842</span></a>        
</span><span id="L-843"><a href="#L-843"><span class="linenos">843</span></a>        <span class="c1"># Parse other properties</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos">844</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">:</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos">845</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_calc_static</span><span class="p">()</span>  
</span><span id="L-846"><a href="#L-846"><span class="linenos">846</span></a>            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;max_force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos">847</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos">848</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos">849</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_tot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos">850</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos">851</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;max_force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;max_force&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos">852</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;stresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos">853</span></a>                    <span class="p">[</span><span class="n">voigt_to_tensor</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">EV_PER_ANG3_TO_GPA</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stresses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos">854</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos">855</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">relaxed_pyiron_structure</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()])</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos">856</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">relaxed_pyiron_structure</span><span class="o">.</span><span class="n">positions</span><span class="p">])</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos">857</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;minimize&#39;</span><span class="p">:</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos">858</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_calc_minimize</span><span class="p">()</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos">859</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos">860</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos">861</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_tot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos">862</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;max_force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos">863</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Step&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>        
</span><span id="L-864"><a href="#L-864"><span class="linenos">864</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;md&#39;</span><span class="p">:</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos">865</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_calc_md</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;logfile&#39;</span><span class="p">])</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos">866</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos">867</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Epot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos">868</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_tot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Etot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos">869</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_kin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Ekin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos">870</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos">871</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos">872</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos">873</span></a>
</span><span id="L-874"><a href="#L-874"><span class="linenos">874</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compress</span><span class="p">()</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos">875</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos">876</span></a>
</span><span id="L-877"><a href="#L-877"><span class="linenos">877</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Atoms</span><span class="p">:</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos">878</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos">879</span></a><span class="sd">        Retrieve the structure at a given frame from the calculation output.</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos">880</span></a>
</span><span id="L-881"><a href="#L-881"><span class="linenos">881</span></a><span class="sd">        This function returns the atomic structure (positions, cell, species) at the</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos">882</span></a><span class="sd">        specified frame index. The frame index is adjusted to ensure it is valid.</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos">883</span></a>
</span><span id="L-884"><a href="#L-884"><span class="linenos">884</span></a><span class="sd">        Parameters</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos">885</span></a><span class="sd">        ----------</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos">886</span></a><span class="sd">        frame : int, optional</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos">887</span></a><span class="sd">            The frame index to retrieve. If negative, it is counted from the last frame,</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos">888</span></a><span class="sd">            by default -1.</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos">889</span></a>
</span><span id="L-890"><a href="#L-890"><span class="linenos">890</span></a><span class="sd">        Returns</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos">891</span></a><span class="sd">        -------</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos">892</span></a><span class="sd">        Atoms</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos">893</span></a><span class="sd">            The ASE Atoms object representing the structure at the given frame.</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos">894</span></a>
</span><span id="L-895"><a href="#L-895"><span class="linenos">895</span></a><span class="sd">        Raises</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos">896</span></a><span class="sd">        ------</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos">897</span></a><span class="sd">        ValueError</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos">898</span></a><span class="sd">            If no structures are found in the job output.</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos">899</span></a><span class="sd">        IndexError</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos">900</span></a><span class="sd">            If the frame index is out of range.</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos">901</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos">902</span></a>        <span class="n">num_structures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_structures</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos">903</span></a>        <span class="k">if</span> <span class="n">num_structures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos">904</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No structures found in the job output.&quot;</span><span class="p">)</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos">905</span></a>
</span><span id="L-906"><a href="#L-906"><span class="linenos">906</span></a>        <span class="c1"># Ensure frame is valid</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos">907</span></a>        <span class="k">if</span> <span class="n">frame</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos">908</span></a>            <span class="n">frame</span> <span class="o">+=</span> <span class="n">num_structures</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos">909</span></a>        <span class="k">if</span> <span class="n">frame</span> <span class="o">&gt;=</span> <span class="n">num_structures</span><span class="p">:</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos">910</span></a>            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos">911</span></a>                <span class="sa">f</span><span class="s2">&quot;Frame </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s2"> is out of range for </span><span class="si">{</span><span class="n">num_structures</span><span class="si">}</span><span class="s2"> structures.&quot;</span><span class="p">)</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos">912</span></a>
</span><span id="L-913"><a href="#L-913"><span class="linenos">913</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos">914</span></a>            <span class="n">positions</span> <span class="o">=</span> <span class="n">h5out</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="n">frame</span><span class="p">]</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos">915</span></a>            <span class="n">cell</span> <span class="o">=</span> <span class="n">h5out</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">][</span><span class="n">frame</span><span class="p">]</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos">916</span></a>        <span class="c1"># Read positions and cell</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos">917</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/structure&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos">918</span></a>            <span class="n">species</span> <span class="o">=</span> <span class="n">h5out</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">]</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos">919</span></a>            <span class="n">indices</span> <span class="o">=</span> <span class="n">h5out</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos">920</span></a>
</span><span id="L-921"><a href="#L-921"><span class="linenos">921</span></a>        <span class="c1"># Generate symbols list</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos">922</span></a>        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos">923</span></a>        <span class="k">return</span> <span class="n">ase_to_pyiron</span><span class="p">(</span><span class="n">Atoms</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos">924</span></a>
</span><span id="L-925"><a href="#L-925"><span class="linenos">925</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files_to_compress</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos">926</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos">927</span></a><span class="sd">        Compress the output files of a job object.</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos">928</span></a><span class="sd">    </span>
</span><span id="L-929"><a href="#L-929"><span class="linenos">929</span></a><span class="sd">        Args:</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos">930</span></a><span class="sd">            files_to_compress (list): A list of files to compress (optional)</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos">931</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos">932</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos">933</span></a>        <span class="c1"># delete empty files</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos">934</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos">935</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos">936</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos">937</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos">938</span></a>        <span class="c1"># delete slurm scripts</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos">939</span></a>        <span class="k">if</span> <span class="s2">&quot;run_queue.sh&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos">940</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s2">&quot;run_queue.sh&quot;</span><span class="p">)</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos">941</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos">942</span></a>        <span class="c1"># compress all remaining files</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos">943</span></a>        <span class="k">if</span> <span class="n">files_to_compress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos">944</span></a>            <span class="n">files_to_compress</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos">945</span></a>                <span class="n">f</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos">946</span></a>                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos">947</span></a>                <span class="k">if</span> <span class="n">f</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos">948</span></a>                <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos">949</span></a>                    <span class="s2">&quot;final_structure.cif&quot;</span><span class="p">,</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos">950</span></a>                <span class="p">]</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos">951</span></a>            <span class="p">]</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos">952</span></a>        
</span><span id="L-953"><a href="#L-953"><span class="linenos">953</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Grace</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">files_to_compress</span><span class="o">=</span><span class="n">files_to_compress</span><span class="p">)</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos">954</span></a>
</span><span id="L-955"><a href="#L-955"><span class="linenos">955</span></a>
</span><span id="L-956"><a href="#L-956"><span class="linenos">956</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CalcParams</span><span class="p">(</span><span class="n">GenericParameters</span><span class="p">):</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos">957</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos">958</span></a><span class="sd">    Class to manage the calculation parameters for Grace calculations.</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos">959</span></a>
</span><span id="L-960"><a href="#L-960"><span class="linenos">960</span></a><span class="sd">    This class extends from `GenericParameters` and is used to define and manage</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos">961</span></a><span class="sd">    parameters specific to Grace calculations. It allows for initialization of</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos">962</span></a><span class="sd">    parameters and stores them in a table, with a default table name of &quot;grace&quot;.</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos">963</span></a><span class="sd">    The class can be used to load and store various Grace calculation settings and</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos">964</span></a><span class="sd">    other related configurations.</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos">965</span></a>
</span><span id="L-966"><a href="#L-966"><span class="linenos">966</span></a><span class="sd">    Parameters</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos">967</span></a><span class="sd">    ----------</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos">968</span></a><span class="sd">    table_name : str, optional</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos">969</span></a><span class="sd">        The name of the table where the parameters are stored. By default, it is set</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos">970</span></a><span class="sd">        to &quot;grace&quot;, but it can be customized if necessary.</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos">971</span></a>
</span><span id="L-972"><a href="#L-972"><span class="linenos">972</span></a><span class="sd">    Methods</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos">973</span></a><span class="sd">    -------</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos">974</span></a><span class="sd">    __init__(self, table_name=&quot;grace&quot;)</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos">975</span></a><span class="sd">        Initializes the parameters for the calculation.</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos">976</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos">977</span></a>
</span><span id="L-978"><a href="#L-978"><span class="linenos">978</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;grace&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos">979</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos">980</span></a><span class="sd">        Initialize the CalcParams object with the given table name.</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos">981</span></a>
</span><span id="L-982"><a href="#L-982"><span class="linenos">982</span></a><span class="sd">        Parameters</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos">983</span></a><span class="sd">        ----------</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos">984</span></a><span class="sd">        table_name : str, optional</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos">985</span></a><span class="sd">            The name of the table where the parameters are stored. By default,</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos">986</span></a><span class="sd">            it is set to &quot;grace&quot;.</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos">987</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos">988</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">CalcParams</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos">989</span></a>            <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos">990</span></a>        <span class="p">)</span>
</span></pre></div>


            </section>
                <section id="Grace">
                            <input id="Grace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Grace</span><wbr>(<span class="base">pyiron_atomistics.atomistics.job.atomistic.AtomisticGenericJob</span>):

                <label class="view-source-button" for="Grace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace-41"><a href="#Grace-41"><span class="linenos"> 41</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Grace</span><span class="p">(</span><span class="n">AtomisticGenericJob</span><span class="p">):</span>
</span><span id="Grace-42"><a href="#Grace-42"><span class="linenos"> 42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-43"><a href="#Grace-43"><span class="linenos"> 43</span></a><span class="sd">    Custom job class for using Grace within the pyiron framework.</span>
</span><span id="Grace-44"><a href="#Grace-44"><span class="linenos"> 44</span></a>
</span><span id="Grace-45"><a href="#Grace-45"><span class="linenos"> 45</span></a><span class="sd">    This class provides methods to perform static calculations, structure relaxation,</span>
</span><span id="Grace-46"><a href="#Grace-46"><span class="linenos"> 46</span></a><span class="sd">    and molecular dynamics simulations using Grace UMLIPs.</span>
</span><span id="Grace-47"><a href="#Grace-47"><span class="linenos"> 47</span></a>
</span><span id="Grace-48"><a href="#Grace-48"><span class="linenos"> 48</span></a><span class="sd">    Attributes</span>
</span><span id="Grace-49"><a href="#Grace-49"><span class="linenos"> 49</span></a><span class="sd">    ----------</span>
</span><span id="Grace-50"><a href="#Grace-50"><span class="linenos"> 50</span></a><span class="sd">    structure : pyiron.atomistics.structure.atoms.Atoms</span>
</span><span id="Grace-51"><a href="#Grace-51"><span class="linenos"> 51</span></a><span class="sd">        Structure associated with the job.</span>
</span><span id="Grace-52"><a href="#Grace-52"><span class="linenos"> 52</span></a><span class="sd">    input : CalcParams</span>
</span><span id="Grace-53"><a href="#Grace-53"><span class="linenos"> 53</span></a><span class="sd">        Input parameters for the Grace calculations.</span>
</span><span id="Grace-54"><a href="#Grace-54"><span class="linenos"> 54</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Grace-55"><a href="#Grace-55"><span class="linenos"> 55</span></a>
</span><span id="Grace-56"><a href="#Grace-56"><span class="linenos"> 56</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">job_name</span><span class="p">):</span>
</span><span id="Grace-57"><a href="#Grace-57"><span class="linenos"> 57</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-58"><a href="#Grace-58"><span class="linenos"> 58</span></a><span class="sd">        Initialize the Grace job.</span>
</span><span id="Grace-59"><a href="#Grace-59"><span class="linenos"> 59</span></a>
</span><span id="Grace-60"><a href="#Grace-60"><span class="linenos"> 60</span></a><span class="sd">        Parameters</span>
</span><span id="Grace-61"><a href="#Grace-61"><span class="linenos"> 61</span></a><span class="sd">        ----------</span>
</span><span id="Grace-62"><a href="#Grace-62"><span class="linenos"> 62</span></a><span class="sd">        project : pyiron.Project</span>
</span><span id="Grace-63"><a href="#Grace-63"><span class="linenos"> 63</span></a><span class="sd">            The pyiron project in which the job resides.</span>
</span><span id="Grace-64"><a href="#Grace-64"><span class="linenos"> 64</span></a><span class="sd">        job_name : str</span>
</span><span id="Grace-65"><a href="#Grace-65"><span class="linenos"> 65</span></a><span class="sd">            Name of the job.</span>
</span><span id="Grace-66"><a href="#Grace-66"><span class="linenos"> 66</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-67"><a href="#Grace-67"><span class="linenos"> 67</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Grace</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">job_name</span><span class="p">)</span>
</span><span id="Grace-68"><a href="#Grace-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Grace-69"><a href="#Grace-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">CalcParams</span><span class="p">()</span>
</span><span id="Grace-70"><a href="#Grace-70"><span class="linenos"> 70</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">file_exists</span><span class="p">:</span>
</span><span id="Grace-71"><a href="#Grace-71"><span class="linenos"> 71</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>
</span><span id="Grace-72"><a href="#Grace-72"><span class="linenos"> 72</span></a>        <span class="c1"># executable is in pyiron_resources/grace/bin</span>
</span><span id="Grace-73"><a href="#Grace-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_executable_activate</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s1">&#39;grace&#39;</span><span class="p">)</span>
</span><span id="Grace-74"><a href="#Grace-74"><span class="linenos"> 74</span></a>
</span><span id="Grace-75"><a href="#Grace-75"><span class="linenos"> 75</span></a>    <span class="nd">@property</span>
</span><span id="Grace-76"><a href="#Grace-76"><span class="linenos"> 76</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fmax</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Grace-77"><a href="#Grace-77"><span class="linenos"> 77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-78"><a href="#Grace-78"><span class="linenos"> 78</span></a><span class="sd">        Maximum force tolerance for ionic relaxation.</span>
</span><span id="Grace-79"><a href="#Grace-79"><span class="linenos"> 79</span></a>
</span><span id="Grace-80"><a href="#Grace-80"><span class="linenos"> 80</span></a><span class="sd">        This property controls the maximum force tolerance (in eV/Å) used during ionic relaxation.</span>
</span><span id="Grace-81"><a href="#Grace-81"><span class="linenos"> 81</span></a>
</span><span id="Grace-82"><a href="#Grace-82"><span class="linenos"> 82</span></a><span class="sd">        Returns</span>
</span><span id="Grace-83"><a href="#Grace-83"><span class="linenos"> 83</span></a><span class="sd">        -------</span>
</span><span id="Grace-84"><a href="#Grace-84"><span class="linenos"> 84</span></a><span class="sd">        float</span>
</span><span id="Grace-85"><a href="#Grace-85"><span class="linenos"> 85</span></a><span class="sd">            Maximum force tolerance (eV/Å).</span>
</span><span id="Grace-86"><a href="#Grace-86"><span class="linenos"> 86</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-87"><a href="#Grace-87"><span class="linenos"> 87</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;ionic_force_tolerance&#39;</span><span class="p">]</span>
</span><span id="Grace-88"><a href="#Grace-88"><span class="linenos"> 88</span></a>
</span><span id="Grace-89"><a href="#Grace-89"><span class="linenos"> 89</span></a>    <span class="nd">@fmax</span><span class="o">.</span><span class="n">setter</span>
</span><span id="Grace-90"><a href="#Grace-90"><span class="linenos"> 90</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmax</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Grace-91"><a href="#Grace-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-92"><a href="#Grace-92"><span class="linenos"> 92</span></a><span class="sd">        Set the maximum force tolerance for ionic relaxation.</span>
</span><span id="Grace-93"><a href="#Grace-93"><span class="linenos"> 93</span></a>
</span><span id="Grace-94"><a href="#Grace-94"><span class="linenos"> 94</span></a><span class="sd">        Parameters</span>
</span><span id="Grace-95"><a href="#Grace-95"><span class="linenos"> 95</span></a><span class="sd">        ----------</span>
</span><span id="Grace-96"><a href="#Grace-96"><span class="linenos"> 96</span></a><span class="sd">        fmax : float</span>
</span><span id="Grace-97"><a href="#Grace-97"><span class="linenos"> 97</span></a><span class="sd">            Maximum force tolerance (eV/Å).</span>
</span><span id="Grace-98"><a href="#Grace-98"><span class="linenos"> 98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-99"><a href="#Grace-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;ionic_force_tolerance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmax</span>
</span><span id="Grace-100"><a href="#Grace-100"><span class="linenos">100</span></a>
</span><span id="Grace-101"><a href="#Grace-101"><span class="linenos">101</span></a>    <span class="nd">@property</span>
</span><span id="Grace-102"><a href="#Grace-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">max_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Grace-103"><a href="#Grace-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-104"><a href="#Grace-104"><span class="linenos">104</span></a><span class="sd">        Get the maximum number of iterations for relaxation or MD run.</span>
</span><span id="Grace-105"><a href="#Grace-105"><span class="linenos">105</span></a>
</span><span id="Grace-106"><a href="#Grace-106"><span class="linenos">106</span></a><span class="sd">        Returns</span>
</span><span id="Grace-107"><a href="#Grace-107"><span class="linenos">107</span></a><span class="sd">        -------</span>
</span><span id="Grace-108"><a href="#Grace-108"><span class="linenos">108</span></a><span class="sd">        int</span>
</span><span id="Grace-109"><a href="#Grace-109"><span class="linenos">109</span></a><span class="sd">            Maximum number of iterations.</span>
</span><span id="Grace-110"><a href="#Grace-110"><span class="linenos">110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-111"><a href="#Grace-111"><span class="linenos">111</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span>
</span><span id="Grace-112"><a href="#Grace-112"><span class="linenos">112</span></a>
</span><span id="Grace-113"><a href="#Grace-113"><span class="linenos">113</span></a>    <span class="nd">@max_iter</span><span class="o">.</span><span class="n">setter</span>
</span><span id="Grace-114"><a href="#Grace-114"><span class="linenos">114</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">max_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Grace-115"><a href="#Grace-115"><span class="linenos">115</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-116"><a href="#Grace-116"><span class="linenos">116</span></a><span class="sd">        Set the maximum number of iterations for relaxation or MD run.</span>
</span><span id="Grace-117"><a href="#Grace-117"><span class="linenos">117</span></a>
</span><span id="Grace-118"><a href="#Grace-118"><span class="linenos">118</span></a><span class="sd">        Parameters</span>
</span><span id="Grace-119"><a href="#Grace-119"><span class="linenos">119</span></a><span class="sd">        ----------</span>
</span><span id="Grace-120"><a href="#Grace-120"><span class="linenos">120</span></a><span class="sd">        max_iter : int</span>
</span><span id="Grace-121"><a href="#Grace-121"><span class="linenos">121</span></a><span class="sd">            Maximum number of iterations.</span>
</span><span id="Grace-122"><a href="#Grace-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-123"><a href="#Grace-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_iter</span>
</span><span id="Grace-124"><a href="#Grace-124"><span class="linenos">124</span></a>
</span><span id="Grace-125"><a href="#Grace-125"><span class="linenos">125</span></a>    <span class="nd">@property</span>
</span><span id="Grace-126"><a href="#Grace-126"><span class="linenos">126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Grace-127"><a href="#Grace-127"><span class="linenos">127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-128"><a href="#Grace-128"><span class="linenos">128</span></a><span class="sd">        Return the current GRACE model.</span>
</span><span id="Grace-129"><a href="#Grace-129"><span class="linenos">129</span></a><span class="sd">    </span>
</span><span id="Grace-130"><a href="#Grace-130"><span class="linenos">130</span></a><span class="sd">        Returns</span>
</span><span id="Grace-131"><a href="#Grace-131"><span class="linenos">131</span></a><span class="sd">        -------</span>
</span><span id="Grace-132"><a href="#Grace-132"><span class="linenos">132</span></a><span class="sd">        str</span>
</span><span id="Grace-133"><a href="#Grace-133"><span class="linenos">133</span></a><span class="sd">            The selected GRACE model name.</span>
</span><span id="Grace-134"><a href="#Grace-134"><span class="linenos">134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-135"><a href="#Grace-135"><span class="linenos">135</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span>
</span><span id="Grace-136"><a href="#Grace-136"><span class="linenos">136</span></a>
</span><span id="Grace-137"><a href="#Grace-137"><span class="linenos">137</span></a>
</span><span id="Grace-138"><a href="#Grace-138"><span class="linenos">138</span></a>    <span class="nd">@model</span><span class="o">.</span><span class="n">setter</span>
</span><span id="Grace-139"><a href="#Grace-139"><span class="linenos">139</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Grace-140"><a href="#Grace-140"><span class="linenos">140</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-141"><a href="#Grace-141"><span class="linenos">141</span></a><span class="sd">        Set the GRACE model name.</span>
</span><span id="Grace-142"><a href="#Grace-142"><span class="linenos">142</span></a><span class="sd">    </span>
</span><span id="Grace-143"><a href="#Grace-143"><span class="linenos">143</span></a><span class="sd">        Parameters</span>
</span><span id="Grace-144"><a href="#Grace-144"><span class="linenos">144</span></a><span class="sd">        ----------</span>
</span><span id="Grace-145"><a href="#Grace-145"><span class="linenos">145</span></a><span class="sd">        model : str</span>
</span><span id="Grace-146"><a href="#Grace-146"><span class="linenos">146</span></a><span class="sd">            Name of the GRACE model to use. Must be one of the supported</span>
</span><span id="Grace-147"><a href="#Grace-147"><span class="linenos">147</span></a><span class="sd">            GRACE model identifiers:</span>
</span><span id="Grace-148"><a href="#Grace-148"><span class="linenos">148</span></a><span class="sd">    </span>
</span><span id="Grace-149"><a href="#Grace-149"><span class="linenos">149</span></a><span class="sd">            - &quot;GRACE-1L-MP-r6&quot;</span>
</span><span id="Grace-150"><a href="#Grace-150"><span class="linenos">150</span></a><span class="sd">            - &quot;GRACE-2L-MP-r5&quot;</span>
</span><span id="Grace-151"><a href="#Grace-151"><span class="linenos">151</span></a><span class="sd">            - &quot;GRACE-2L-MP-r6&quot;</span>
</span><span id="Grace-152"><a href="#Grace-152"><span class="linenos">152</span></a><span class="sd">            - &quot;GRACE-FS-OAM&quot;</span>
</span><span id="Grace-153"><a href="#Grace-153"><span class="linenos">153</span></a><span class="sd">            - &quot;GRACE-1L-OAM&quot;</span>
</span><span id="Grace-154"><a href="#Grace-154"><span class="linenos">154</span></a><span class="sd">            - &quot;GRACE-2L-OAM&quot;</span>
</span><span id="Grace-155"><a href="#Grace-155"><span class="linenos">155</span></a><span class="sd">            - &quot;GRACE-FS-OMAT&quot;</span>
</span><span id="Grace-156"><a href="#Grace-156"><span class="linenos">156</span></a><span class="sd">            - &quot;GRACE-1L-OMAT&quot;</span>
</span><span id="Grace-157"><a href="#Grace-157"><span class="linenos">157</span></a><span class="sd">            - &quot;GRACE-2L-OMAT&quot;</span>
</span><span id="Grace-158"><a href="#Grace-158"><span class="linenos">158</span></a><span class="sd">            - &quot;GRACE-1L-OMAT-medium-base&quot;</span>
</span><span id="Grace-159"><a href="#Grace-159"><span class="linenos">159</span></a><span class="sd">            - &quot;GRACE-1L-OMAT-medium-ft-E&quot;</span>
</span><span id="Grace-160"><a href="#Grace-160"><span class="linenos">160</span></a><span class="sd">            - &quot;GRACE-1L-OMAT-large-base&quot;</span>
</span><span id="Grace-161"><a href="#Grace-161"><span class="linenos">161</span></a><span class="sd">            - &quot;GRACE-1L-OMAT-large-ft-E&quot;</span>
</span><span id="Grace-162"><a href="#Grace-162"><span class="linenos">162</span></a><span class="sd">            - &quot;GRACE-2L-OMAT-medium-base&quot;</span>
</span><span id="Grace-163"><a href="#Grace-163"><span class="linenos">163</span></a><span class="sd">            - &quot;GRACE-2L-OMAT-medium-ft-E&quot;</span>
</span><span id="Grace-164"><a href="#Grace-164"><span class="linenos">164</span></a><span class="sd">            - &quot;GRACE-2L-OMAT-large-base&quot;</span>
</span><span id="Grace-165"><a href="#Grace-165"><span class="linenos">165</span></a><span class="sd">            - &quot;GRACE-2L-OMAT-large-ft-E&quot;</span>
</span><span id="Grace-166"><a href="#Grace-166"><span class="linenos">166</span></a><span class="sd">    </span>
</span><span id="Grace-167"><a href="#Grace-167"><span class="linenos">167</span></a><span class="sd">        Raises</span>
</span><span id="Grace-168"><a href="#Grace-168"><span class="linenos">168</span></a><span class="sd">        ------</span>
</span><span id="Grace-169"><a href="#Grace-169"><span class="linenos">169</span></a><span class="sd">        ValueError</span>
</span><span id="Grace-170"><a href="#Grace-170"><span class="linenos">170</span></a><span class="sd">            If `model` is not a valid GRACE model identifier.</span>
</span><span id="Grace-171"><a href="#Grace-171"><span class="linenos">171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-172"><a href="#Grace-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="n">model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_grace_models</span><span class="p">:</span>
</span><span id="Grace-173"><a href="#Grace-173"><span class="linenos">173</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown grace model: </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Grace-174"><a href="#Grace-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="Grace-175"><a href="#Grace-175"><span class="linenos">175</span></a>
</span><span id="Grace-176"><a href="#Grace-176"><span class="linenos">176</span></a>
</span><span id="Grace-177"><a href="#Grace-177"><span class="linenos">177</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">available_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Grace-178"><a href="#Grace-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-179"><a href="#Grace-179"><span class="linenos">179</span></a><span class="sd">        Return the list of supported GRACE models.</span>
</span><span id="Grace-180"><a href="#Grace-180"><span class="linenos">180</span></a><span class="sd">    </span>
</span><span id="Grace-181"><a href="#Grace-181"><span class="linenos">181</span></a><span class="sd">        Returns</span>
</span><span id="Grace-182"><a href="#Grace-182"><span class="linenos">182</span></a><span class="sd">        -------</span>
</span><span id="Grace-183"><a href="#Grace-183"><span class="linenos">183</span></a><span class="sd">        list of str</span>
</span><span id="Grace-184"><a href="#Grace-184"><span class="linenos">184</span></a><span class="sd">            All valid GRACE model identifiers.</span>
</span><span id="Grace-185"><a href="#Grace-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-186"><a href="#Grace-186"><span class="linenos">186</span></a>        <span class="k">return</span> <span class="n">_grace_models</span>
</span><span id="Grace-187"><a href="#Grace-187"><span class="linenos">187</span></a>
</span><span id="Grace-188"><a href="#Grace-188"><span class="linenos">188</span></a>    
</span><span id="Grace-189"><a href="#Grace-189"><span class="linenos">189</span></a>    <span class="c1">####################################################</span>
</span><span id="Grace-190"><a href="#Grace-190"><span class="linenos">190</span></a>    <span class="c1">### --- IMPLEMENTATION OF STATIC CALCULATION --- ###</span>
</span><span id="Grace-191"><a href="#Grace-191"><span class="linenos">191</span></a>    <span class="c1">####################################################</span>
</span><span id="Grace-192"><a href="#Grace-192"><span class="linenos">192</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_static</span><span class="p">(</span>
</span><span id="Grace-193"><a href="#Grace-193"><span class="linenos">193</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Grace-194"><a href="#Grace-194"><span class="linenos">194</span></a>        <span class="n">grace_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="o">*</span><span class="n">_grace_models</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GRACE-2L-OMAT&quot;</span><span class="p">,</span>
</span><span id="Grace-195"><a href="#Grace-195"><span class="linenos">195</span></a>    <span class="p">):</span>
</span><span id="Grace-196"><a href="#Grace-196"><span class="linenos">196</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-197"><a href="#Grace-197"><span class="linenos">197</span></a><span class="sd">        Perform a static calculation.</span>
</span><span id="Grace-198"><a href="#Grace-198"><span class="linenos">198</span></a><span class="sd">    </span>
</span><span id="Grace-199"><a href="#Grace-199"><span class="linenos">199</span></a><span class="sd">        Parameters</span>
</span><span id="Grace-200"><a href="#Grace-200"><span class="linenos">200</span></a><span class="sd">        ----------</span>
</span><span id="Grace-201"><a href="#Grace-201"><span class="linenos">201</span></a><span class="sd">        grace_model : Literal[*_grace_models], optional</span>
</span><span id="Grace-202"><a href="#Grace-202"><span class="linenos">202</span></a><span class="sd">            GRACE model to use for the relaxation.  </span>
</span><span id="Grace-203"><a href="#Grace-203"><span class="linenos">203</span></a><span class="sd">            Must be one of the supported models, which can be obtained via </span>
</span><span id="Grace-204"><a href="#Grace-204"><span class="linenos">204</span></a><span class="sd">            :meth:`available_models`. Default is ``&quot;GRACE-2L-OMAT&quot;``.</span>
</span><span id="Grace-205"><a href="#Grace-205"><span class="linenos">205</span></a><span class="sd">    </span>
</span><span id="Grace-206"><a href="#Grace-206"><span class="linenos">206</span></a><span class="sd">        Raises</span>
</span><span id="Grace-207"><a href="#Grace-207"><span class="linenos">207</span></a><span class="sd">        ------</span>
</span><span id="Grace-208"><a href="#Grace-208"><span class="linenos">208</span></a><span class="sd">        ValueError</span>
</span><span id="Grace-209"><a href="#Grace-209"><span class="linenos">209</span></a><span class="sd">            If the structure has not been set before calling this method.</span>
</span><span id="Grace-210"><a href="#Grace-210"><span class="linenos">210</span></a><span class="sd">    </span>
</span><span id="Grace-211"><a href="#Grace-211"><span class="linenos">211</span></a><span class="sd">        Notes</span>
</span><span id="Grace-212"><a href="#Grace-212"><span class="linenos">212</span></a><span class="sd">        -----</span>
</span><span id="Grace-213"><a href="#Grace-213"><span class="linenos">213</span></a><span class="sd">        This method configures the GRACE calculator for a static calculation</span>
</span><span id="Grace-214"><a href="#Grace-214"><span class="linenos">214</span></a><span class="sd">        using the provided GRACE model.  </span>
</span><span id="Grace-215"><a href="#Grace-215"><span class="linenos">215</span></a><span class="sd">        A structure must be assigned to the instance prior to calling</span>
</span><span id="Grace-216"><a href="#Grace-216"><span class="linenos">216</span></a><span class="sd">        ``calc_static``.</span>
</span><span id="Grace-217"><a href="#Grace-217"><span class="linenos">217</span></a><span class="sd">    </span>
</span><span id="Grace-218"><a href="#Grace-218"><span class="linenos">218</span></a><span class="sd">        Returns</span>
</span><span id="Grace-219"><a href="#Grace-219"><span class="linenos">219</span></a><span class="sd">        -------</span>
</span><span id="Grace-220"><a href="#Grace-220"><span class="linenos">220</span></a><span class="sd">        None</span>
</span><span id="Grace-221"><a href="#Grace-221"><span class="linenos">221</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-222"><a href="#Grace-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace-223"><a href="#Grace-223"><span class="linenos">223</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Grace-224"><a href="#Grace-224"><span class="linenos">224</span></a>                <span class="s1">&#39;Structure must be set before calling calc_static().&#39;</span><span class="p">)</span>
</span><span id="Grace-225"><a href="#Grace-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>
</span><span id="Grace-226"><a href="#Grace-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">grace_model</span>
</span><span id="Grace-227"><a href="#Grace-227"><span class="linenos">227</span></a>
</span><span id="Grace-228"><a href="#Grace-228"><span class="linenos">228</span></a>        
</span><span id="Grace-229"><a href="#Grace-229"><span class="linenos">229</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_write_calc_static</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Grace-230"><a href="#Grace-230"><span class="linenos">230</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-231"><a href="#Grace-231"><span class="linenos">231</span></a><span class="sd">        Write the calculation script for performing static calculations.</span>
</span><span id="Grace-232"><a href="#Grace-232"><span class="linenos">232</span></a>
</span><span id="Grace-233"><a href="#Grace-233"><span class="linenos">233</span></a><span class="sd">        This method generates a Python script that uses Grace for static calculations</span>
</span><span id="Grace-234"><a href="#Grace-234"><span class="linenos">234</span></a><span class="sd">        and writes it to a file in the working directory.</span>
</span><span id="Grace-235"><a href="#Grace-235"><span class="linenos">235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-236"><a href="#Grace-236"><span class="linenos">236</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span>
</span><span id="Grace-237"><a href="#Grace-237"><span class="linenos">237</span></a>
</span><span id="Grace-238"><a href="#Grace-238"><span class="linenos">238</span></a>        <span class="n">script</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Grace-239"><a href="#Grace-239"><span class="linenos">239</span></a>            <span class="s1">&#39;from tensorpotential.calculator import grace_fm&#39;</span><span class="p">,</span>
</span><span id="Grace-240"><a href="#Grace-240"><span class="linenos">240</span></a>            <span class="s1">&#39;from ase.io import read&#39;</span><span class="p">,</span>
</span><span id="Grace-241"><a href="#Grace-241"><span class="linenos">241</span></a>            <span class="s1">&#39;from ase.io.cif import write_cif&#39;</span><span class="p">,</span>
</span><span id="Grace-242"><a href="#Grace-242"><span class="linenos">242</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="Grace-243"><a href="#Grace-243"><span class="linenos">243</span></a>            <span class="s1">&#39;initial_structure = read(&quot;structure.cif&quot;)&#39;</span><span class="p">,</span>
</span><span id="Grace-244"><a href="#Grace-244"><span class="linenos">244</span></a>            <span class="sa">f</span><span class="s1">&#39;initial_structure.calc = grace_fm(&quot;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&quot;)&#39;</span><span class="p">,</span>
</span><span id="Grace-245"><a href="#Grace-245"><span class="linenos">245</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="Grace-246"><a href="#Grace-246"><span class="linenos">246</span></a>            <span class="s1">&#39;# perform the static calculation&#39;</span><span class="p">,</span>
</span><span id="Grace-247"><a href="#Grace-247"><span class="linenos">247</span></a>            <span class="s1">&#39;energy_pot = initial_structure.get_total_energy()&#39;</span><span class="p">,</span>
</span><span id="Grace-248"><a href="#Grace-248"><span class="linenos">248</span></a>            <span class="s1">&#39;forces = initial_structure.get_forces()&#39;</span><span class="p">,</span>
</span><span id="Grace-249"><a href="#Grace-249"><span class="linenos">249</span></a>            <span class="s1">&#39;stresses = initial_structure.get_stress()&#39;</span><span class="p">,</span>
</span><span id="Grace-250"><a href="#Grace-250"><span class="linenos">250</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="Grace-251"><a href="#Grace-251"><span class="linenos">251</span></a>            <span class="s1">&#39;# write the results to an output file&#39;</span><span class="p">,</span>
</span><span id="Grace-252"><a href="#Grace-252"><span class="linenos">252</span></a>            <span class="s1">&#39;with open(&quot;log.out&quot;, &quot;w&quot;) as f:&#39;</span><span class="p">,</span>
</span><span id="Grace-253"><a href="#Grace-253"><span class="linenos">253</span></a>            <span class="s1">&#39;    f.write(&quot;step</span><span class="se">\t</span><span class="s1">energy_pot</span><span class="se">\t</span><span class="s1">forces</span><span class="se">\t</span><span class="s1">stresses</span><span class="se">\\</span><span class="s1">n&quot;)&#39;</span><span class="p">,</span>
</span><span id="Grace-254"><a href="#Grace-254"><span class="linenos">254</span></a>            <span class="s1">&#39;    f.write(f&quot;1</span><span class="se">\\</span><span class="s1">t</span><span class="si">{energy_pot}</span><span class="se">\\</span><span class="s1">t{forces.tolist()}</span><span class="se">\\</span><span class="s1">t{stresses.tolist()}</span><span class="se">\\</span><span class="s1">n&quot;)&#39;</span><span class="p">,</span>
</span><span id="Grace-255"><a href="#Grace-255"><span class="linenos">255</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="Grace-256"><a href="#Grace-256"><span class="linenos">256</span></a>            <span class="s1">&#39;# write the final structure to a CIF file&#39;</span><span class="p">,</span>
</span><span id="Grace-257"><a href="#Grace-257"><span class="linenos">257</span></a>            <span class="s1">&#39;write_cif(&quot;final_structure.cif&quot;, initial_structure)&#39;</span><span class="p">,</span>
</span><span id="Grace-258"><a href="#Grace-258"><span class="linenos">258</span></a>        <span class="p">]</span>
</span><span id="Grace-259"><a href="#Grace-259"><span class="linenos">259</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s1">&#39;calc_script.py&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Grace-260"><a href="#Grace-260"><span class="linenos">260</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">script</span><span class="p">))</span>
</span><span id="Grace-261"><a href="#Grace-261"><span class="linenos">261</span></a>
</span><span id="Grace-262"><a href="#Grace-262"><span class="linenos">262</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_calc_static</span><span class="p">(</span>
</span><span id="Grace-263"><a href="#Grace-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="Grace-264"><a href="#Grace-264"><span class="linenos">264</span></a>        <span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;log.out&#39;</span><span class="p">,</span> 
</span><span id="Grace-265"><a href="#Grace-265"><span class="linenos">265</span></a>        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Grace-266"><a href="#Grace-266"><span class="linenos">266</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="Grace-267"><a href="#Grace-267"><span class="linenos">267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-268"><a href="#Grace-268"><span class="linenos">268</span></a><span class="sd">        Parse the output of a static calculation and return optimization results.</span>
</span><span id="Grace-269"><a href="#Grace-269"><span class="linenos">269</span></a><span class="sd">    </span>
</span><span id="Grace-270"><a href="#Grace-270"><span class="linenos">270</span></a><span class="sd">        This method reads a static calculation output file and extracts the </span>
</span><span id="Grace-271"><a href="#Grace-271"><span class="linenos">271</span></a><span class="sd">        optimization steps and energy information, returning them as a DataFrame.</span>
</span><span id="Grace-272"><a href="#Grace-272"><span class="linenos">272</span></a><span class="sd">    </span>
</span><span id="Grace-273"><a href="#Grace-273"><span class="linenos">273</span></a><span class="sd">        Parameters</span>
</span><span id="Grace-274"><a href="#Grace-274"><span class="linenos">274</span></a><span class="sd">        ----------</span>
</span><span id="Grace-275"><a href="#Grace-275"><span class="linenos">275</span></a><span class="sd">        output : str, optional</span>
</span><span id="Grace-276"><a href="#Grace-276"><span class="linenos">276</span></a><span class="sd">            Name of the output file to parse. Default is &#39;log.out&#39;.</span>
</span><span id="Grace-277"><a href="#Grace-277"><span class="linenos">277</span></a><span class="sd">        skip : int, optional</span>
</span><span id="Grace-278"><a href="#Grace-278"><span class="linenos">278</span></a><span class="sd">            Number of rows to skip at the start of the file before parsing. Default is 0.</span>
</span><span id="Grace-279"><a href="#Grace-279"><span class="linenos">279</span></a><span class="sd">    </span>
</span><span id="Grace-280"><a href="#Grace-280"><span class="linenos">280</span></a><span class="sd">        Returns</span>
</span><span id="Grace-281"><a href="#Grace-281"><span class="linenos">281</span></a><span class="sd">        -------</span>
</span><span id="Grace-282"><a href="#Grace-282"><span class="linenos">282</span></a><span class="sd">        pd.DataFrame or None</span>
</span><span id="Grace-283"><a href="#Grace-283"><span class="linenos">283</span></a><span class="sd">            A DataFrame containing the optimization results if parsing succeeds,</span>
</span><span id="Grace-284"><a href="#Grace-284"><span class="linenos">284</span></a><span class="sd">            otherwise None.</span>
</span><span id="Grace-285"><a href="#Grace-285"><span class="linenos">285</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-286"><a href="#Grace-286"><span class="linenos">286</span></a>
</span><span id="Grace-287"><a href="#Grace-287"><span class="linenos">287</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Grace-288"><a href="#Grace-288"><span class="linenos">288</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="Grace-289"><a href="#Grace-289"><span class="linenos">289</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">output</span><span class="p">),</span>
</span><span id="Grace-290"><a href="#Grace-290"><span class="linenos">290</span></a>                <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\t+&quot;</span><span class="p">,</span> 
</span><span id="Grace-291"><a href="#Grace-291"><span class="linenos">291</span></a>                <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span>
</span><span id="Grace-292"><a href="#Grace-292"><span class="linenos">292</span></a>            <span class="p">)</span>
</span><span id="Grace-293"><a href="#Grace-293"><span class="linenos">293</span></a>            <span class="c1"># convert strings to np.array</span>
</span><span id="Grace-294"><a href="#Grace-294"><span class="linenos">294</span></a>            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
</span><span id="Grace-295"><a href="#Grace-295"><span class="linenos">295</span></a>            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stresses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
</span><span id="Grace-296"><a href="#Grace-296"><span class="linenos">296</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="Grace-297"><a href="#Grace-297"><span class="linenos">297</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Grace-298"><a href="#Grace-298"><span class="linenos">298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot parse output from </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1"> file.&#39;</span><span class="p">)</span>
</span><span id="Grace-299"><a href="#Grace-299"><span class="linenos">299</span></a>            <span class="k">return</span> <span class="kc">None</span>        
</span><span id="Grace-300"><a href="#Grace-300"><span class="linenos">300</span></a>
</span><span id="Grace-301"><a href="#Grace-301"><span class="linenos">301</span></a>    
</span><span id="Grace-302"><a href="#Grace-302"><span class="linenos">302</span></a>    <span class="c1">##########################################################</span>
</span><span id="Grace-303"><a href="#Grace-303"><span class="linenos">303</span></a>    <span class="c1">### --- IMPLEMENTATION OF MINIMIZATION CALCULATION --- ###</span>
</span><span id="Grace-304"><a href="#Grace-304"><span class="linenos">304</span></a>    <span class="c1">##########################################################</span>
</span><span id="Grace-305"><a href="#Grace-305"><span class="linenos">305</span></a>    
</span><span id="Grace-306"><a href="#Grace-306"><span class="linenos">306</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_minimize</span><span class="p">(</span>
</span><span id="Grace-307"><a href="#Grace-307"><span class="linenos">307</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Grace-308"><a href="#Grace-308"><span class="linenos">308</span></a>        <span class="n">grace_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="o">*</span><span class="n">_grace_models</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GRACE-2L-OMAT&quot;</span><span class="p">,</span>
</span><span id="Grace-309"><a href="#Grace-309"><span class="linenos">309</span></a>        <span class="n">algorithm</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;FIRE&quot;</span><span class="p">,</span> <span class="s2">&quot;BFGS&quot;</span><span class="p">,</span> <span class="s2">&quot;LBFGS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;FIRE&quot;</span><span class="p">,</span>
</span><span id="Grace-310"><a href="#Grace-310"><span class="linenos">310</span></a>        <span class="n">algorithm_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Grace-311"><a href="#Grace-311"><span class="linenos">311</span></a>        <span class="n">relax_cell</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Grace-312"><a href="#Grace-312"><span class="linenos">312</span></a>        <span class="n">relax_cell_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Grace-313"><a href="#Grace-313"><span class="linenos">313</span></a>        <span class="n">ionic_force_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="Grace-314"><a href="#Grace-314"><span class="linenos">314</span></a>        <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
</span><span id="Grace-315"><a href="#Grace-315"><span class="linenos">315</span></a>        <span class="n">n_print</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Grace-316"><a href="#Grace-316"><span class="linenos">316</span></a>        <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;relax.traj&quot;</span><span class="p">,</span>
</span><span id="Grace-317"><a href="#Grace-317"><span class="linenos">317</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace-318"><a href="#Grace-318"><span class="linenos">318</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-319"><a href="#Grace-319"><span class="linenos">319</span></a><span class="sd">        Perform a structure relaxation (geometry optimization).</span>
</span><span id="Grace-320"><a href="#Grace-320"><span class="linenos">320</span></a><span class="sd">    </span>
</span><span id="Grace-321"><a href="#Grace-321"><span class="linenos">321</span></a><span class="sd">        Parameters</span>
</span><span id="Grace-322"><a href="#Grace-322"><span class="linenos">322</span></a><span class="sd">        ----------</span>
</span><span id="Grace-323"><a href="#Grace-323"><span class="linenos">323</span></a><span class="sd">        grace_model : Literal[*_grace_models], optional</span>
</span><span id="Grace-324"><a href="#Grace-324"><span class="linenos">324</span></a><span class="sd">            GRACE model to use for the relaxation.  </span>
</span><span id="Grace-325"><a href="#Grace-325"><span class="linenos">325</span></a><span class="sd">            Must be one of the supported models, which can be obtained via </span>
</span><span id="Grace-326"><a href="#Grace-326"><span class="linenos">326</span></a><span class="sd">            :meth:`available_models`. Default is ``&quot;GRACE-2L-OMAT&quot;``.</span>
</span><span id="Grace-327"><a href="#Grace-327"><span class="linenos">327</span></a><span class="sd">    </span>
</span><span id="Grace-328"><a href="#Grace-328"><span class="linenos">328</span></a><span class="sd">        algorithm : {&quot;FIRE&quot;, &quot;BFGS&quot;, &quot;LBFGS&quot;}, optional</span>
</span><span id="Grace-329"><a href="#Grace-329"><span class="linenos">329</span></a><span class="sd">            Ionic relaxation algorithm from ASE.  </span>
</span><span id="Grace-330"><a href="#Grace-330"><span class="linenos">330</span></a><span class="sd">            Default is ``&quot;FIRE&quot;``.</span>
</span><span id="Grace-331"><a href="#Grace-331"><span class="linenos">331</span></a><span class="sd">    </span>
</span><span id="Grace-332"><a href="#Grace-332"><span class="linenos">332</span></a><span class="sd">        algorithm_kwargs : dict, optional</span>
</span><span id="Grace-333"><a href="#Grace-333"><span class="linenos">333</span></a><span class="sd">            Additional keyword arguments passed to the relaxation algorithm.  </span>
</span><span id="Grace-334"><a href="#Grace-334"><span class="linenos">334</span></a><span class="sd">            Default is ``None``.</span>
</span><span id="Grace-335"><a href="#Grace-335"><span class="linenos">335</span></a><span class="sd">    </span>
</span><span id="Grace-336"><a href="#Grace-336"><span class="linenos">336</span></a><span class="sd">        relax_cell : bool, optional</span>
</span><span id="Grace-337"><a href="#Grace-337"><span class="linenos">337</span></a><span class="sd">            If ``True``, optimize the simulation cell in addition to ionic positions.  </span>
</span><span id="Grace-338"><a href="#Grace-338"><span class="linenos">338</span></a><span class="sd">            Default is ``False``.</span>
</span><span id="Grace-339"><a href="#Grace-339"><span class="linenos">339</span></a><span class="sd">    </span>
</span><span id="Grace-340"><a href="#Grace-340"><span class="linenos">340</span></a><span class="sd">        relax_cell_kwargs : dict, optional</span>
</span><span id="Grace-341"><a href="#Grace-341"><span class="linenos">341</span></a><span class="sd">            Additional keyword arguments for cell relaxation.  </span>
</span><span id="Grace-342"><a href="#Grace-342"><span class="linenos">342</span></a><span class="sd">            Default is ``None``.</span>
</span><span id="Grace-343"><a href="#Grace-343"><span class="linenos">343</span></a><span class="sd">    </span>
</span><span id="Grace-344"><a href="#Grace-344"><span class="linenos">344</span></a><span class="sd">        ionic_force_tolerance : float, optional</span>
</span><span id="Grace-345"><a href="#Grace-345"><span class="linenos">345</span></a><span class="sd">            Force convergence criterion in eV/Å.  </span>
</span><span id="Grace-346"><a href="#Grace-346"><span class="linenos">346</span></a><span class="sd">            Default is ``0.001``.</span>
</span><span id="Grace-347"><a href="#Grace-347"><span class="linenos">347</span></a><span class="sd">    </span>
</span><span id="Grace-348"><a href="#Grace-348"><span class="linenos">348</span></a><span class="sd">        max_iter : int, optional</span>
</span><span id="Grace-349"><a href="#Grace-349"><span class="linenos">349</span></a><span class="sd">            Maximum number of optimization steps.  </span>
</span><span id="Grace-350"><a href="#Grace-350"><span class="linenos">350</span></a><span class="sd">            Default is ``500``.</span>
</span><span id="Grace-351"><a href="#Grace-351"><span class="linenos">351</span></a><span class="sd">    </span>
</span><span id="Grace-352"><a href="#Grace-352"><span class="linenos">352</span></a><span class="sd">        n_print : int, optional</span>
</span><span id="Grace-353"><a href="#Grace-353"><span class="linenos">353</span></a><span class="sd">            Logging frequency for structures and stresses.  </span>
</span><span id="Grace-354"><a href="#Grace-354"><span class="linenos">354</span></a><span class="sd">            Default is ``1``.</span>
</span><span id="Grace-355"><a href="#Grace-355"><span class="linenos">355</span></a><span class="sd">    </span>
</span><span id="Grace-356"><a href="#Grace-356"><span class="linenos">356</span></a><span class="sd">        save_path : str or None, optional</span>
</span><span id="Grace-357"><a href="#Grace-357"><span class="linenos">357</span></a><span class="sd">            Path to save the relaxation trajectory.  </span>
</span><span id="Grace-358"><a href="#Grace-358"><span class="linenos">358</span></a><span class="sd">            If ``None``, no trajectory is written.  </span>
</span><span id="Grace-359"><a href="#Grace-359"><span class="linenos">359</span></a><span class="sd">            Default is ``&quot;relax.traj&quot;``.</span>
</span><span id="Grace-360"><a href="#Grace-360"><span class="linenos">360</span></a><span class="sd">    </span>
</span><span id="Grace-361"><a href="#Grace-361"><span class="linenos">361</span></a><span class="sd">        Returns</span>
</span><span id="Grace-362"><a href="#Grace-362"><span class="linenos">362</span></a><span class="sd">        -------</span>
</span><span id="Grace-363"><a href="#Grace-363"><span class="linenos">363</span></a><span class="sd">        None</span>
</span><span id="Grace-364"><a href="#Grace-364"><span class="linenos">364</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-365"><a href="#Grace-365"><span class="linenos">365</span></a>        
</span><span id="Grace-366"><a href="#Grace-366"><span class="linenos">366</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">calc_minimize</span><span class="p">(</span>
</span><span id="Grace-367"><a href="#Grace-367"><span class="linenos">367</span></a>            <span class="n">ionic_energy_tolerance</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="Grace-368"><a href="#Grace-368"><span class="linenos">368</span></a>            <span class="n">ionic_force_tolerance</span><span class="o">=</span><span class="n">ionic_force_tolerance</span><span class="p">,</span>
</span><span id="Grace-369"><a href="#Grace-369"><span class="linenos">369</span></a>            <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span>
</span><span id="Grace-370"><a href="#Grace-370"><span class="linenos">370</span></a>        <span class="p">)</span>
</span><span id="Grace-371"><a href="#Grace-371"><span class="linenos">371</span></a>
</span><span id="Grace-372"><a href="#Grace-372"><span class="linenos">372</span></a>        <span class="c1"># Saving the parameters in dictionary</span>
</span><span id="Grace-373"><a href="#Grace-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;minimize&#39;</span>
</span><span id="Grace-374"><a href="#Grace-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grace_model</span>
</span><span id="Grace-375"><a href="#Grace-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;algo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">algorithm</span>
</span><span id="Grace-376"><a href="#Grace-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;algo_kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">algorithm_kwargs</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="Grace-377"><a href="#Grace-377"><span class="linenos">377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;relax_cell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relax_cell</span>
</span><span id="Grace-378"><a href="#Grace-378"><span class="linenos">378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;relax_cell_kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relax_cell_kwargs</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="Grace-379"><a href="#Grace-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;ionic_force_tolerance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ionic_force_tolerance</span>
</span><span id="Grace-380"><a href="#Grace-380"><span class="linenos">380</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;n_print&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_print</span>
</span><span id="Grace-381"><a href="#Grace-381"><span class="linenos">381</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_iter</span>
</span><span id="Grace-382"><a href="#Grace-382"><span class="linenos">382</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">save_path</span>
</span><span id="Grace-383"><a href="#Grace-383"><span class="linenos">383</span></a>    
</span><span id="Grace-384"><a href="#Grace-384"><span class="linenos">384</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_write_calc_minimize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Grace-385"><a href="#Grace-385"><span class="linenos">385</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-386"><a href="#Grace-386"><span class="linenos">386</span></a><span class="sd">        Write the calculation script for performing structure relaxation.</span>
</span><span id="Grace-387"><a href="#Grace-387"><span class="linenos">387</span></a>
</span><span id="Grace-388"><a href="#Grace-388"><span class="linenos">388</span></a><span class="sd">        This method generates a Python script that uses Grace for structure</span>
</span><span id="Grace-389"><a href="#Grace-389"><span class="linenos">389</span></a><span class="sd">        relaxation and writes it to a file in the working directory.</span>
</span><span id="Grace-390"><a href="#Grace-390"><span class="linenos">390</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-391"><a href="#Grace-391"><span class="linenos">391</span></a>
</span><span id="Grace-392"><a href="#Grace-392"><span class="linenos">392</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="c1"># Grace model</span>
</span><span id="Grace-393"><a href="#Grace-393"><span class="linenos">393</span></a>        <span class="n">algo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;algo&#39;</span><span class="p">,</span> <span class="s1">&#39;FIRE&#39;</span><span class="p">)</span> <span class="c1"># ASE optimizer</span>
</span><span id="Grace-394"><a href="#Grace-394"><span class="linenos">394</span></a>        <span class="k">if</span> <span class="n">algo</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;FIRE&#39;</span><span class="p">,</span> <span class="s1">&#39;BFGS&#39;</span><span class="p">,</span> <span class="s1">&#39;LBFGS&#39;</span><span class="p">]:</span>
</span><span id="Grace-395"><a href="#Grace-395"><span class="linenos">395</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Grace-396"><a href="#Grace-396"><span class="linenos">396</span></a>                <span class="sa">f</span><span class="s2">&quot;Unsupported optimizer: </span><span class="si">{</span><span class="n">algo</span><span class="si">}</span><span class="s2">. Supported optimizers are: FIRE, BFGS, LBFGS.&quot;</span><span class="p">)</span>
</span><span id="Grace-397"><a href="#Grace-397"><span class="linenos">397</span></a>        <span class="c1"># ASE optimizer kwargs</span>
</span><span id="Grace-398"><a href="#Grace-398"><span class="linenos">398</span></a>        <span class="n">algo_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;algo_kwargs&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Grace-399"><a href="#Grace-399"><span class="linenos">399</span></a>        <span class="n">save_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="s1">&#39;relax.traj&#39;</span><span class="p">)</span> <span class="c1"># Add trajectory parameter</span>
</span><span id="Grace-400"><a href="#Grace-400"><span class="linenos">400</span></a>        <span class="n">algo_kwargs</span><span class="p">[</span><span class="s1">&#39;trajectory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Grace-401"><a href="#Grace-401"><span class="linenos">401</span></a>        <span class="n">algo_kwargs</span><span class="p">[</span><span class="s1">&#39;loginterval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;n_print&#39;</span><span class="p">]</span>
</span><span id="Grace-402"><a href="#Grace-402"><span class="linenos">402</span></a>        <span class="c1"># Reformat dictionary to string</span>
</span><span id="Grace-403"><a href="#Grace-403"><span class="linenos">403</span></a>        <span class="n">algo_kwargs_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Grace-404"><a href="#Grace-404"><span class="linenos">404</span></a>            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Grace-405"><a href="#Grace-405"><span class="linenos">405</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">algo_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Grace-406"><a href="#Grace-406"><span class="linenos">406</span></a>        <span class="p">)</span>
</span><span id="Grace-407"><a href="#Grace-407"><span class="linenos">407</span></a>
</span><span id="Grace-408"><a href="#Grace-408"><span class="linenos">408</span></a>        <span class="c1"># Cell relaxation</span>
</span><span id="Grace-409"><a href="#Grace-409"><span class="linenos">409</span></a>        <span class="n">relax_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;relax_cell&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="Grace-410"><a href="#Grace-410"><span class="linenos">410</span></a>        <span class="c1"># Cell relaxation kwargs ---&gt; see ase.constraints.ExpCellFilter</span>
</span><span id="Grace-411"><a href="#Grace-411"><span class="linenos">411</span></a>        <span class="n">relax_cell_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;relax_cell_kwargs&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Grace-412"><a href="#Grace-412"><span class="linenos">412</span></a>        <span class="c1"># Reformat dictionary to string</span>
</span><span id="Grace-413"><a href="#Grace-413"><span class="linenos">413</span></a>        <span class="n">relax_cell_kwargs_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Grace-414"><a href="#Grace-414"><span class="linenos">414</span></a>            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Grace-415"><a href="#Grace-415"><span class="linenos">415</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">relax_cell_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Grace-416"><a href="#Grace-416"><span class="linenos">416</span></a>        <span class="p">)</span>
</span><span id="Grace-417"><a href="#Grace-417"><span class="linenos">417</span></a>
</span><span id="Grace-418"><a href="#Grace-418"><span class="linenos">418</span></a>        <span class="c1"># Set parameters for minimization</span>
</span><span id="Grace-419"><a href="#Grace-419"><span class="linenos">419</span></a>        <span class="n">params_run</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;fmax=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;ionic_force_tolerance&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, steps=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> 
</span><span id="Grace-420"><a href="#Grace-420"><span class="linenos">420</span></a>
</span><span id="Grace-421"><a href="#Grace-421"><span class="linenos">421</span></a>        <span class="c1"># Save parameters in        </span>
</span><span id="Grace-422"><a href="#Grace-422"><span class="linenos">422</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;relax_cell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relax_cell</span>
</span><span id="Grace-423"><a href="#Grace-423"><span class="linenos">423</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">save_path</span>
</span><span id="Grace-424"><a href="#Grace-424"><span class="linenos">424</span></a>        
</span><span id="Grace-425"><a href="#Grace-425"><span class="linenos">425</span></a>        <span class="c1"># Somewhat hidden feature of adding custom fixes</span>
</span><span id="Grace-426"><a href="#Grace-426"><span class="linenos">426</span></a>        <span class="c1"># TODO: Document? Make it a more &quot;official&quot; paramerer?</span>
</span><span id="Grace-427"><a href="#Grace-427"><span class="linenos">427</span></a>        <span class="n">fixes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixes&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="Grace-428"><a href="#Grace-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fixes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Grace-429"><a href="#Grace-429"><span class="linenos">429</span></a>            <span class="n">fixes</span> <span class="o">=</span> <span class="p">[</span><span class="n">fixes</span><span class="p">]</span>
</span><span id="Grace-430"><a href="#Grace-430"><span class="linenos">430</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fixes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Grace-431"><a href="#Grace-431"><span class="linenos">431</span></a>            <span class="k">pass</span>
</span><span id="Grace-432"><a href="#Grace-432"><span class="linenos">432</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Grace-433"><a href="#Grace-433"><span class="linenos">433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Fixes are neither string or array of strings. Ignoring&#39;</span><span class="p">)</span>
</span><span id="Grace-434"><a href="#Grace-434"><span class="linenos">434</span></a>            <span class="n">fixes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Grace-435"><a href="#Grace-435"><span class="linenos">435</span></a>        <span class="n">fix_imports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fix_imports&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="Grace-436"><a href="#Grace-436"><span class="linenos">436</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fix_imports</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>                
</span><span id="Grace-437"><a href="#Grace-437"><span class="linenos">437</span></a>            <span class="n">fix_imports</span> <span class="o">=</span> <span class="p">[</span><span class="n">fix_imports</span><span class="p">]</span>
</span><span id="Grace-438"><a href="#Grace-438"><span class="linenos">438</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fix_imports</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Grace-439"><a href="#Grace-439"><span class="linenos">439</span></a>            <span class="k">pass</span>
</span><span id="Grace-440"><a href="#Grace-440"><span class="linenos">440</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Grace-441"><a href="#Grace-441"><span class="linenos">441</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Fix imports are neither string or array of strings. Ignoring&#39;</span><span class="p">)</span>
</span><span id="Grace-442"><a href="#Grace-442"><span class="linenos">442</span></a>            <span class="n">fix_imports</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Grace-443"><a href="#Grace-443"><span class="linenos">443</span></a>            
</span><span id="Grace-444"><a href="#Grace-444"><span class="linenos">444</span></a>        <span class="n">script</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Grace-445"><a href="#Grace-445"><span class="linenos">445</span></a>            <span class="s1">&#39;from tensorpotential.calculator import grace_fm&#39;</span><span class="p">,</span>
</span><span id="Grace-446"><a href="#Grace-446"><span class="linenos">446</span></a>            <span class="s1">&#39;from ase.io import read&#39;</span><span class="p">,</span>
</span><span id="Grace-447"><a href="#Grace-447"><span class="linenos">447</span></a>            <span class="s1">&#39;from ase.io.cif import write_cif&#39;</span><span class="p">,</span>
</span><span id="Grace-448"><a href="#Grace-448"><span class="linenos">448</span></a>            <span class="s1">&#39;from ase.io.trajectory import Trajectory&#39;</span><span class="p">,</span>
</span><span id="Grace-449"><a href="#Grace-449"><span class="linenos">449</span></a>            <span class="sa">f</span><span class="s1">&#39;from ase.optimize import </span><span class="si">{</span><span class="n">algo</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="Grace-450"><a href="#Grace-450"><span class="linenos">450</span></a>        <span class="p">]</span>
</span><span id="Grace-451"><a href="#Grace-451"><span class="linenos">451</span></a>        <span class="k">if</span> <span class="n">relax_cell</span><span class="p">:</span>
</span><span id="Grace-452"><a href="#Grace-452"><span class="linenos">452</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;from ase.constraints import ExpCellFilter as ECF&#39;</span><span class="p">]</span>
</span><span id="Grace-453"><a href="#Grace-453"><span class="linenos">453</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fix_imports</span><span class="p">:</span>
</span><span id="Grace-454"><a href="#Grace-454"><span class="linenos">454</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="n">f</span><span class="p">]</span>
</span><span id="Grace-455"><a href="#Grace-455"><span class="linenos">455</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
</span><span id="Grace-456"><a href="#Grace-456"><span class="linenos">456</span></a>
</span><span id="Grace-457"><a href="#Grace-457"><span class="linenos">457</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Grace-458"><a href="#Grace-458"><span class="linenos">458</span></a>            <span class="sa">f</span><span class="s1">&#39;struct = read(&quot;structure.cif&quot;)&#39;</span><span class="p">,</span>
</span><span id="Grace-459"><a href="#Grace-459"><span class="linenos">459</span></a>            <span class="sa">f</span><span class="s1">&#39;struct.calc = grace_fm(&quot;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">&quot;)&#39;</span>
</span><span id="Grace-460"><a href="#Grace-460"><span class="linenos">460</span></a>        <span class="p">]</span>
</span><span id="Grace-461"><a href="#Grace-461"><span class="linenos">461</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fixes</span><span class="p">:</span>
</span><span id="Grace-462"><a href="#Grace-462"><span class="linenos">462</span></a>            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;struct.set_constraint(</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="Grace-463"><a href="#Grace-463"><span class="linenos">463</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
</span><span id="Grace-464"><a href="#Grace-464"><span class="linenos">464</span></a>        
</span><span id="Grace-465"><a href="#Grace-465"><span class="linenos">465</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">relax_cell</span><span class="p">:</span>
</span><span id="Grace-466"><a href="#Grace-466"><span class="linenos">466</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Grace-467"><a href="#Grace-467"><span class="linenos">467</span></a>                <span class="sa">f</span><span class="s1">&#39;relaxation = </span><span class="si">{</span><span class="n">algo</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">(atoms=struct, </span><span class="si">{</span><span class="n">algo_kwargs_str</span><span class="si">}</span><span class="s1">).run(</span><span class="si">{</span><span class="n">params_run</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,]</span>
</span><span id="Grace-468"><a href="#Grace-468"><span class="linenos">468</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Grace-469"><a href="#Grace-469"><span class="linenos">469</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Grace-470"><a href="#Grace-470"><span class="linenos">470</span></a>                <span class="sa">f</span><span class="s1">&#39;relaxation = </span><span class="si">{</span><span class="n">algo</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">(ECF(atoms=struct, </span><span class="si">{</span><span class="n">relax_cell_kwargs_str</span><span class="si">}</span><span class="s1">), </span><span class="si">{</span><span class="n">algo_kwargs_str</span><span class="si">}</span><span class="s1">).run(</span><span class="si">{</span><span class="n">params_run</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span>
</span><span id="Grace-471"><a href="#Grace-471"><span class="linenos">471</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
</span><span id="Grace-472"><a href="#Grace-472"><span class="linenos">472</span></a>
</span><span id="Grace-473"><a href="#Grace-473"><span class="linenos">473</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;write_cif(&quot;final_structure.cif&quot;, struct)&#39;</span><span class="p">]</span>
</span><span id="Grace-474"><a href="#Grace-474"><span class="linenos">474</span></a>
</span><span id="Grace-475"><a href="#Grace-475"><span class="linenos">475</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s1">&#39;calc_script.py&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Grace-476"><a href="#Grace-476"><span class="linenos">476</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">script</span><span class="p">))</span>
</span><span id="Grace-477"><a href="#Grace-477"><span class="linenos">477</span></a>
</span><span id="Grace-478"><a href="#Grace-478"><span class="linenos">478</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_calc_minimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;error.out&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="Grace-479"><a href="#Grace-479"><span class="linenos">479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-480"><a href="#Grace-480"><span class="linenos">480</span></a><span class="sd">        Parse the output of a minimization.</span>
</span><span id="Grace-481"><a href="#Grace-481"><span class="linenos">481</span></a>
</span><span id="Grace-482"><a href="#Grace-482"><span class="linenos">482</span></a><span class="sd">        This function reads the minimization output file and returns the</span>
</span><span id="Grace-483"><a href="#Grace-483"><span class="linenos">483</span></a><span class="sd">        corresponding DataFrame containing the optimization step and energy information.</span>
</span><span id="Grace-484"><a href="#Grace-484"><span class="linenos">484</span></a>
</span><span id="Grace-485"><a href="#Grace-485"><span class="linenos">485</span></a><span class="sd">        Parameters</span>
</span><span id="Grace-486"><a href="#Grace-486"><span class="linenos">486</span></a><span class="sd">        ----------</span>
</span><span id="Grace-487"><a href="#Grace-487"><span class="linenos">487</span></a><span class="sd">        output : str, optional</span>
</span><span id="Grace-488"><a href="#Grace-488"><span class="linenos">488</span></a><span class="sd">            The name of the output file to parse, by default &#39;error.out&#39;.</span>
</span><span id="Grace-489"><a href="#Grace-489"><span class="linenos">489</span></a>
</span><span id="Grace-490"><a href="#Grace-490"><span class="linenos">490</span></a><span class="sd">        Returns</span>
</span><span id="Grace-491"><a href="#Grace-491"><span class="linenos">491</span></a><span class="sd">        -------</span>
</span><span id="Grace-492"><a href="#Grace-492"><span class="linenos">492</span></a><span class="sd">        pd.DataFrame or None</span>
</span><span id="Grace-493"><a href="#Grace-493"><span class="linenos">493</span></a><span class="sd">            A DataFrame containing the optimization results, or None if parsing fails.</span>
</span><span id="Grace-494"><a href="#Grace-494"><span class="linenos">494</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-495"><a href="#Grace-495"><span class="linenos">495</span></a>        <span class="c1"># ASE optimizer</span>
</span><span id="Grace-496"><a href="#Grace-496"><span class="linenos">496</span></a>        <span class="n">algo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;algo&#39;</span><span class="p">,</span> <span class="s1">&#39;FIRE&#39;</span><span class="p">)</span>
</span><span id="Grace-497"><a href="#Grace-497"><span class="linenos">497</span></a>
</span><span id="Grace-498"><a href="#Grace-498"><span class="linenos">498</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Grace-499"><a href="#Grace-499"><span class="linenos">499</span></a>            <span class="c1"># Find the header line dynamically</span>
</span><span id="Grace-500"><a href="#Grace-500"><span class="linenos">500</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">output</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Grace-501"><a href="#Grace-501"><span class="linenos">501</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="Grace-502"><a href="#Grace-502"><span class="linenos">502</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span><span id="Grace-503"><a href="#Grace-503"><span class="linenos">503</span></a>                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Step&#39;</span><span class="p">):</span>
</span><span id="Grace-504"><a href="#Grace-504"><span class="linenos">504</span></a>                    <span class="n">header_idx</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Grace-505"><a href="#Grace-505"><span class="linenos">505</span></a>                    <span class="k">break</span>
</span><span id="Grace-506"><a href="#Grace-506"><span class="linenos">506</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Grace-507"><a href="#Grace-507"><span class="linenos">507</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No table header found in </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="Grace-508"><a href="#Grace-508"><span class="linenos">508</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Grace-509"><a href="#Grace-509"><span class="linenos">509</span></a>
</span><span id="Grace-510"><a href="#Grace-510"><span class="linenos">510</span></a>            <span class="n">table_lines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Grace-511"><a href="#Grace-511"><span class="linenos">511</span></a>            <span class="c1"># Ensure that the line contains the expected algorithm</span>
</span><span id="Grace-512"><a href="#Grace-512"><span class="linenos">512</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">header_idx</span><span class="p">:]:</span>
</span><span id="Grace-513"><a href="#Grace-513"><span class="linenos">513</span></a>                <span class="k">if</span> <span class="n">algo</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;Step&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="Grace-514"><a href="#Grace-514"><span class="linenos">514</span></a>                    <span class="n">table_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="Grace-515"><a href="#Grace-515"><span class="linenos">515</span></a>
</span><span id="Grace-516"><a href="#Grace-516"><span class="linenos">516</span></a>            <span class="c1"># Read table into DataFrame</span>
</span><span id="Grace-517"><a href="#Grace-517"><span class="linenos">517</span></a>            <span class="n">table_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">table_lines</span><span class="p">)</span>
</span><span id="Grace-518"><a href="#Grace-518"><span class="linenos">518</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">table_str</span><span class="p">),</span>
</span><span id="Grace-519"><a href="#Grace-519"><span class="linenos">519</span></a>                             <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>
</span><span id="Grace-520"><a href="#Grace-520"><span class="linenos">520</span></a>
</span><span id="Grace-521"><a href="#Grace-521"><span class="linenos">521</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="Grace-522"><a href="#Grace-522"><span class="linenos">522</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Grace-523"><a href="#Grace-523"><span class="linenos">523</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot parse output from </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1"> file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Grace-524"><a href="#Grace-524"><span class="linenos">524</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Grace-525"><a href="#Grace-525"><span class="linenos">525</span></a>
</span><span id="Grace-526"><a href="#Grace-526"><span class="linenos">526</span></a>
</span><span id="Grace-527"><a href="#Grace-527"><span class="linenos">527</span></a>    <span class="c1">################################################</span>
</span><span id="Grace-528"><a href="#Grace-528"><span class="linenos">528</span></a>    <span class="c1">### --- IMPLEMENTATION OF MD CALCULATION --- ###</span>
</span><span id="Grace-529"><a href="#Grace-529"><span class="linenos">529</span></a>    <span class="c1">################################################</span>
</span><span id="Grace-530"><a href="#Grace-530"><span class="linenos">530</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_md</span><span class="p">(</span>
</span><span id="Grace-531"><a href="#Grace-531"><span class="linenos">531</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Grace-532"><a href="#Grace-532"><span class="linenos">532</span></a>        <span class="n">grace_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="o">*</span><span class="n">_grace_models</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GRACE-2L-OMAT&quot;</span><span class="p">,</span>
</span><span id="Grace-533"><a href="#Grace-533"><span class="linenos">533</span></a>        <span class="n">ensemble</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;NVT&quot;</span><span class="p">,</span> <span class="s2">&quot;nvt&quot;</span><span class="p">,</span> <span class="s2">&quot;Langevin&quot;</span><span class="p">,</span> <span class="s2">&quot;langevin&quot;</span><span class="p">,</span> <span class="s2">&quot;NPT&quot;</span><span class="p">,</span> <span class="s2">&quot;npt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NVT&quot;</span><span class="p">,</span> 
</span><span id="Grace-534"><a href="#Grace-534"><span class="linenos">534</span></a>        <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">300.0</span><span class="p">,</span>
</span><span id="Grace-535"><a href="#Grace-535"><span class="linenos">535</span></a>        <span class="n">starting_temperature</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Grace-536"><a href="#Grace-536"><span class="linenos">536</span></a>        <span class="n">pressure</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Grace-537"><a href="#Grace-537"><span class="linenos">537</span></a>        <span class="n">time_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="Grace-538"><a href="#Grace-538"><span class="linenos">538</span></a>        <span class="n">n_ionic_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="Grace-539"><a href="#Grace-539"><span class="linenos">539</span></a>        <span class="n">n_print</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Grace-540"><a href="#Grace-540"><span class="linenos">540</span></a>        <span class="n">temperature_damping_timescale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">,</span>
</span><span id="Grace-541"><a href="#Grace-541"><span class="linenos">541</span></a>        <span class="n">pressure_damping_timescale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Grace-542"><a href="#Grace-542"><span class="linenos">542</span></a>        <span class="n">trajectory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;md_run.traj&quot;</span><span class="p">,</span>
</span><span id="Grace-543"><a href="#Grace-543"><span class="linenos">543</span></a>        <span class="n">logfile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;md_run.log&quot;</span><span class="p">,</span>
</span><span id="Grace-544"><a href="#Grace-544"><span class="linenos">544</span></a>        <span class="n">random_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Grace-545"><a href="#Grace-545"><span class="linenos">545</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Grace-546"><a href="#Grace-546"><span class="linenos">546</span></a>    <span class="p">):</span>
</span><span id="Grace-547"><a href="#Grace-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-548"><a href="#Grace-548"><span class="linenos">548</span></a><span class="sd">        Run a molecular dynamics simulation using a GRACE foundation model.</span>
</span><span id="Grace-549"><a href="#Grace-549"><span class="linenos">549</span></a><span class="sd">    </span>
</span><span id="Grace-550"><a href="#Grace-550"><span class="linenos">550</span></a><span class="sd">        Parameters</span>
</span><span id="Grace-551"><a href="#Grace-551"><span class="linenos">551</span></a><span class="sd">        ----------</span>
</span><span id="Grace-552"><a href="#Grace-552"><span class="linenos">552</span></a><span class="sd">        grace_model : Literal[*_grace_models], optional</span>
</span><span id="Grace-553"><a href="#Grace-553"><span class="linenos">553</span></a><span class="sd">            GRACE model to use for the relaxation.  </span>
</span><span id="Grace-554"><a href="#Grace-554"><span class="linenos">554</span></a><span class="sd">            Must be one of the supported models, which can be obtained via </span>
</span><span id="Grace-555"><a href="#Grace-555"><span class="linenos">555</span></a><span class="sd">            :meth:`available_models`. Default is ``&quot;GRACE-2L-OMAT&quot;``.</span>
</span><span id="Grace-556"><a href="#Grace-556"><span class="linenos">556</span></a><span class="sd">    </span>
</span><span id="Grace-557"><a href="#Grace-557"><span class="linenos">557</span></a><span class="sd">        ensemble : {&quot;NVT&quot;, &quot;nvt&quot;, &quot;Langevin&quot;, &quot;langevin&quot;, &quot;NPT&quot;, &quot;npt&quot;}, optional</span>
</span><span id="Grace-558"><a href="#Grace-558"><span class="linenos">558</span></a><span class="sd">            Type of statistical ensemble:</span>
</span><span id="Grace-559"><a href="#Grace-559"><span class="linenos">559</span></a><span class="sd">            - &quot;NVT&quot; or &quot;Langevin&quot;: constant volume and temperature.</span>
</span><span id="Grace-560"><a href="#Grace-560"><span class="linenos">560</span></a><span class="sd">            - &quot;NPT&quot;: constant pressure and temperature.</span>
</span><span id="Grace-561"><a href="#Grace-561"><span class="linenos">561</span></a><span class="sd">            Case-insensitive (default is &quot;NVT&quot;).</span>
</span><span id="Grace-562"><a href="#Grace-562"><span class="linenos">562</span></a><span class="sd">    </span>
</span><span id="Grace-563"><a href="#Grace-563"><span class="linenos">563</span></a><span class="sd">        temperature : float, optional</span>
</span><span id="Grace-564"><a href="#Grace-564"><span class="linenos">564</span></a><span class="sd">            Target simulation temperature in Kelvin (default is 300.0).</span>
</span><span id="Grace-565"><a href="#Grace-565"><span class="linenos">565</span></a><span class="sd">    </span>
</span><span id="Grace-566"><a href="#Grace-566"><span class="linenos">566</span></a><span class="sd">        starting_temperature : int or None, optional</span>
</span><span id="Grace-567"><a href="#Grace-567"><span class="linenos">567</span></a><span class="sd">            Initial temperature of the system in Kelvin. If None, uses</span>
</span><span id="Grace-568"><a href="#Grace-568"><span class="linenos">568</span></a><span class="sd">            the target `temperature` (default is None).</span>
</span><span id="Grace-569"><a href="#Grace-569"><span class="linenos">569</span></a><span class="sd">    </span>
</span><span id="Grace-570"><a href="#Grace-570"><span class="linenos">570</span></a><span class="sd">        pressure : float or None, optional</span>
</span><span id="Grace-571"><a href="#Grace-571"><span class="linenos">571</span></a><span class="sd">            Target external pressure in GPa for NPT runs. Ignored if ensemble</span>
</span><span id="Grace-572"><a href="#Grace-572"><span class="linenos">572</span></a><span class="sd">            is NVT or Langevin (default is None).</span>
</span><span id="Grace-573"><a href="#Grace-573"><span class="linenos">573</span></a><span class="sd">    </span>
</span><span id="Grace-574"><a href="#Grace-574"><span class="linenos">574</span></a><span class="sd">        time_step : float, optional</span>
</span><span id="Grace-575"><a href="#Grace-575"><span class="linenos">575</span></a><span class="sd">            Integration time step in femtoseconds (default is 2.0 fs).</span>
</span><span id="Grace-576"><a href="#Grace-576"><span class="linenos">576</span></a><span class="sd">    </span>
</span><span id="Grace-577"><a href="#Grace-577"><span class="linenos">577</span></a><span class="sd">        n_ionic_steps : int, optional</span>
</span><span id="Grace-578"><a href="#Grace-578"><span class="linenos">578</span></a><span class="sd">            Number of MD steps to perform (default is 100).</span>
</span><span id="Grace-579"><a href="#Grace-579"><span class="linenos">579</span></a><span class="sd">    </span>
</span><span id="Grace-580"><a href="#Grace-580"><span class="linenos">580</span></a><span class="sd">        n_print : int, optional</span>
</span><span id="Grace-581"><a href="#Grace-581"><span class="linenos">581</span></a><span class="sd">            Frequency of log printing and trajectory writing (default is 10).</span>
</span><span id="Grace-582"><a href="#Grace-582"><span class="linenos">582</span></a><span class="sd">    </span>
</span><span id="Grace-583"><a href="#Grace-583"><span class="linenos">583</span></a><span class="sd">        temperature_damping_timescale : float, optional</span>
</span><span id="Grace-584"><a href="#Grace-584"><span class="linenos">584</span></a><span class="sd">            Thermostat coupling time in femtoseconds (default is 100.0 fs).</span>
</span><span id="Grace-585"><a href="#Grace-585"><span class="linenos">585</span></a><span class="sd">    </span>
</span><span id="Grace-586"><a href="#Grace-586"><span class="linenos">586</span></a><span class="sd">        pressure_damping_timescale : float or None, optional</span>
</span><span id="Grace-587"><a href="#Grace-587"><span class="linenos">587</span></a><span class="sd">            Barostat coupling time in femtoseconds. Only relevant for NPT runs</span>
</span><span id="Grace-588"><a href="#Grace-588"><span class="linenos">588</span></a><span class="sd">            (default is None).</span>
</span><span id="Grace-589"><a href="#Grace-589"><span class="linenos">589</span></a><span class="sd">    </span>
</span><span id="Grace-590"><a href="#Grace-590"><span class="linenos">590</span></a><span class="sd">        trajectory : str, optional</span>
</span><span id="Grace-591"><a href="#Grace-591"><span class="linenos">591</span></a><span class="sd">            Output trajectory file name (default is &quot;md_run.traj&quot;).</span>
</span><span id="Grace-592"><a href="#Grace-592"><span class="linenos">592</span></a><span class="sd">    </span>
</span><span id="Grace-593"><a href="#Grace-593"><span class="linenos">593</span></a><span class="sd">        logfile : str, optional</span>
</span><span id="Grace-594"><a href="#Grace-594"><span class="linenos">594</span></a><span class="sd">            Output log file name (default is &quot;md_run.log&quot;).</span>
</span><span id="Grace-595"><a href="#Grace-595"><span class="linenos">595</span></a><span class="sd">    </span>
</span><span id="Grace-596"><a href="#Grace-596"><span class="linenos">596</span></a><span class="sd">        random_seed : int or None, optional</span>
</span><span id="Grace-597"><a href="#Grace-597"><span class="linenos">597</span></a><span class="sd">            Seed for random velocity initialization. If None, system clock</span>
</span><span id="Grace-598"><a href="#Grace-598"><span class="linenos">598</span></a><span class="sd">            is used (default is None).</span>
</span><span id="Grace-599"><a href="#Grace-599"><span class="linenos">599</span></a><span class="sd">            </span>
</span><span id="Grace-600"><a href="#Grace-600"><span class="linenos">600</span></a><span class="sd">        mask : None, sequence of 3 ints (0/1), or (3,3) array-like, optional</span>
</span><span id="Grace-601"><a href="#Grace-601"><span class="linenos">601</span></a><span class="sd">            Specify which components of the computational box (strain tensor)</span>
</span><span id="Grace-602"><a href="#Grace-602"><span class="linenos">602</span></a><span class="sd">            are allowed to change under the barostat (default is None equalling</span>
</span><span id="Grace-603"><a href="#Grace-603"><span class="linenos">603</span></a><span class="sd">            to *No mask*). Only relevant for NPT simulations; it has no effect </span>
</span><span id="Grace-604"><a href="#Grace-604"><span class="linenos">604</span></a><span class="sd">            for NVT / Langevin ensembles.</span>
</span><span id="Grace-605"><a href="#Grace-605"><span class="linenos">605</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-606"><a href="#Grace-606"><span class="linenos">606</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;md&#39;</span>
</span><span id="Grace-607"><a href="#Grace-607"><span class="linenos">607</span></a>        <span class="n">ensemble</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="Grace-608"><a href="#Grace-608"><span class="linenos">608</span></a>        <span class="k">if</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;langevin&#39;</span><span class="p">,</span> <span class="s1">&#39;nvt&#39;</span><span class="p">]:</span> <span class="c1">#requested NVT, ignore NPT settings</span>
</span><span id="Grace-609"><a href="#Grace-609"><span class="linenos">609</span></a>            <span class="n">pressure</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Grace-610"><a href="#Grace-610"><span class="linenos">610</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Grace-611"><a href="#Grace-611"><span class="linenos">611</span></a>        <span class="k">if</span> <span class="n">pressure</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace-612"><a href="#Grace-612"><span class="linenos">612</span></a>            <span class="n">pressure_damping_timescale</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Grace-613"><a href="#Grace-613"><span class="linenos">613</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">calc_md</span><span class="p">(</span>
</span><span id="Grace-614"><a href="#Grace-614"><span class="linenos">614</span></a>            <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
</span><span id="Grace-615"><a href="#Grace-615"><span class="linenos">615</span></a>            <span class="n">pressure</span><span class="o">=</span><span class="n">pressure</span><span class="p">,</span>
</span><span id="Grace-616"><a href="#Grace-616"><span class="linenos">616</span></a>            <span class="n">n_ionic_steps</span><span class="o">=</span><span class="n">n_ionic_steps</span><span class="p">,</span>
</span><span id="Grace-617"><a href="#Grace-617"><span class="linenos">617</span></a>            <span class="n">time_step</span><span class="o">=</span><span class="n">time_step</span><span class="p">,</span>
</span><span id="Grace-618"><a href="#Grace-618"><span class="linenos">618</span></a>            <span class="n">n_print</span><span class="o">=</span><span class="n">n_print</span><span class="p">,</span>
</span><span id="Grace-619"><a href="#Grace-619"><span class="linenos">619</span></a>            <span class="n">temperature_damping_timescale</span><span class="o">=</span><span class="n">temperature_damping_timescale</span><span class="p">,</span>
</span><span id="Grace-620"><a href="#Grace-620"><span class="linenos">620</span></a>            <span class="n">pressure_damping_timescale</span><span class="o">=</span><span class="n">pressure_damping_timescale</span><span class="p">,</span>
</span><span id="Grace-621"><a href="#Grace-621"><span class="linenos">621</span></a>        <span class="p">)</span>
</span><span id="Grace-622"><a href="#Grace-622"><span class="linenos">622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grace_model</span>
</span><span id="Grace-623"><a href="#Grace-623"><span class="linenos">623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;ensemble&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="Grace-624"><a href="#Grace-624"><span class="linenos">624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;trajectory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trajectory</span>
</span><span id="Grace-625"><a href="#Grace-625"><span class="linenos">625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;logfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logfile</span> 
</span><span id="Grace-626"><a href="#Grace-626"><span class="linenos">626</span></a>        <span class="k">if</span> <span class="n">starting_temperature</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace-627"><a href="#Grace-627"><span class="linenos">627</span></a>            <span class="n">starting_temperature</span> <span class="o">=</span> <span class="n">temperature</span>
</span><span id="Grace-628"><a href="#Grace-628"><span class="linenos">628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;starting_temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">starting_temperature</span>
</span><span id="Grace-629"><a href="#Grace-629"><span class="linenos">629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;random_seed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_seed</span>
</span><span id="Grace-630"><a href="#Grace-630"><span class="linenos">630</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span>
</span><span id="Grace-631"><a href="#Grace-631"><span class="linenos">631</span></a>
</span><span id="Grace-632"><a href="#Grace-632"><span class="linenos">632</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_write_calc_md</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Grace-633"><a href="#Grace-633"><span class="linenos">633</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-634"><a href="#Grace-634"><span class="linenos">634</span></a><span class="sd">        Write the calculation script for performing molecular dynamics (MD).</span>
</span><span id="Grace-635"><a href="#Grace-635"><span class="linenos">635</span></a>
</span><span id="Grace-636"><a href="#Grace-636"><span class="linenos">636</span></a><span class="sd">        This method generates a Python script that uses CHGNet for running MD</span>
</span><span id="Grace-637"><a href="#Grace-637"><span class="linenos">637</span></a><span class="sd">        simulations and writes it to a file in the working directory.</span>
</span><span id="Grace-638"><a href="#Grace-638"><span class="linenos">638</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-639"><a href="#Grace-639"><span class="linenos">639</span></a>        <span class="c1"># Somewhat hidden feature of adding custom fixes</span>
</span><span id="Grace-640"><a href="#Grace-640"><span class="linenos">640</span></a>        <span class="c1"># TODO: Document? Make it a more &quot;official&quot; paramerer?</span>
</span><span id="Grace-641"><a href="#Grace-641"><span class="linenos">641</span></a>        <span class="n">fixes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fixes&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="Grace-642"><a href="#Grace-642"><span class="linenos">642</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fixes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Grace-643"><a href="#Grace-643"><span class="linenos">643</span></a>            <span class="n">fixes</span> <span class="o">=</span> <span class="p">[</span><span class="n">fixes</span><span class="p">]</span>
</span><span id="Grace-644"><a href="#Grace-644"><span class="linenos">644</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fixes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Grace-645"><a href="#Grace-645"><span class="linenos">645</span></a>            <span class="k">pass</span>
</span><span id="Grace-646"><a href="#Grace-646"><span class="linenos">646</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Grace-647"><a href="#Grace-647"><span class="linenos">647</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="Grace-648"><a href="#Grace-648"><span class="linenos">648</span></a>                <span class="s1">&#39;Fixes are neither string or array of strings. Ignoring&#39;</span><span class="p">)</span>
</span><span id="Grace-649"><a href="#Grace-649"><span class="linenos">649</span></a>            <span class="n">fixes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Grace-650"><a href="#Grace-650"><span class="linenos">650</span></a>        <span class="n">fix_imports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fix_imports&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="Grace-651"><a href="#Grace-651"><span class="linenos">651</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fix_imports</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Grace-652"><a href="#Grace-652"><span class="linenos">652</span></a>            <span class="n">fix_imports</span> <span class="o">=</span> <span class="p">[</span><span class="n">fix_imports</span><span class="p">]</span>
</span><span id="Grace-653"><a href="#Grace-653"><span class="linenos">653</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fix_imports</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Grace-654"><a href="#Grace-654"><span class="linenos">654</span></a>            <span class="k">pass</span>
</span><span id="Grace-655"><a href="#Grace-655"><span class="linenos">655</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Grace-656"><a href="#Grace-656"><span class="linenos">656</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="Grace-657"><a href="#Grace-657"><span class="linenos">657</span></a>                <span class="s1">&#39;fix_imports are neither string or array of strings. Ignoring&#39;</span><span class="p">)</span>
</span><span id="Grace-658"><a href="#Grace-658"><span class="linenos">658</span></a>            <span class="n">fix_imports</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Grace-659"><a href="#Grace-659"><span class="linenos">659</span></a>        
</span><span id="Grace-660"><a href="#Grace-660"><span class="linenos">660</span></a>        <span class="n">script</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Grace-661"><a href="#Grace-661"><span class="linenos">661</span></a>            <span class="s1">&#39;from tensorpotential.calculator import grace_fm&#39;</span><span class="p">,</span>
</span><span id="Grace-662"><a href="#Grace-662"><span class="linenos">662</span></a>            <span class="s1">&#39;from ase.md.velocitydistribution import MaxwellBoltzmannDistribution&#39;</span><span class="p">,</span>
</span><span id="Grace-663"><a href="#Grace-663"><span class="linenos">663</span></a>            <span class="s1">&#39;from ase.io import read&#39;</span><span class="p">,</span>
</span><span id="Grace-664"><a href="#Grace-664"><span class="linenos">664</span></a>            <span class="s1">&#39;from ase.io.cif import write_cif&#39;</span><span class="p">,</span>
</span><span id="Grace-665"><a href="#Grace-665"><span class="linenos">665</span></a>            <span class="s1">&#39;from ase.io.trajectory import Trajectory&#39;</span><span class="p">,</span>
</span><span id="Grace-666"><a href="#Grace-666"><span class="linenos">666</span></a>            <span class="s1">&#39;from ase import units&#39;</span>
</span><span id="Grace-667"><a href="#Grace-667"><span class="linenos">667</span></a>        <span class="p">]</span>
</span><span id="Grace-668"><a href="#Grace-668"><span class="linenos">668</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fix_imports</span><span class="p">:</span>
</span><span id="Grace-669"><a href="#Grace-669"><span class="linenos">669</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span><span class="n">f</span><span class="p">]</span>
</span><span id="Grace-670"><a href="#Grace-670"><span class="linenos">670</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Grace-671"><a href="#Grace-671"><span class="linenos">671</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="Grace-672"><a href="#Grace-672"><span class="linenos">672</span></a>            <span class="s1">&#39;struct = read(&quot;structure.cif&quot;)&#39;</span><span class="p">,]</span>
</span><span id="Grace-673"><a href="#Grace-673"><span class="linenos">673</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fixes</span><span class="p">:</span>
</span><span id="Grace-674"><a href="#Grace-674"><span class="linenos">674</span></a>            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;struct.set_constraint(</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="Grace-675"><a href="#Grace-675"><span class="linenos">675</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Grace-676"><a href="#Grace-676"><span class="linenos">676</span></a>            <span class="sa">f</span><span class="s1">&#39;calc = grace_fm(&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;)&#39;</span><span class="p">,</span>
</span><span id="Grace-677"><a href="#Grace-677"><span class="linenos">677</span></a>            <span class="s1">&#39;struct.calc = calc&#39;</span><span class="p">,</span>
</span><span id="Grace-678"><a href="#Grace-678"><span class="linenos">678</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="Grace-679"><a href="#Grace-679"><span class="linenos">679</span></a>        <span class="p">]</span>
</span><span id="Grace-680"><a href="#Grace-680"><span class="linenos">680</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;random_seed&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace-681"><a href="#Grace-681"><span class="linenos">681</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Grace-682"><a href="#Grace-682"><span class="linenos">682</span></a>                <span class="s1">&#39;import numpy as np&#39;</span><span class="p">,</span>
</span><span id="Grace-683"><a href="#Grace-683"><span class="linenos">683</span></a>                <span class="sa">f</span><span class="s1">&#39;np.random.seed(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;random_seed&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="Grace-684"><a href="#Grace-684"><span class="linenos">684</span></a>            <span class="p">]</span>
</span><span id="Grace-685"><a href="#Grace-685"><span class="linenos">685</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Grace-686"><a href="#Grace-686"><span class="linenos">686</span></a>            <span class="sa">f</span><span class="s1">&#39;MaxwellBoltzmannDistribution(struct, temperature_K=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;starting_temperature&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="Grace-687"><a href="#Grace-687"><span class="linenos">687</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="Grace-688"><a href="#Grace-688"><span class="linenos">688</span></a>        <span class="p">]</span>
</span><span id="Grace-689"><a href="#Grace-689"><span class="linenos">689</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;ensemble&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;langevin&#39;</span><span class="p">:</span>
</span><span id="Grace-690"><a href="#Grace-690"><span class="linenos">690</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Grace-691"><a href="#Grace-691"><span class="linenos">691</span></a>                <span class="s1">&#39;from ase.md.langevin import Langevin&#39;</span><span class="p">,</span>
</span><span id="Grace-692"><a href="#Grace-692"><span class="linenos">692</span></a>                <span class="sa">f</span><span class="s1">&#39;dyn = Langevin(struct, timestep=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;time_step&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, temperature_K=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, friction=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;temperature_damping_timescale&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="Grace-693"><a href="#Grace-693"><span class="linenos">693</span></a>                <span class="p">]</span>
</span><span id="Grace-694"><a href="#Grace-694"><span class="linenos">694</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Grace-695"><a href="#Grace-695"><span class="linenos">695</span></a>            <span class="n">pressure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span>
</span><span id="Grace-696"><a href="#Grace-696"><span class="linenos">696</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">pressure</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace-697"><a href="#Grace-697"><span class="linenos">697</span></a>                <span class="n">pressure</span> <span class="o">/=</span> <span class="n">EV_PER_ANG3_TO_GPA</span>
</span><span id="Grace-698"><a href="#Grace-698"><span class="linenos">698</span></a>            <span class="n">pfactor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;pressure_damping_timescale&quot;</span><span class="p">]</span>
</span><span id="Grace-699"><a href="#Grace-699"><span class="linenos">699</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">pfactor</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace-700"><a href="#Grace-700"><span class="linenos">700</span></a>                <span class="n">pfactor</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">pfactor</span><span class="si">}</span><span class="s1">*units.fs&#39;</span>
</span><span id="Grace-701"><a href="#Grace-701"><span class="linenos">701</span></a>            <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Grace-702"><a href="#Grace-702"><span class="linenos">702</span></a>                <span class="s1">&#39;from ase.md.npt import NPT&#39;</span><span class="p">,</span>                
</span><span id="Grace-703"><a href="#Grace-703"><span class="linenos">703</span></a>                <span class="sa">f</span><span class="s1">&#39;dyn = NPT(struct, timestep=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;time_step&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">*units.fs, temperature_K=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, ttime=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;temperature_damping_timescale&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">*units.fs, externalstress=</span><span class="si">{</span><span class="n">pressure</span><span class="si">}</span><span class="s1">, pfactor=</span><span class="si">{</span><span class="n">pfactor</span><span class="si">}</span><span class="s1"> , mask=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="Grace-704"><a href="#Grace-704"><span class="linenos">704</span></a>                <span class="p">]</span>
</span><span id="Grace-705"><a href="#Grace-705"><span class="linenos">705</span></a>        <span class="n">script</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Grace-706"><a href="#Grace-706"><span class="linenos">706</span></a>            <span class="sa">f</span><span class="s1">&#39;traj = Trajectory(&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;trajectory&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;, &quot;w&quot;, struct)&#39;</span><span class="p">,</span>
</span><span id="Grace-707"><a href="#Grace-707"><span class="linenos">707</span></a>            <span class="sa">f</span><span class="s1">&#39;dyn.attach(traj.write, interval=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;n_print&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="Grace-708"><a href="#Grace-708"><span class="linenos">708</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="Grace-709"><a href="#Grace-709"><span class="linenos">709</span></a>            <span class="sa">f</span><span class="s1">&#39;logfile = open(&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;logfile&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;, &quot;w&quot;)&#39;</span><span class="p">,</span>
</span><span id="Grace-710"><a href="#Grace-710"><span class="linenos">710</span></a>            <span class="s1">&#39;logfile.write(&quot;step</span><span class="se">\\</span><span class="s1">tTime</span><span class="se">\\</span><span class="s1">tEtot</span><span class="se">\\</span><span class="s1">tEpot</span><span class="se">\\</span><span class="s1">tEkin</span><span class="se">\\</span><span class="s1">tT</span><span class="se">\\</span><span class="s1">tVol</span><span class="se">\\</span><span class="s1">ta</span><span class="se">\\</span><span class="s1">tb</span><span class="se">\\</span><span class="s1">tc</span><span class="se">\\</span><span class="s1">tsigma_xx</span><span class="se">\\</span><span class="s1">tsigma_yy</span><span class="se">\\</span><span class="s1">tsigma_zz</span><span class="se">\\</span><span class="s1">tsigma_yz</span><span class="se">\\</span><span class="s1">tsigma_xz</span><span class="se">\\</span><span class="s1">tsigma_xy</span><span class="se">\\</span><span class="s1">n&quot;)&#39;</span><span class="p">,</span>
</span><span id="Grace-711"><a href="#Grace-711"><span class="linenos">711</span></a>            <span class="s1">&#39;def print_status():&#39;</span><span class="p">,</span>
</span><span id="Grace-712"><a href="#Grace-712"><span class="linenos">712</span></a>            <span class="s1">&#39;    values = [dyn.nsteps, dyn.nsteps*dyn.dt]&#39;</span><span class="p">,</span>
</span><span id="Grace-713"><a href="#Grace-713"><span class="linenos">713</span></a>            <span class="s1">&#39;    values += [struct.get_potential_energy()+struct.get_kinetic_energy()]&#39;</span><span class="p">,</span>
</span><span id="Grace-714"><a href="#Grace-714"><span class="linenos">714</span></a>            <span class="s1">&#39;    values += [struct.get_potential_energy(), struct.get_kinetic_energy()]&#39;</span><span class="p">,</span>
</span><span id="Grace-715"><a href="#Grace-715"><span class="linenos">715</span></a>            <span class="s1">&#39;    values += [struct.get_temperature()]&#39;</span><span class="p">,</span>
</span><span id="Grace-716"><a href="#Grace-716"><span class="linenos">716</span></a>            <span class="s1">&#39;    values += [struct.get_volume()]+list(struct.cell.lengths())&#39;</span><span class="p">,</span>
</span><span id="Grace-717"><a href="#Grace-717"><span class="linenos">717</span></a>            <span class="s1">&#39;    values += list(struct.get_stress())&#39;</span><span class="p">,</span>
</span><span id="Grace-718"><a href="#Grace-718"><span class="linenos">718</span></a>            <span class="s1">&#39;    status = &quot;</span><span class="se">\\</span><span class="s1">t&quot;.join(str(v) for v in values)&#39;</span><span class="p">,</span>
</span><span id="Grace-719"><a href="#Grace-719"><span class="linenos">719</span></a>            <span class="s1">&#39;    print(status)&#39;</span><span class="p">,</span>
</span><span id="Grace-720"><a href="#Grace-720"><span class="linenos">720</span></a>            <span class="s1">&#39;    logfile.write(status+&quot;</span><span class="se">\\</span><span class="s1">n&quot;)&#39;</span><span class="p">,</span>
</span><span id="Grace-721"><a href="#Grace-721"><span class="linenos">721</span></a>            <span class="s1">&#39;    logfile.flush()&#39;</span><span class="p">,</span>
</span><span id="Grace-722"><a href="#Grace-722"><span class="linenos">722</span></a>            <span class="sa">f</span><span class="s1">&#39;dyn.attach(print_status, interval=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;n_print&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="Grace-723"><a href="#Grace-723"><span class="linenos">723</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="Grace-724"><a href="#Grace-724"><span class="linenos">724</span></a>            <span class="sa">f</span><span class="s1">&#39;dyn.run(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s2">&quot;n_ionic_steps&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
</span><span id="Grace-725"><a href="#Grace-725"><span class="linenos">725</span></a>            <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="Grace-726"><a href="#Grace-726"><span class="linenos">726</span></a>            <span class="s1">&#39;write_cif(&quot;final_structure.cif&quot;, struct)&#39;</span>
</span><span id="Grace-727"><a href="#Grace-727"><span class="linenos">727</span></a>        <span class="p">]</span>
</span><span id="Grace-728"><a href="#Grace-728"><span class="linenos">728</span></a>
</span><span id="Grace-729"><a href="#Grace-729"><span class="linenos">729</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s1">&#39;calc_script.py&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Grace-730"><a href="#Grace-730"><span class="linenos">730</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">script</span><span class="p">))</span>
</span><span id="Grace-731"><a href="#Grace-731"><span class="linenos">731</span></a>
</span><span id="Grace-732"><a href="#Grace-732"><span class="linenos">732</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_calc_md</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;md_run.log&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="Grace-733"><a href="#Grace-733"><span class="linenos">733</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-734"><a href="#Grace-734"><span class="linenos">734</span></a><span class="sd">        Parse the output of a molecular dynamics (MD) simulation.</span>
</span><span id="Grace-735"><a href="#Grace-735"><span class="linenos">735</span></a>
</span><span id="Grace-736"><a href="#Grace-736"><span class="linenos">736</span></a><span class="sd">        This function reads the MD log file and returns the corresponding DataFrame</span>
</span><span id="Grace-737"><a href="#Grace-737"><span class="linenos">737</span></a><span class="sd">        containing time, total energy, potential energy, kinetic energy, and temperature.</span>
</span><span id="Grace-738"><a href="#Grace-738"><span class="linenos">738</span></a>
</span><span id="Grace-739"><a href="#Grace-739"><span class="linenos">739</span></a><span class="sd">        Parameters</span>
</span><span id="Grace-740"><a href="#Grace-740"><span class="linenos">740</span></a><span class="sd">        ----------</span>
</span><span id="Grace-741"><a href="#Grace-741"><span class="linenos">741</span></a><span class="sd">        output : str, optional</span>
</span><span id="Grace-742"><a href="#Grace-742"><span class="linenos">742</span></a><span class="sd">            The name of the MD log file to parse, by default &#39;md_run.log&#39;.</span>
</span><span id="Grace-743"><a href="#Grace-743"><span class="linenos">743</span></a>
</span><span id="Grace-744"><a href="#Grace-744"><span class="linenos">744</span></a><span class="sd">        Returns</span>
</span><span id="Grace-745"><a href="#Grace-745"><span class="linenos">745</span></a><span class="sd">        -------</span>
</span><span id="Grace-746"><a href="#Grace-746"><span class="linenos">746</span></a><span class="sd">        pd.DataFrame or None</span>
</span><span id="Grace-747"><a href="#Grace-747"><span class="linenos">747</span></a><span class="sd">            A DataFrame containing the MD simulation results, or None if parsing fails.</span>
</span><span id="Grace-748"><a href="#Grace-748"><span class="linenos">748</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-749"><a href="#Grace-749"><span class="linenos">749</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Grace-750"><a href="#Grace-750"><span class="linenos">750</span></a>            <span class="c1"># df = pd.read_csv(</span>
</span><span id="Grace-751"><a href="#Grace-751"><span class="linenos">751</span></a>            <span class="c1">#     os.path.join(self.working_directory, output),</span>
</span><span id="Grace-752"><a href="#Grace-752"><span class="linenos">752</span></a>            <span class="c1">#     skiprows=1,</span>
</span><span id="Grace-753"><a href="#Grace-753"><span class="linenos">753</span></a>            <span class="c1">#     sep=r&#39;\s+&#39;</span>
</span><span id="Grace-754"><a href="#Grace-754"><span class="linenos">754</span></a>            <span class="c1"># )</span>
</span><span id="Grace-755"><a href="#Grace-755"><span class="linenos">755</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="Grace-756"><a href="#Grace-756"><span class="linenos">756</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">output</span><span class="p">),</span>
</span><span id="Grace-757"><a href="#Grace-757"><span class="linenos">757</span></a>                <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\t+&quot;</span><span class="p">,</span> 
</span><span id="Grace-758"><a href="#Grace-758"><span class="linenos">758</span></a>                <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span>
</span><span id="Grace-759"><a href="#Grace-759"><span class="linenos">759</span></a>            <span class="p">)</span>
</span><span id="Grace-760"><a href="#Grace-760"><span class="linenos">760</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="Grace-761"><a href="#Grace-761"><span class="linenos">761</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Grace-762"><a href="#Grace-762"><span class="linenos">762</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot parse output from </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1"> file.&#39;</span><span class="p">)</span>
</span><span id="Grace-763"><a href="#Grace-763"><span class="linenos">763</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Grace-764"><a href="#Grace-764"><span class="linenos">764</span></a>
</span><span id="Grace-765"><a href="#Grace-765"><span class="linenos">765</span></a>    <span class="c1">###############################</span>
</span><span id="Grace-766"><a href="#Grace-766"><span class="linenos">766</span></a>    <span class="c1">### --- COMMON FUNCTION --- ###</span>
</span><span id="Grace-767"><a href="#Grace-767"><span class="linenos">767</span></a>    <span class="c1">###############################</span>
</span><span id="Grace-768"><a href="#Grace-768"><span class="linenos">768</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write_input</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace-769"><a href="#Grace-769"><span class="linenos">769</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-770"><a href="#Grace-770"><span class="linenos">770</span></a><span class="sd">        Write input files required for the Grace calculation.</span>
</span><span id="Grace-771"><a href="#Grace-771"><span class="linenos">771</span></a>
</span><span id="Grace-772"><a href="#Grace-772"><span class="linenos">772</span></a><span class="sd">        This function writes the structure file (`structure.cif`), stores the input</span>
</span><span id="Grace-773"><a href="#Grace-773"><span class="linenos">773</span></a><span class="sd">        dictionary to the HDF5 format, and delegates further writing depending on the</span>
</span><span id="Grace-774"><a href="#Grace-774"><span class="linenos">774</span></a><span class="sd">        calculation mode (MD or static/minimize).</span>
</span><span id="Grace-775"><a href="#Grace-775"><span class="linenos">775</span></a>
</span><span id="Grace-776"><a href="#Grace-776"><span class="linenos">776</span></a><span class="sd">        Returns</span>
</span><span id="Grace-777"><a href="#Grace-777"><span class="linenos">777</span></a><span class="sd">        -------</span>
</span><span id="Grace-778"><a href="#Grace-778"><span class="linenos">778</span></a><span class="sd">        None</span>
</span><span id="Grace-779"><a href="#Grace-779"><span class="linenos">779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-780"><a href="#Grace-780"><span class="linenos">780</span></a>        <span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s1">&#39;structure.cif&#39;</span><span class="p">),</span>
</span><span id="Grace-781"><a href="#Grace-781"><span class="linenos">781</span></a>              <span class="n">pyiron_to_ase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">))</span>
</span><span id="Grace-782"><a href="#Grace-782"><span class="linenos">782</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>
</span><span id="Grace-783"><a href="#Grace-783"><span class="linenos">783</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">:</span>
</span><span id="Grace-784"><a href="#Grace-784"><span class="linenos">784</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_calc_static</span><span class="p">()</span>
</span><span id="Grace-785"><a href="#Grace-785"><span class="linenos">785</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;minimize&#39;</span><span class="p">:</span>
</span><span id="Grace-786"><a href="#Grace-786"><span class="linenos">786</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_calc_minimize</span><span class="p">()</span>
</span><span id="Grace-787"><a href="#Grace-787"><span class="linenos">787</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;md&#39;</span><span class="p">:</span>
</span><span id="Grace-788"><a href="#Grace-788"><span class="linenos">788</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_calc_md</span><span class="p">()</span>
</span><span id="Grace-789"><a href="#Grace-789"><span class="linenos">789</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Grace-790"><a href="#Grace-790"><span class="linenos">790</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Grace-791"><a href="#Grace-791"><span class="linenos">791</span></a>                <span class="s2">&quot;No calculation type set. Use calc_static(), calc_minimize() or calc_md() first.&quot;</span><span class="p">)</span>
</span><span id="Grace-792"><a href="#Grace-792"><span class="linenos">792</span></a>            
</span><span id="Grace-793"><a href="#Grace-793"><span class="linenos">793</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collect_output</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace-794"><a href="#Grace-794"><span class="linenos">794</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-795"><a href="#Grace-795"><span class="linenos">795</span></a><span class="sd">        Collect and store the results of a calculation.</span>
</span><span id="Grace-796"><a href="#Grace-796"><span class="linenos">796</span></a><span class="sd">    </span>
</span><span id="Grace-797"><a href="#Grace-797"><span class="linenos">797</span></a><span class="sd">        This method parses the final structure, trajectory, and other output properties</span>
</span><span id="Grace-798"><a href="#Grace-798"><span class="linenos">798</span></a><span class="sd">        from the calculation and stores them in HDF5 format. The internal structure</span>
</span><span id="Grace-799"><a href="#Grace-799"><span class="linenos">799</span></a><span class="sd">        is updated, and various properties such as energies, structure, forces, and </span>
</span><span id="Grace-800"><a href="#Grace-800"><span class="linenos">800</span></a><span class="sd">        stresses are saved to the output group.</span>
</span><span id="Grace-801"><a href="#Grace-801"><span class="linenos">801</span></a><span class="sd">    </span>
</span><span id="Grace-802"><a href="#Grace-802"><span class="linenos">802</span></a><span class="sd">        Returns</span>
</span><span id="Grace-803"><a href="#Grace-803"><span class="linenos">803</span></a><span class="sd">        -------</span>
</span><span id="Grace-804"><a href="#Grace-804"><span class="linenos">804</span></a><span class="sd">        None</span>
</span><span id="Grace-805"><a href="#Grace-805"><span class="linenos">805</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-806"><a href="#Grace-806"><span class="linenos">806</span></a>
</span><span id="Grace-807"><a href="#Grace-807"><span class="linenos">807</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">voigt_to_tensor</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="Grace-808"><a href="#Grace-808"><span class="linenos">808</span></a>            <span class="c1"># s is a 6-element array from atoms.get_stress()</span>
</span><span id="Grace-809"><a href="#Grace-809"><span class="linenos">809</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
</span><span id="Grace-810"><a href="#Grace-810"><span class="linenos">810</span></a>                <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
</span><span id="Grace-811"><a href="#Grace-811"><span class="linenos">811</span></a>                <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
</span><span id="Grace-812"><a href="#Grace-812"><span class="linenos">812</span></a>                <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span><span id="Grace-813"><a href="#Grace-813"><span class="linenos">813</span></a>            <span class="p">])</span>
</span><span id="Grace-814"><a href="#Grace-814"><span class="linenos">814</span></a>
</span><span id="Grace-815"><a href="#Grace-815"><span class="linenos">815</span></a>        <span class="n">relaxed_ase_structure</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span>
</span><span id="Grace-816"><a href="#Grace-816"><span class="linenos">816</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s1">&#39;final_structure.cif&#39;</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;cif&#39;</span><span class="p">)</span>
</span><span id="Grace-817"><a href="#Grace-817"><span class="linenos">817</span></a>        <span class="n">relaxed_pyiron_structure</span> <span class="o">=</span> <span class="n">ase_to_pyiron</span><span class="p">(</span><span class="n">relaxed_ase_structure</span><span class="p">)</span>
</span><span id="Grace-818"><a href="#Grace-818"><span class="linenos">818</span></a>
</span><span id="Grace-819"><a href="#Grace-819"><span class="linenos">819</span></a>        <span class="c1"># Store the relaxed structure in the HDF5 group</span>
</span><span id="Grace-820"><a href="#Grace-820"><span class="linenos">820</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace-821"><a href="#Grace-821"><span class="linenos">821</span></a>            <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;structure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relaxed_pyiron_structure</span>
</span><span id="Grace-822"><a href="#Grace-822"><span class="linenos">822</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">relaxed_pyiron_structure</span>  <span class="c1"># Update the job&#39;s structure</span>
</span><span id="Grace-823"><a href="#Grace-823"><span class="linenos">823</span></a>
</span><span id="Grace-824"><a href="#Grace-824"><span class="linenos">824</span></a>        <span class="c1"># Parse trajectory from minimize</span>
</span><span id="Grace-825"><a href="#Grace-825"><span class="linenos">825</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;minimize&#39;</span><span class="p">,</span> <span class="s1">&#39;md&#39;</span><span class="p">]:</span>
</span><span id="Grace-826"><a href="#Grace-826"><span class="linenos">826</span></a>            <span class="c1"># For minimize and md, we expect a trajectory file with the relaxed structure</span>
</span><span id="Grace-827"><a href="#Grace-827"><span class="linenos">827</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;minimize&#39;</span><span class="p">:</span>
</span><span id="Grace-828"><a href="#Grace-828"><span class="linenos">828</span></a>                <span class="n">traj_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span>
</span><span id="Grace-829"><a href="#Grace-829"><span class="linenos">829</span></a>                <span class="n">traj</span> <span class="o">=</span> <span class="n">Trajectory</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">traj_file</span><span class="p">))</span>
</span><span id="Grace-830"><a href="#Grace-830"><span class="linenos">830</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Grace-831"><a href="#Grace-831"><span class="linenos">831</span></a>                <span class="n">traj_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;trajectory&#39;</span><span class="p">]</span>
</span><span id="Grace-832"><a href="#Grace-832"><span class="linenos">832</span></a>                <span class="n">traj</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">traj_file</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span id="Grace-833"><a href="#Grace-833"><span class="linenos">833</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Grace-834"><a href="#Grace-834"><span class="linenos">834</span></a>                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace-835"><a href="#Grace-835"><span class="linenos">835</span></a>                    <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">])</span>
</span><span id="Grace-836"><a href="#Grace-836"><span class="linenos">836</span></a>                    <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">positions</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">])</span>
</span><span id="Grace-837"><a href="#Grace-837"><span class="linenos">837</span></a>                    <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;stresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Grace-838"><a href="#Grace-838"><span class="linenos">838</span></a>                        <span class="p">[</span><span class="n">voigt_to_tensor</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">get_stress</span><span class="p">())</span><span class="o">*</span><span class="n">EV_PER_ANG3_TO_GPA</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">])</span>
</span><span id="Grace-839"><a href="#Grace-839"><span class="linenos">839</span></a>                    <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">get_forces</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">])</span>
</span><span id="Grace-840"><a href="#Grace-840"><span class="linenos">840</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Grace-841"><a href="#Grace-841"><span class="linenos">841</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="Grace-842"><a href="#Grace-842"><span class="linenos">842</span></a>                    <span class="sa">f</span><span class="s1">&#39;Cannot parse output from </span><span class="si">{</span><span class="n">traj_file</span><span class="si">}</span><span class="s1"> file.&#39;</span><span class="p">)</span>
</span><span id="Grace-843"><a href="#Grace-843"><span class="linenos">843</span></a>        
</span><span id="Grace-844"><a href="#Grace-844"><span class="linenos">844</span></a>        <span class="c1"># Parse other properties</span>
</span><span id="Grace-845"><a href="#Grace-845"><span class="linenos">845</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">:</span>
</span><span id="Grace-846"><a href="#Grace-846"><span class="linenos">846</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_calc_static</span><span class="p">()</span>  
</span><span id="Grace-847"><a href="#Grace-847"><span class="linenos">847</span></a>            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;max_force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="Grace-848"><a href="#Grace-848"><span class="linenos">848</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace-849"><a href="#Grace-849"><span class="linenos">849</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-850"><a href="#Grace-850"><span class="linenos">850</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_tot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-851"><a href="#Grace-851"><span class="linenos">851</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-852"><a href="#Grace-852"><span class="linenos">852</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;max_force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;max_force&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-853"><a href="#Grace-853"><span class="linenos">853</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;stresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Grace-854"><a href="#Grace-854"><span class="linenos">854</span></a>                    <span class="p">[</span><span class="n">voigt_to_tensor</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">EV_PER_ANG3_TO_GPA</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stresses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
</span><span id="Grace-855"><a href="#Grace-855"><span class="linenos">855</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-856"><a href="#Grace-856"><span class="linenos">856</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">relaxed_pyiron_structure</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()])</span>
</span><span id="Grace-857"><a href="#Grace-857"><span class="linenos">857</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">relaxed_pyiron_structure</span><span class="o">.</span><span class="n">positions</span><span class="p">])</span>
</span><span id="Grace-858"><a href="#Grace-858"><span class="linenos">858</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;minimize&#39;</span><span class="p">:</span>
</span><span id="Grace-859"><a href="#Grace-859"><span class="linenos">859</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_calc_minimize</span><span class="p">()</span>
</span><span id="Grace-860"><a href="#Grace-860"><span class="linenos">860</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace-861"><a href="#Grace-861"><span class="linenos">861</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-862"><a href="#Grace-862"><span class="linenos">862</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_tot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-863"><a href="#Grace-863"><span class="linenos">863</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;max_force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-864"><a href="#Grace-864"><span class="linenos">864</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Step&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>        
</span><span id="Grace-865"><a href="#Grace-865"><span class="linenos">865</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;md&#39;</span><span class="p">:</span>
</span><span id="Grace-866"><a href="#Grace-866"><span class="linenos">866</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_calc_md</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;logfile&#39;</span><span class="p">])</span>
</span><span id="Grace-867"><a href="#Grace-867"><span class="linenos">867</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace-868"><a href="#Grace-868"><span class="linenos">868</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Epot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-869"><a href="#Grace-869"><span class="linenos">869</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_tot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Etot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-870"><a href="#Grace-870"><span class="linenos">870</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_kin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Ekin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-871"><a href="#Grace-871"><span class="linenos">871</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-872"><a href="#Grace-872"><span class="linenos">872</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-873"><a href="#Grace-873"><span class="linenos">873</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace-874"><a href="#Grace-874"><span class="linenos">874</span></a>
</span><span id="Grace-875"><a href="#Grace-875"><span class="linenos">875</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compress</span><span class="p">()</span>
</span><span id="Grace-876"><a href="#Grace-876"><span class="linenos">876</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Grace-877"><a href="#Grace-877"><span class="linenos">877</span></a>
</span><span id="Grace-878"><a href="#Grace-878"><span class="linenos">878</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Atoms</span><span class="p">:</span>
</span><span id="Grace-879"><a href="#Grace-879"><span class="linenos">879</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-880"><a href="#Grace-880"><span class="linenos">880</span></a><span class="sd">        Retrieve the structure at a given frame from the calculation output.</span>
</span><span id="Grace-881"><a href="#Grace-881"><span class="linenos">881</span></a>
</span><span id="Grace-882"><a href="#Grace-882"><span class="linenos">882</span></a><span class="sd">        This function returns the atomic structure (positions, cell, species) at the</span>
</span><span id="Grace-883"><a href="#Grace-883"><span class="linenos">883</span></a><span class="sd">        specified frame index. The frame index is adjusted to ensure it is valid.</span>
</span><span id="Grace-884"><a href="#Grace-884"><span class="linenos">884</span></a>
</span><span id="Grace-885"><a href="#Grace-885"><span class="linenos">885</span></a><span class="sd">        Parameters</span>
</span><span id="Grace-886"><a href="#Grace-886"><span class="linenos">886</span></a><span class="sd">        ----------</span>
</span><span id="Grace-887"><a href="#Grace-887"><span class="linenos">887</span></a><span class="sd">        frame : int, optional</span>
</span><span id="Grace-888"><a href="#Grace-888"><span class="linenos">888</span></a><span class="sd">            The frame index to retrieve. If negative, it is counted from the last frame,</span>
</span><span id="Grace-889"><a href="#Grace-889"><span class="linenos">889</span></a><span class="sd">            by default -1.</span>
</span><span id="Grace-890"><a href="#Grace-890"><span class="linenos">890</span></a>
</span><span id="Grace-891"><a href="#Grace-891"><span class="linenos">891</span></a><span class="sd">        Returns</span>
</span><span id="Grace-892"><a href="#Grace-892"><span class="linenos">892</span></a><span class="sd">        -------</span>
</span><span id="Grace-893"><a href="#Grace-893"><span class="linenos">893</span></a><span class="sd">        Atoms</span>
</span><span id="Grace-894"><a href="#Grace-894"><span class="linenos">894</span></a><span class="sd">            The ASE Atoms object representing the structure at the given frame.</span>
</span><span id="Grace-895"><a href="#Grace-895"><span class="linenos">895</span></a>
</span><span id="Grace-896"><a href="#Grace-896"><span class="linenos">896</span></a><span class="sd">        Raises</span>
</span><span id="Grace-897"><a href="#Grace-897"><span class="linenos">897</span></a><span class="sd">        ------</span>
</span><span id="Grace-898"><a href="#Grace-898"><span class="linenos">898</span></a><span class="sd">        ValueError</span>
</span><span id="Grace-899"><a href="#Grace-899"><span class="linenos">899</span></a><span class="sd">            If no structures are found in the job output.</span>
</span><span id="Grace-900"><a href="#Grace-900"><span class="linenos">900</span></a><span class="sd">        IndexError</span>
</span><span id="Grace-901"><a href="#Grace-901"><span class="linenos">901</span></a><span class="sd">            If the frame index is out of range.</span>
</span><span id="Grace-902"><a href="#Grace-902"><span class="linenos">902</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-903"><a href="#Grace-903"><span class="linenos">903</span></a>        <span class="n">num_structures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_structures</span>
</span><span id="Grace-904"><a href="#Grace-904"><span class="linenos">904</span></a>        <span class="k">if</span> <span class="n">num_structures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Grace-905"><a href="#Grace-905"><span class="linenos">905</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No structures found in the job output.&quot;</span><span class="p">)</span>
</span><span id="Grace-906"><a href="#Grace-906"><span class="linenos">906</span></a>
</span><span id="Grace-907"><a href="#Grace-907"><span class="linenos">907</span></a>        <span class="c1"># Ensure frame is valid</span>
</span><span id="Grace-908"><a href="#Grace-908"><span class="linenos">908</span></a>        <span class="k">if</span> <span class="n">frame</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Grace-909"><a href="#Grace-909"><span class="linenos">909</span></a>            <span class="n">frame</span> <span class="o">+=</span> <span class="n">num_structures</span>
</span><span id="Grace-910"><a href="#Grace-910"><span class="linenos">910</span></a>        <span class="k">if</span> <span class="n">frame</span> <span class="o">&gt;=</span> <span class="n">num_structures</span><span class="p">:</span>
</span><span id="Grace-911"><a href="#Grace-911"><span class="linenos">911</span></a>            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Grace-912"><a href="#Grace-912"><span class="linenos">912</span></a>                <span class="sa">f</span><span class="s2">&quot;Frame </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s2"> is out of range for </span><span class="si">{</span><span class="n">num_structures</span><span class="si">}</span><span class="s2"> structures.&quot;</span><span class="p">)</span>
</span><span id="Grace-913"><a href="#Grace-913"><span class="linenos">913</span></a>
</span><span id="Grace-914"><a href="#Grace-914"><span class="linenos">914</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace-915"><a href="#Grace-915"><span class="linenos">915</span></a>            <span class="n">positions</span> <span class="o">=</span> <span class="n">h5out</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="n">frame</span><span class="p">]</span>
</span><span id="Grace-916"><a href="#Grace-916"><span class="linenos">916</span></a>            <span class="n">cell</span> <span class="o">=</span> <span class="n">h5out</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">][</span><span class="n">frame</span><span class="p">]</span>
</span><span id="Grace-917"><a href="#Grace-917"><span class="linenos">917</span></a>        <span class="c1"># Read positions and cell</span>
</span><span id="Grace-918"><a href="#Grace-918"><span class="linenos">918</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/structure&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace-919"><a href="#Grace-919"><span class="linenos">919</span></a>            <span class="n">species</span> <span class="o">=</span> <span class="n">h5out</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">]</span>
</span><span id="Grace-920"><a href="#Grace-920"><span class="linenos">920</span></a>            <span class="n">indices</span> <span class="o">=</span> <span class="n">h5out</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span>
</span><span id="Grace-921"><a href="#Grace-921"><span class="linenos">921</span></a>
</span><span id="Grace-922"><a href="#Grace-922"><span class="linenos">922</span></a>        <span class="c1"># Generate symbols list</span>
</span><span id="Grace-923"><a href="#Grace-923"><span class="linenos">923</span></a>        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
</span><span id="Grace-924"><a href="#Grace-924"><span class="linenos">924</span></a>        <span class="k">return</span> <span class="n">ase_to_pyiron</span><span class="p">(</span><span class="n">Atoms</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span><span id="Grace-925"><a href="#Grace-925"><span class="linenos">925</span></a>
</span><span id="Grace-926"><a href="#Grace-926"><span class="linenos">926</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files_to_compress</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Grace-927"><a href="#Grace-927"><span class="linenos">927</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace-928"><a href="#Grace-928"><span class="linenos">928</span></a><span class="sd">        Compress the output files of a job object.</span>
</span><span id="Grace-929"><a href="#Grace-929"><span class="linenos">929</span></a><span class="sd">    </span>
</span><span id="Grace-930"><a href="#Grace-930"><span class="linenos">930</span></a><span class="sd">        Args:</span>
</span><span id="Grace-931"><a href="#Grace-931"><span class="linenos">931</span></a><span class="sd">            files_to_compress (list): A list of files to compress (optional)</span>
</span><span id="Grace-932"><a href="#Grace-932"><span class="linenos">932</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace-933"><a href="#Grace-933"><span class="linenos">933</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="Grace-934"><a href="#Grace-934"><span class="linenos">934</span></a>        <span class="c1"># delete empty files</span>
</span><span id="Grace-935"><a href="#Grace-935"><span class="linenos">935</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
</span><span id="Grace-936"><a href="#Grace-936"><span class="linenos">936</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Grace-937"><a href="#Grace-937"><span class="linenos">937</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Grace-938"><a href="#Grace-938"><span class="linenos">938</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Grace-939"><a href="#Grace-939"><span class="linenos">939</span></a>        <span class="c1"># delete slurm scripts</span>
</span><span id="Grace-940"><a href="#Grace-940"><span class="linenos">940</span></a>        <span class="k">if</span> <span class="s2">&quot;run_queue.sh&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
</span><span id="Grace-941"><a href="#Grace-941"><span class="linenos">941</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s2">&quot;run_queue.sh&quot;</span><span class="p">)</span>
</span><span id="Grace-942"><a href="#Grace-942"><span class="linenos">942</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Grace-943"><a href="#Grace-943"><span class="linenos">943</span></a>        <span class="c1"># compress all remaining files</span>
</span><span id="Grace-944"><a href="#Grace-944"><span class="linenos">944</span></a>        <span class="k">if</span> <span class="n">files_to_compress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace-945"><a href="#Grace-945"><span class="linenos">945</span></a>            <span class="n">files_to_compress</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Grace-946"><a href="#Grace-946"><span class="linenos">946</span></a>                <span class="n">f</span>
</span><span id="Grace-947"><a href="#Grace-947"><span class="linenos">947</span></a>                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</span><span id="Grace-948"><a href="#Grace-948"><span class="linenos">948</span></a>                <span class="k">if</span> <span class="n">f</span>
</span><span id="Grace-949"><a href="#Grace-949"><span class="linenos">949</span></a>                <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="Grace-950"><a href="#Grace-950"><span class="linenos">950</span></a>                    <span class="s2">&quot;final_structure.cif&quot;</span><span class="p">,</span>
</span><span id="Grace-951"><a href="#Grace-951"><span class="linenos">951</span></a>                <span class="p">]</span>
</span><span id="Grace-952"><a href="#Grace-952"><span class="linenos">952</span></a>            <span class="p">]</span>
</span><span id="Grace-953"><a href="#Grace-953"><span class="linenos">953</span></a>        
</span><span id="Grace-954"><a href="#Grace-954"><span class="linenos">954</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Grace</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">files_to_compress</span><span class="o">=</span><span class="n">files_to_compress</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Custom job class for using Grace within the pyiron framework.</p>

<p>This class provides methods to perform static calculations, structure relaxation,
and molecular dynamics simulations using Grace UMLIPs.</p>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>structure</strong> (pyiron.atomistics.structure.atoms.Atoms):
Structure associated with the job.</li>
<li><strong>input</strong> (CalcParams):
Input parameters for the Grace calculations.</li>
</ul>
</div>


                            <div id="Grace.__init__" class="classattr">
                                        <input id="Grace.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Grace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">project</span>, </span><span class="param"><span class="n">job_name</span></span>)</span>

                <label class="view-source-button" for="Grace.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace.__init__-56"><a href="#Grace.__init__-56"><span class="linenos">56</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">job_name</span><span class="p">):</span>
</span><span id="Grace.__init__-57"><a href="#Grace.__init__-57"><span class="linenos">57</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace.__init__-58"><a href="#Grace.__init__-58"><span class="linenos">58</span></a><span class="sd">        Initialize the Grace job.</span>
</span><span id="Grace.__init__-59"><a href="#Grace.__init__-59"><span class="linenos">59</span></a>
</span><span id="Grace.__init__-60"><a href="#Grace.__init__-60"><span class="linenos">60</span></a><span class="sd">        Parameters</span>
</span><span id="Grace.__init__-61"><a href="#Grace.__init__-61"><span class="linenos">61</span></a><span class="sd">        ----------</span>
</span><span id="Grace.__init__-62"><a href="#Grace.__init__-62"><span class="linenos">62</span></a><span class="sd">        project : pyiron.Project</span>
</span><span id="Grace.__init__-63"><a href="#Grace.__init__-63"><span class="linenos">63</span></a><span class="sd">            The pyiron project in which the job resides.</span>
</span><span id="Grace.__init__-64"><a href="#Grace.__init__-64"><span class="linenos">64</span></a><span class="sd">        job_name : str</span>
</span><span id="Grace.__init__-65"><a href="#Grace.__init__-65"><span class="linenos">65</span></a><span class="sd">            Name of the job.</span>
</span><span id="Grace.__init__-66"><a href="#Grace.__init__-66"><span class="linenos">66</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace.__init__-67"><a href="#Grace.__init__-67"><span class="linenos">67</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Grace</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">job_name</span><span class="p">)</span>
</span><span id="Grace.__init__-68"><a href="#Grace.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Grace.__init__-69"><a href="#Grace.__init__-69"><span class="linenos">69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">CalcParams</span><span class="p">()</span>
</span><span id="Grace.__init__-70"><a href="#Grace.__init__-70"><span class="linenos">70</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">file_exists</span><span class="p">:</span>
</span><span id="Grace.__init__-71"><a href="#Grace.__init__-71"><span class="linenos">71</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>
</span><span id="Grace.__init__-72"><a href="#Grace.__init__-72"><span class="linenos">72</span></a>        <span class="c1"># executable is in pyiron_resources/grace/bin</span>
</span><span id="Grace.__init__-73"><a href="#Grace.__init__-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_executable_activate</span><span class="p">(</span><span class="n">codename</span><span class="o">=</span><span class="s1">&#39;grace&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the Grace job.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>project</strong> (pyiron.Project):
The pyiron project in which the job resides.</li>
<li><strong>job_name</strong> (str):
Name of the job.</li>
</ul>
</div>


                            </div>
                            <div id="Grace.structure" class="classattr">
                                        <input id="Grace.structure-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">structure</span>

                <label class="view-source-button" for="Grace.structure-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace.structure"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace.structure-147"><a href="#Grace.structure-147"><span class="linenos">147</span></a>    <span class="nd">@property</span>
</span><span id="Grace.structure-148"><a href="#Grace.structure-148"><span class="linenos">148</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Grace.structure-149"><a href="#Grace.structure-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace.structure-150"><a href="#Grace.structure-150"><span class="linenos">150</span></a>
</span><span id="Grace.structure-151"><a href="#Grace.structure-151"><span class="linenos">151</span></a><span class="sd">        Returns:</span>
</span><span id="Grace.structure-152"><a href="#Grace.structure-152"><span class="linenos">152</span></a>
</span><span id="Grace.structure-153"><a href="#Grace.structure-153"><span class="linenos">153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace.structure-154"><a href="#Grace.structure-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_structure</span>
</span></pre></div>


            <div class="docstring"><p>Returns:</p>
</div>


                            </div>
                            <div id="Grace.input" class="classattr">
                                <div class="attr variable">
            <span class="name">input</span>

        
    </div>
    <a class="headerlink" href="#Grace.input"></a>
    
    

                            </div>
                            <div id="Grace.fmax" class="classattr">
                                        <input id="Grace.fmax-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">fmax</span><span class="annotation">: float</span>

                <label class="view-source-button" for="Grace.fmax-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace.fmax"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace.fmax-75"><a href="#Grace.fmax-75"><span class="linenos">75</span></a>    <span class="nd">@property</span>
</span><span id="Grace.fmax-76"><a href="#Grace.fmax-76"><span class="linenos">76</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fmax</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Grace.fmax-77"><a href="#Grace.fmax-77"><span class="linenos">77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace.fmax-78"><a href="#Grace.fmax-78"><span class="linenos">78</span></a><span class="sd">        Maximum force tolerance for ionic relaxation.</span>
</span><span id="Grace.fmax-79"><a href="#Grace.fmax-79"><span class="linenos">79</span></a>
</span><span id="Grace.fmax-80"><a href="#Grace.fmax-80"><span class="linenos">80</span></a><span class="sd">        This property controls the maximum force tolerance (in eV/Å) used during ionic relaxation.</span>
</span><span id="Grace.fmax-81"><a href="#Grace.fmax-81"><span class="linenos">81</span></a>
</span><span id="Grace.fmax-82"><a href="#Grace.fmax-82"><span class="linenos">82</span></a><span class="sd">        Returns</span>
</span><span id="Grace.fmax-83"><a href="#Grace.fmax-83"><span class="linenos">83</span></a><span class="sd">        -------</span>
</span><span id="Grace.fmax-84"><a href="#Grace.fmax-84"><span class="linenos">84</span></a><span class="sd">        float</span>
</span><span id="Grace.fmax-85"><a href="#Grace.fmax-85"><span class="linenos">85</span></a><span class="sd">            Maximum force tolerance (eV/Å).</span>
</span><span id="Grace.fmax-86"><a href="#Grace.fmax-86"><span class="linenos">86</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace.fmax-87"><a href="#Grace.fmax-87"><span class="linenos">87</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;ionic_force_tolerance&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Maximum force tolerance for ionic relaxation.</p>

<p>This property controls the maximum force tolerance (in eV/Å) used during ionic relaxation.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: Maximum force tolerance (eV/Å).</li>
</ul>
</div>


                            </div>
                            <div id="Grace.max_iter" class="classattr">
                                        <input id="Grace.max_iter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">max_iter</span><span class="annotation">: int</span>

                <label class="view-source-button" for="Grace.max_iter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace.max_iter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace.max_iter-101"><a href="#Grace.max_iter-101"><span class="linenos">101</span></a>    <span class="nd">@property</span>
</span><span id="Grace.max_iter-102"><a href="#Grace.max_iter-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">max_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Grace.max_iter-103"><a href="#Grace.max_iter-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace.max_iter-104"><a href="#Grace.max_iter-104"><span class="linenos">104</span></a><span class="sd">        Get the maximum number of iterations for relaxation or MD run.</span>
</span><span id="Grace.max_iter-105"><a href="#Grace.max_iter-105"><span class="linenos">105</span></a>
</span><span id="Grace.max_iter-106"><a href="#Grace.max_iter-106"><span class="linenos">106</span></a><span class="sd">        Returns</span>
</span><span id="Grace.max_iter-107"><a href="#Grace.max_iter-107"><span class="linenos">107</span></a><span class="sd">        -------</span>
</span><span id="Grace.max_iter-108"><a href="#Grace.max_iter-108"><span class="linenos">108</span></a><span class="sd">        int</span>
</span><span id="Grace.max_iter-109"><a href="#Grace.max_iter-109"><span class="linenos">109</span></a><span class="sd">            Maximum number of iterations.</span>
</span><span id="Grace.max_iter-110"><a href="#Grace.max_iter-110"><span class="linenos">110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace.max_iter-111"><a href="#Grace.max_iter-111"><span class="linenos">111</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Get the maximum number of iterations for relaxation or MD run.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>int</strong>: Maximum number of iterations.</li>
</ul>
</div>


                            </div>
                            <div id="Grace.model" class="classattr">
                                        <input id="Grace.model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">model</span><span class="annotation">: str</span>

                <label class="view-source-button" for="Grace.model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace.model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace.model-125"><a href="#Grace.model-125"><span class="linenos">125</span></a>    <span class="nd">@property</span>
</span><span id="Grace.model-126"><a href="#Grace.model-126"><span class="linenos">126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Grace.model-127"><a href="#Grace.model-127"><span class="linenos">127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace.model-128"><a href="#Grace.model-128"><span class="linenos">128</span></a><span class="sd">        Return the current GRACE model.</span>
</span><span id="Grace.model-129"><a href="#Grace.model-129"><span class="linenos">129</span></a><span class="sd">    </span>
</span><span id="Grace.model-130"><a href="#Grace.model-130"><span class="linenos">130</span></a><span class="sd">        Returns</span>
</span><span id="Grace.model-131"><a href="#Grace.model-131"><span class="linenos">131</span></a><span class="sd">        -------</span>
</span><span id="Grace.model-132"><a href="#Grace.model-132"><span class="linenos">132</span></a><span class="sd">        str</span>
</span><span id="Grace.model-133"><a href="#Grace.model-133"><span class="linenos">133</span></a><span class="sd">            The selected GRACE model name.</span>
</span><span id="Grace.model-134"><a href="#Grace.model-134"><span class="linenos">134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace.model-135"><a href="#Grace.model-135"><span class="linenos">135</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Return the current GRACE model.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>str</strong>: The selected GRACE model name.</li>
</ul>
</div>


                            </div>
                            <div id="Grace.available_models" class="classattr">
                                        <input id="Grace.available_models-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">available_models</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Grace.available_models-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace.available_models"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace.available_models-177"><a href="#Grace.available_models-177"><span class="linenos">177</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">available_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Grace.available_models-178"><a href="#Grace.available_models-178"><span class="linenos">178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace.available_models-179"><a href="#Grace.available_models-179"><span class="linenos">179</span></a><span class="sd">        Return the list of supported GRACE models.</span>
</span><span id="Grace.available_models-180"><a href="#Grace.available_models-180"><span class="linenos">180</span></a><span class="sd">    </span>
</span><span id="Grace.available_models-181"><a href="#Grace.available_models-181"><span class="linenos">181</span></a><span class="sd">        Returns</span>
</span><span id="Grace.available_models-182"><a href="#Grace.available_models-182"><span class="linenos">182</span></a><span class="sd">        -------</span>
</span><span id="Grace.available_models-183"><a href="#Grace.available_models-183"><span class="linenos">183</span></a><span class="sd">        list of str</span>
</span><span id="Grace.available_models-184"><a href="#Grace.available_models-184"><span class="linenos">184</span></a><span class="sd">            All valid GRACE model identifiers.</span>
</span><span id="Grace.available_models-185"><a href="#Grace.available_models-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace.available_models-186"><a href="#Grace.available_models-186"><span class="linenos">186</span></a>        <span class="k">return</span> <span class="n">_grace_models</span>
</span></pre></div>


            <div class="docstring"><p>Return the list of supported GRACE models.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>list of str</strong>: All valid GRACE model identifiers.</li>
</ul>
</div>


                            </div>
                            <div id="Grace.calc_static" class="classattr">
                                        <input id="Grace.calc_static-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calc_static</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">grace_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;GRACE-1L-MP-r6&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-MP-r5&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-MP-r6&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-FS-OAM&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OAM&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OAM&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-FS-OMAT&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT-medium-base&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT-medium-ft-E&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT-large-base&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT-large-ft-E&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT-medium-base&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT-medium-ft-E&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT-large-base&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT-large-ft-E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;GRACE-2L-OMAT&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Grace.calc_static-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace.calc_static"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace.calc_static-192"><a href="#Grace.calc_static-192"><span class="linenos">192</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_static</span><span class="p">(</span>
</span><span id="Grace.calc_static-193"><a href="#Grace.calc_static-193"><span class="linenos">193</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Grace.calc_static-194"><a href="#Grace.calc_static-194"><span class="linenos">194</span></a>        <span class="n">grace_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="o">*</span><span class="n">_grace_models</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GRACE-2L-OMAT&quot;</span><span class="p">,</span>
</span><span id="Grace.calc_static-195"><a href="#Grace.calc_static-195"><span class="linenos">195</span></a>    <span class="p">):</span>
</span><span id="Grace.calc_static-196"><a href="#Grace.calc_static-196"><span class="linenos">196</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace.calc_static-197"><a href="#Grace.calc_static-197"><span class="linenos">197</span></a><span class="sd">        Perform a static calculation.</span>
</span><span id="Grace.calc_static-198"><a href="#Grace.calc_static-198"><span class="linenos">198</span></a><span class="sd">    </span>
</span><span id="Grace.calc_static-199"><a href="#Grace.calc_static-199"><span class="linenos">199</span></a><span class="sd">        Parameters</span>
</span><span id="Grace.calc_static-200"><a href="#Grace.calc_static-200"><span class="linenos">200</span></a><span class="sd">        ----------</span>
</span><span id="Grace.calc_static-201"><a href="#Grace.calc_static-201"><span class="linenos">201</span></a><span class="sd">        grace_model : Literal[*_grace_models], optional</span>
</span><span id="Grace.calc_static-202"><a href="#Grace.calc_static-202"><span class="linenos">202</span></a><span class="sd">            GRACE model to use for the relaxation.  </span>
</span><span id="Grace.calc_static-203"><a href="#Grace.calc_static-203"><span class="linenos">203</span></a><span class="sd">            Must be one of the supported models, which can be obtained via </span>
</span><span id="Grace.calc_static-204"><a href="#Grace.calc_static-204"><span class="linenos">204</span></a><span class="sd">            :meth:`available_models`. Default is ``&quot;GRACE-2L-OMAT&quot;``.</span>
</span><span id="Grace.calc_static-205"><a href="#Grace.calc_static-205"><span class="linenos">205</span></a><span class="sd">    </span>
</span><span id="Grace.calc_static-206"><a href="#Grace.calc_static-206"><span class="linenos">206</span></a><span class="sd">        Raises</span>
</span><span id="Grace.calc_static-207"><a href="#Grace.calc_static-207"><span class="linenos">207</span></a><span class="sd">        ------</span>
</span><span id="Grace.calc_static-208"><a href="#Grace.calc_static-208"><span class="linenos">208</span></a><span class="sd">        ValueError</span>
</span><span id="Grace.calc_static-209"><a href="#Grace.calc_static-209"><span class="linenos">209</span></a><span class="sd">            If the structure has not been set before calling this method.</span>
</span><span id="Grace.calc_static-210"><a href="#Grace.calc_static-210"><span class="linenos">210</span></a><span class="sd">    </span>
</span><span id="Grace.calc_static-211"><a href="#Grace.calc_static-211"><span class="linenos">211</span></a><span class="sd">        Notes</span>
</span><span id="Grace.calc_static-212"><a href="#Grace.calc_static-212"><span class="linenos">212</span></a><span class="sd">        -----</span>
</span><span id="Grace.calc_static-213"><a href="#Grace.calc_static-213"><span class="linenos">213</span></a><span class="sd">        This method configures the GRACE calculator for a static calculation</span>
</span><span id="Grace.calc_static-214"><a href="#Grace.calc_static-214"><span class="linenos">214</span></a><span class="sd">        using the provided GRACE model.  </span>
</span><span id="Grace.calc_static-215"><a href="#Grace.calc_static-215"><span class="linenos">215</span></a><span class="sd">        A structure must be assigned to the instance prior to calling</span>
</span><span id="Grace.calc_static-216"><a href="#Grace.calc_static-216"><span class="linenos">216</span></a><span class="sd">        ``calc_static``.</span>
</span><span id="Grace.calc_static-217"><a href="#Grace.calc_static-217"><span class="linenos">217</span></a><span class="sd">    </span>
</span><span id="Grace.calc_static-218"><a href="#Grace.calc_static-218"><span class="linenos">218</span></a><span class="sd">        Returns</span>
</span><span id="Grace.calc_static-219"><a href="#Grace.calc_static-219"><span class="linenos">219</span></a><span class="sd">        -------</span>
</span><span id="Grace.calc_static-220"><a href="#Grace.calc_static-220"><span class="linenos">220</span></a><span class="sd">        None</span>
</span><span id="Grace.calc_static-221"><a href="#Grace.calc_static-221"><span class="linenos">221</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace.calc_static-222"><a href="#Grace.calc_static-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace.calc_static-223"><a href="#Grace.calc_static-223"><span class="linenos">223</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Grace.calc_static-224"><a href="#Grace.calc_static-224"><span class="linenos">224</span></a>                <span class="s1">&#39;Structure must be set before calling calc_static().&#39;</span><span class="p">)</span>
</span><span id="Grace.calc_static-225"><a href="#Grace.calc_static-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>
</span><span id="Grace.calc_static-226"><a href="#Grace.calc_static-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">grace_model</span>
</span></pre></div>


            <div class="docstring"><p>Perform a static calculation.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>grace_model</strong> (Literal[*_grace_models], optional):
GRACE model to use for the relaxation.<br />
Must be one of the supported models, which can be obtained via 
<code><a href="#Grace.available_models">available_models()</a></code>. Default is <code>"GRACE-2L-OMAT"</code>.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the structure has not been set before calling this method.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>This method configures the GRACE calculator for a static calculation
using the provided GRACE model.<br />
A structure must be assigned to the instance prior to calling
<code><a href="#Grace.calc_static">calc_static</a></code>.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="Grace.calc_minimize" class="classattr">
                                        <input id="Grace.calc_minimize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calc_minimize</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">grace_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;GRACE-1L-MP-r6&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-MP-r5&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-MP-r6&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-FS-OAM&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OAM&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OAM&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-FS-OMAT&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT-medium-base&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT-medium-ft-E&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT-large-base&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT-large-ft-E&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT-medium-base&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT-medium-ft-E&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT-large-base&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT-large-ft-E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;GRACE-2L-OMAT&#39;</span>,</span><span class="param">	<span class="n">algorithm</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;FIRE&#39;</span><span class="p">,</span> <span class="s1">&#39;BFGS&#39;</span><span class="p">,</span> <span class="s1">&#39;LBFGS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FIRE&#39;</span>,</span><span class="param">	<span class="n">algorithm_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">relax_cell</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">relax_cell_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ionic_force_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span>,</span><span class="param">	<span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span>,</span><span class="param">	<span class="n">n_print</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s1">&#39;relax.traj&#39;</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Grace.calc_minimize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace.calc_minimize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace.calc_minimize-306"><a href="#Grace.calc_minimize-306"><span class="linenos">306</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_minimize</span><span class="p">(</span>
</span><span id="Grace.calc_minimize-307"><a href="#Grace.calc_minimize-307"><span class="linenos">307</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Grace.calc_minimize-308"><a href="#Grace.calc_minimize-308"><span class="linenos">308</span></a>        <span class="n">grace_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="o">*</span><span class="n">_grace_models</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GRACE-2L-OMAT&quot;</span><span class="p">,</span>
</span><span id="Grace.calc_minimize-309"><a href="#Grace.calc_minimize-309"><span class="linenos">309</span></a>        <span class="n">algorithm</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;FIRE&quot;</span><span class="p">,</span> <span class="s2">&quot;BFGS&quot;</span><span class="p">,</span> <span class="s2">&quot;LBFGS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;FIRE&quot;</span><span class="p">,</span>
</span><span id="Grace.calc_minimize-310"><a href="#Grace.calc_minimize-310"><span class="linenos">310</span></a>        <span class="n">algorithm_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Grace.calc_minimize-311"><a href="#Grace.calc_minimize-311"><span class="linenos">311</span></a>        <span class="n">relax_cell</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Grace.calc_minimize-312"><a href="#Grace.calc_minimize-312"><span class="linenos">312</span></a>        <span class="n">relax_cell_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Grace.calc_minimize-313"><a href="#Grace.calc_minimize-313"><span class="linenos">313</span></a>        <span class="n">ionic_force_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="Grace.calc_minimize-314"><a href="#Grace.calc_minimize-314"><span class="linenos">314</span></a>        <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
</span><span id="Grace.calc_minimize-315"><a href="#Grace.calc_minimize-315"><span class="linenos">315</span></a>        <span class="n">n_print</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Grace.calc_minimize-316"><a href="#Grace.calc_minimize-316"><span class="linenos">316</span></a>        <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;relax.traj&quot;</span><span class="p">,</span>
</span><span id="Grace.calc_minimize-317"><a href="#Grace.calc_minimize-317"><span class="linenos">317</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace.calc_minimize-318"><a href="#Grace.calc_minimize-318"><span class="linenos">318</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace.calc_minimize-319"><a href="#Grace.calc_minimize-319"><span class="linenos">319</span></a><span class="sd">        Perform a structure relaxation (geometry optimization).</span>
</span><span id="Grace.calc_minimize-320"><a href="#Grace.calc_minimize-320"><span class="linenos">320</span></a><span class="sd">    </span>
</span><span id="Grace.calc_minimize-321"><a href="#Grace.calc_minimize-321"><span class="linenos">321</span></a><span class="sd">        Parameters</span>
</span><span id="Grace.calc_minimize-322"><a href="#Grace.calc_minimize-322"><span class="linenos">322</span></a><span class="sd">        ----------</span>
</span><span id="Grace.calc_minimize-323"><a href="#Grace.calc_minimize-323"><span class="linenos">323</span></a><span class="sd">        grace_model : Literal[*_grace_models], optional</span>
</span><span id="Grace.calc_minimize-324"><a href="#Grace.calc_minimize-324"><span class="linenos">324</span></a><span class="sd">            GRACE model to use for the relaxation.  </span>
</span><span id="Grace.calc_minimize-325"><a href="#Grace.calc_minimize-325"><span class="linenos">325</span></a><span class="sd">            Must be one of the supported models, which can be obtained via </span>
</span><span id="Grace.calc_minimize-326"><a href="#Grace.calc_minimize-326"><span class="linenos">326</span></a><span class="sd">            :meth:`available_models`. Default is ``&quot;GRACE-2L-OMAT&quot;``.</span>
</span><span id="Grace.calc_minimize-327"><a href="#Grace.calc_minimize-327"><span class="linenos">327</span></a><span class="sd">    </span>
</span><span id="Grace.calc_minimize-328"><a href="#Grace.calc_minimize-328"><span class="linenos">328</span></a><span class="sd">        algorithm : {&quot;FIRE&quot;, &quot;BFGS&quot;, &quot;LBFGS&quot;}, optional</span>
</span><span id="Grace.calc_minimize-329"><a href="#Grace.calc_minimize-329"><span class="linenos">329</span></a><span class="sd">            Ionic relaxation algorithm from ASE.  </span>
</span><span id="Grace.calc_minimize-330"><a href="#Grace.calc_minimize-330"><span class="linenos">330</span></a><span class="sd">            Default is ``&quot;FIRE&quot;``.</span>
</span><span id="Grace.calc_minimize-331"><a href="#Grace.calc_minimize-331"><span class="linenos">331</span></a><span class="sd">    </span>
</span><span id="Grace.calc_minimize-332"><a href="#Grace.calc_minimize-332"><span class="linenos">332</span></a><span class="sd">        algorithm_kwargs : dict, optional</span>
</span><span id="Grace.calc_minimize-333"><a href="#Grace.calc_minimize-333"><span class="linenos">333</span></a><span class="sd">            Additional keyword arguments passed to the relaxation algorithm.  </span>
</span><span id="Grace.calc_minimize-334"><a href="#Grace.calc_minimize-334"><span class="linenos">334</span></a><span class="sd">            Default is ``None``.</span>
</span><span id="Grace.calc_minimize-335"><a href="#Grace.calc_minimize-335"><span class="linenos">335</span></a><span class="sd">    </span>
</span><span id="Grace.calc_minimize-336"><a href="#Grace.calc_minimize-336"><span class="linenos">336</span></a><span class="sd">        relax_cell : bool, optional</span>
</span><span id="Grace.calc_minimize-337"><a href="#Grace.calc_minimize-337"><span class="linenos">337</span></a><span class="sd">            If ``True``, optimize the simulation cell in addition to ionic positions.  </span>
</span><span id="Grace.calc_minimize-338"><a href="#Grace.calc_minimize-338"><span class="linenos">338</span></a><span class="sd">            Default is ``False``.</span>
</span><span id="Grace.calc_minimize-339"><a href="#Grace.calc_minimize-339"><span class="linenos">339</span></a><span class="sd">    </span>
</span><span id="Grace.calc_minimize-340"><a href="#Grace.calc_minimize-340"><span class="linenos">340</span></a><span class="sd">        relax_cell_kwargs : dict, optional</span>
</span><span id="Grace.calc_minimize-341"><a href="#Grace.calc_minimize-341"><span class="linenos">341</span></a><span class="sd">            Additional keyword arguments for cell relaxation.  </span>
</span><span id="Grace.calc_minimize-342"><a href="#Grace.calc_minimize-342"><span class="linenos">342</span></a><span class="sd">            Default is ``None``.</span>
</span><span id="Grace.calc_minimize-343"><a href="#Grace.calc_minimize-343"><span class="linenos">343</span></a><span class="sd">    </span>
</span><span id="Grace.calc_minimize-344"><a href="#Grace.calc_minimize-344"><span class="linenos">344</span></a><span class="sd">        ionic_force_tolerance : float, optional</span>
</span><span id="Grace.calc_minimize-345"><a href="#Grace.calc_minimize-345"><span class="linenos">345</span></a><span class="sd">            Force convergence criterion in eV/Å.  </span>
</span><span id="Grace.calc_minimize-346"><a href="#Grace.calc_minimize-346"><span class="linenos">346</span></a><span class="sd">            Default is ``0.001``.</span>
</span><span id="Grace.calc_minimize-347"><a href="#Grace.calc_minimize-347"><span class="linenos">347</span></a><span class="sd">    </span>
</span><span id="Grace.calc_minimize-348"><a href="#Grace.calc_minimize-348"><span class="linenos">348</span></a><span class="sd">        max_iter : int, optional</span>
</span><span id="Grace.calc_minimize-349"><a href="#Grace.calc_minimize-349"><span class="linenos">349</span></a><span class="sd">            Maximum number of optimization steps.  </span>
</span><span id="Grace.calc_minimize-350"><a href="#Grace.calc_minimize-350"><span class="linenos">350</span></a><span class="sd">            Default is ``500``.</span>
</span><span id="Grace.calc_minimize-351"><a href="#Grace.calc_minimize-351"><span class="linenos">351</span></a><span class="sd">    </span>
</span><span id="Grace.calc_minimize-352"><a href="#Grace.calc_minimize-352"><span class="linenos">352</span></a><span class="sd">        n_print : int, optional</span>
</span><span id="Grace.calc_minimize-353"><a href="#Grace.calc_minimize-353"><span class="linenos">353</span></a><span class="sd">            Logging frequency for structures and stresses.  </span>
</span><span id="Grace.calc_minimize-354"><a href="#Grace.calc_minimize-354"><span class="linenos">354</span></a><span class="sd">            Default is ``1``.</span>
</span><span id="Grace.calc_minimize-355"><a href="#Grace.calc_minimize-355"><span class="linenos">355</span></a><span class="sd">    </span>
</span><span id="Grace.calc_minimize-356"><a href="#Grace.calc_minimize-356"><span class="linenos">356</span></a><span class="sd">        save_path : str or None, optional</span>
</span><span id="Grace.calc_minimize-357"><a href="#Grace.calc_minimize-357"><span class="linenos">357</span></a><span class="sd">            Path to save the relaxation trajectory.  </span>
</span><span id="Grace.calc_minimize-358"><a href="#Grace.calc_minimize-358"><span class="linenos">358</span></a><span class="sd">            If ``None``, no trajectory is written.  </span>
</span><span id="Grace.calc_minimize-359"><a href="#Grace.calc_minimize-359"><span class="linenos">359</span></a><span class="sd">            Default is ``&quot;relax.traj&quot;``.</span>
</span><span id="Grace.calc_minimize-360"><a href="#Grace.calc_minimize-360"><span class="linenos">360</span></a><span class="sd">    </span>
</span><span id="Grace.calc_minimize-361"><a href="#Grace.calc_minimize-361"><span class="linenos">361</span></a><span class="sd">        Returns</span>
</span><span id="Grace.calc_minimize-362"><a href="#Grace.calc_minimize-362"><span class="linenos">362</span></a><span class="sd">        -------</span>
</span><span id="Grace.calc_minimize-363"><a href="#Grace.calc_minimize-363"><span class="linenos">363</span></a><span class="sd">        None</span>
</span><span id="Grace.calc_minimize-364"><a href="#Grace.calc_minimize-364"><span class="linenos">364</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace.calc_minimize-365"><a href="#Grace.calc_minimize-365"><span class="linenos">365</span></a>        
</span><span id="Grace.calc_minimize-366"><a href="#Grace.calc_minimize-366"><span class="linenos">366</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">calc_minimize</span><span class="p">(</span>
</span><span id="Grace.calc_minimize-367"><a href="#Grace.calc_minimize-367"><span class="linenos">367</span></a>            <span class="n">ionic_energy_tolerance</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="Grace.calc_minimize-368"><a href="#Grace.calc_minimize-368"><span class="linenos">368</span></a>            <span class="n">ionic_force_tolerance</span><span class="o">=</span><span class="n">ionic_force_tolerance</span><span class="p">,</span>
</span><span id="Grace.calc_minimize-369"><a href="#Grace.calc_minimize-369"><span class="linenos">369</span></a>            <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span>
</span><span id="Grace.calc_minimize-370"><a href="#Grace.calc_minimize-370"><span class="linenos">370</span></a>        <span class="p">)</span>
</span><span id="Grace.calc_minimize-371"><a href="#Grace.calc_minimize-371"><span class="linenos">371</span></a>
</span><span id="Grace.calc_minimize-372"><a href="#Grace.calc_minimize-372"><span class="linenos">372</span></a>        <span class="c1"># Saving the parameters in dictionary</span>
</span><span id="Grace.calc_minimize-373"><a href="#Grace.calc_minimize-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;minimize&#39;</span>
</span><span id="Grace.calc_minimize-374"><a href="#Grace.calc_minimize-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grace_model</span>
</span><span id="Grace.calc_minimize-375"><a href="#Grace.calc_minimize-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;algo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">algorithm</span>
</span><span id="Grace.calc_minimize-376"><a href="#Grace.calc_minimize-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;algo_kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">algorithm_kwargs</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="Grace.calc_minimize-377"><a href="#Grace.calc_minimize-377"><span class="linenos">377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;relax_cell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relax_cell</span>
</span><span id="Grace.calc_minimize-378"><a href="#Grace.calc_minimize-378"><span class="linenos">378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;relax_cell_kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relax_cell_kwargs</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="Grace.calc_minimize-379"><a href="#Grace.calc_minimize-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;ionic_force_tolerance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ionic_force_tolerance</span>
</span><span id="Grace.calc_minimize-380"><a href="#Grace.calc_minimize-380"><span class="linenos">380</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;n_print&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_print</span>
</span><span id="Grace.calc_minimize-381"><a href="#Grace.calc_minimize-381"><span class="linenos">381</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_iter</span>
</span><span id="Grace.calc_minimize-382"><a href="#Grace.calc_minimize-382"><span class="linenos">382</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">save_path</span>
</span></pre></div>


            <div class="docstring"><p>Perform a structure relaxation (geometry optimization).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>grace_model</strong> (Literal[*_grace_models], optional):
GRACE model to use for the relaxation.<br />
Must be one of the supported models, which can be obtained via 
<code><a href="#Grace.available_models">available_models()</a></code>. Default is <code>"GRACE-2L-OMAT"</code>.</li>
<li><strong>algorithm</strong> ({"FIRE", "BFGS", "LBFGS"}, optional):
Ionic relaxation algorithm from ASE.<br />
Default is <code>"FIRE"</code>.</li>
<li><strong>algorithm_kwargs</strong> (dict, optional):
Additional keyword arguments passed to the relaxation algorithm.<br />
Default is <code>None</code>.</li>
<li><strong>relax_cell</strong> (bool, optional):
If <code>True</code>, optimize the simulation cell in addition to ionic positions.<br />
Default is <code>False</code>.</li>
<li><strong>relax_cell_kwargs</strong> (dict, optional):
Additional keyword arguments for cell relaxation.<br />
Default is <code>None</code>.</li>
<li><strong>ionic_force_tolerance</strong> (float, optional):
Force convergence criterion in eV/Å.<br />
Default is <code>0.001</code>.</li>
<li><strong>max_iter</strong> (int, optional):
Maximum number of optimization steps.<br />
Default is <code>500</code>.</li>
<li><strong>n_print</strong> (int, optional):
Logging frequency for structures and stresses.<br />
Default is <code>1</code>.</li>
<li><strong>save_path</strong> (str or None, optional):
Path to save the relaxation trajectory.<br />
If <code>None</code>, no trajectory is written.<br />
Default is <code>"relax.traj"</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="Grace.calc_md" class="classattr">
                                        <input id="Grace.calc_md-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calc_md</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">grace_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;GRACE-1L-MP-r6&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-MP-r5&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-MP-r6&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-FS-OAM&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OAM&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OAM&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-FS-OMAT&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT-medium-base&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT-medium-ft-E&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT-large-base&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-1L-OMAT-large-ft-E&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT-medium-base&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT-medium-ft-E&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT-large-base&#39;</span><span class="p">,</span> <span class="s1">&#39;GRACE-2L-OMAT-large-ft-E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;GRACE-2L-OMAT&#39;</span>,</span><span class="param">	<span class="n">ensemble</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;NVT&#39;</span><span class="p">,</span> <span class="s1">&#39;nvt&#39;</span><span class="p">,</span> <span class="s1">&#39;Langevin&#39;</span><span class="p">,</span> <span class="s1">&#39;langevin&#39;</span><span class="p">,</span> <span class="s1">&#39;NPT&#39;</span><span class="p">,</span> <span class="s1">&#39;npt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NVT&#39;</span>,</span><span class="param">	<span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">300.0</span>,</span><span class="param">	<span class="n">starting_temperature</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">pressure</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">time_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span>,</span><span class="param">	<span class="n">n_ionic_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>,</span><span class="param">	<span class="n">n_print</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">temperature_damping_timescale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">100.0</span>,</span><span class="param">	<span class="n">pressure_damping_timescale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">trajectory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;md_run.traj&#39;</span>,</span><span class="param">	<span class="n">logfile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;md_run.log&#39;</span>,</span><span class="param">	<span class="n">random_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">mask</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Grace.calc_md-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace.calc_md"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace.calc_md-530"><a href="#Grace.calc_md-530"><span class="linenos">530</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_md</span><span class="p">(</span>
</span><span id="Grace.calc_md-531"><a href="#Grace.calc_md-531"><span class="linenos">531</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Grace.calc_md-532"><a href="#Grace.calc_md-532"><span class="linenos">532</span></a>        <span class="n">grace_model</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="o">*</span><span class="n">_grace_models</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GRACE-2L-OMAT&quot;</span><span class="p">,</span>
</span><span id="Grace.calc_md-533"><a href="#Grace.calc_md-533"><span class="linenos">533</span></a>        <span class="n">ensemble</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;NVT&quot;</span><span class="p">,</span> <span class="s2">&quot;nvt&quot;</span><span class="p">,</span> <span class="s2">&quot;Langevin&quot;</span><span class="p">,</span> <span class="s2">&quot;langevin&quot;</span><span class="p">,</span> <span class="s2">&quot;NPT&quot;</span><span class="p">,</span> <span class="s2">&quot;npt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NVT&quot;</span><span class="p">,</span> 
</span><span id="Grace.calc_md-534"><a href="#Grace.calc_md-534"><span class="linenos">534</span></a>        <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">300.0</span><span class="p">,</span>
</span><span id="Grace.calc_md-535"><a href="#Grace.calc_md-535"><span class="linenos">535</span></a>        <span class="n">starting_temperature</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Grace.calc_md-536"><a href="#Grace.calc_md-536"><span class="linenos">536</span></a>        <span class="n">pressure</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Grace.calc_md-537"><a href="#Grace.calc_md-537"><span class="linenos">537</span></a>        <span class="n">time_step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="Grace.calc_md-538"><a href="#Grace.calc_md-538"><span class="linenos">538</span></a>        <span class="n">n_ionic_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="Grace.calc_md-539"><a href="#Grace.calc_md-539"><span class="linenos">539</span></a>        <span class="n">n_print</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Grace.calc_md-540"><a href="#Grace.calc_md-540"><span class="linenos">540</span></a>        <span class="n">temperature_damping_timescale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">,</span>
</span><span id="Grace.calc_md-541"><a href="#Grace.calc_md-541"><span class="linenos">541</span></a>        <span class="n">pressure_damping_timescale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Grace.calc_md-542"><a href="#Grace.calc_md-542"><span class="linenos">542</span></a>        <span class="n">trajectory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;md_run.traj&quot;</span><span class="p">,</span>
</span><span id="Grace.calc_md-543"><a href="#Grace.calc_md-543"><span class="linenos">543</span></a>        <span class="n">logfile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;md_run.log&quot;</span><span class="p">,</span>
</span><span id="Grace.calc_md-544"><a href="#Grace.calc_md-544"><span class="linenos">544</span></a>        <span class="n">random_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Grace.calc_md-545"><a href="#Grace.calc_md-545"><span class="linenos">545</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Grace.calc_md-546"><a href="#Grace.calc_md-546"><span class="linenos">546</span></a>    <span class="p">):</span>
</span><span id="Grace.calc_md-547"><a href="#Grace.calc_md-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace.calc_md-548"><a href="#Grace.calc_md-548"><span class="linenos">548</span></a><span class="sd">        Run a molecular dynamics simulation using a GRACE foundation model.</span>
</span><span id="Grace.calc_md-549"><a href="#Grace.calc_md-549"><span class="linenos">549</span></a><span class="sd">    </span>
</span><span id="Grace.calc_md-550"><a href="#Grace.calc_md-550"><span class="linenos">550</span></a><span class="sd">        Parameters</span>
</span><span id="Grace.calc_md-551"><a href="#Grace.calc_md-551"><span class="linenos">551</span></a><span class="sd">        ----------</span>
</span><span id="Grace.calc_md-552"><a href="#Grace.calc_md-552"><span class="linenos">552</span></a><span class="sd">        grace_model : Literal[*_grace_models], optional</span>
</span><span id="Grace.calc_md-553"><a href="#Grace.calc_md-553"><span class="linenos">553</span></a><span class="sd">            GRACE model to use for the relaxation.  </span>
</span><span id="Grace.calc_md-554"><a href="#Grace.calc_md-554"><span class="linenos">554</span></a><span class="sd">            Must be one of the supported models, which can be obtained via </span>
</span><span id="Grace.calc_md-555"><a href="#Grace.calc_md-555"><span class="linenos">555</span></a><span class="sd">            :meth:`available_models`. Default is ``&quot;GRACE-2L-OMAT&quot;``.</span>
</span><span id="Grace.calc_md-556"><a href="#Grace.calc_md-556"><span class="linenos">556</span></a><span class="sd">    </span>
</span><span id="Grace.calc_md-557"><a href="#Grace.calc_md-557"><span class="linenos">557</span></a><span class="sd">        ensemble : {&quot;NVT&quot;, &quot;nvt&quot;, &quot;Langevin&quot;, &quot;langevin&quot;, &quot;NPT&quot;, &quot;npt&quot;}, optional</span>
</span><span id="Grace.calc_md-558"><a href="#Grace.calc_md-558"><span class="linenos">558</span></a><span class="sd">            Type of statistical ensemble:</span>
</span><span id="Grace.calc_md-559"><a href="#Grace.calc_md-559"><span class="linenos">559</span></a><span class="sd">            - &quot;NVT&quot; or &quot;Langevin&quot;: constant volume and temperature.</span>
</span><span id="Grace.calc_md-560"><a href="#Grace.calc_md-560"><span class="linenos">560</span></a><span class="sd">            - &quot;NPT&quot;: constant pressure and temperature.</span>
</span><span id="Grace.calc_md-561"><a href="#Grace.calc_md-561"><span class="linenos">561</span></a><span class="sd">            Case-insensitive (default is &quot;NVT&quot;).</span>
</span><span id="Grace.calc_md-562"><a href="#Grace.calc_md-562"><span class="linenos">562</span></a><span class="sd">    </span>
</span><span id="Grace.calc_md-563"><a href="#Grace.calc_md-563"><span class="linenos">563</span></a><span class="sd">        temperature : float, optional</span>
</span><span id="Grace.calc_md-564"><a href="#Grace.calc_md-564"><span class="linenos">564</span></a><span class="sd">            Target simulation temperature in Kelvin (default is 300.0).</span>
</span><span id="Grace.calc_md-565"><a href="#Grace.calc_md-565"><span class="linenos">565</span></a><span class="sd">    </span>
</span><span id="Grace.calc_md-566"><a href="#Grace.calc_md-566"><span class="linenos">566</span></a><span class="sd">        starting_temperature : int or None, optional</span>
</span><span id="Grace.calc_md-567"><a href="#Grace.calc_md-567"><span class="linenos">567</span></a><span class="sd">            Initial temperature of the system in Kelvin. If None, uses</span>
</span><span id="Grace.calc_md-568"><a href="#Grace.calc_md-568"><span class="linenos">568</span></a><span class="sd">            the target `temperature` (default is None).</span>
</span><span id="Grace.calc_md-569"><a href="#Grace.calc_md-569"><span class="linenos">569</span></a><span class="sd">    </span>
</span><span id="Grace.calc_md-570"><a href="#Grace.calc_md-570"><span class="linenos">570</span></a><span class="sd">        pressure : float or None, optional</span>
</span><span id="Grace.calc_md-571"><a href="#Grace.calc_md-571"><span class="linenos">571</span></a><span class="sd">            Target external pressure in GPa for NPT runs. Ignored if ensemble</span>
</span><span id="Grace.calc_md-572"><a href="#Grace.calc_md-572"><span class="linenos">572</span></a><span class="sd">            is NVT or Langevin (default is None).</span>
</span><span id="Grace.calc_md-573"><a href="#Grace.calc_md-573"><span class="linenos">573</span></a><span class="sd">    </span>
</span><span id="Grace.calc_md-574"><a href="#Grace.calc_md-574"><span class="linenos">574</span></a><span class="sd">        time_step : float, optional</span>
</span><span id="Grace.calc_md-575"><a href="#Grace.calc_md-575"><span class="linenos">575</span></a><span class="sd">            Integration time step in femtoseconds (default is 2.0 fs).</span>
</span><span id="Grace.calc_md-576"><a href="#Grace.calc_md-576"><span class="linenos">576</span></a><span class="sd">    </span>
</span><span id="Grace.calc_md-577"><a href="#Grace.calc_md-577"><span class="linenos">577</span></a><span class="sd">        n_ionic_steps : int, optional</span>
</span><span id="Grace.calc_md-578"><a href="#Grace.calc_md-578"><span class="linenos">578</span></a><span class="sd">            Number of MD steps to perform (default is 100).</span>
</span><span id="Grace.calc_md-579"><a href="#Grace.calc_md-579"><span class="linenos">579</span></a><span class="sd">    </span>
</span><span id="Grace.calc_md-580"><a href="#Grace.calc_md-580"><span class="linenos">580</span></a><span class="sd">        n_print : int, optional</span>
</span><span id="Grace.calc_md-581"><a href="#Grace.calc_md-581"><span class="linenos">581</span></a><span class="sd">            Frequency of log printing and trajectory writing (default is 10).</span>
</span><span id="Grace.calc_md-582"><a href="#Grace.calc_md-582"><span class="linenos">582</span></a><span class="sd">    </span>
</span><span id="Grace.calc_md-583"><a href="#Grace.calc_md-583"><span class="linenos">583</span></a><span class="sd">        temperature_damping_timescale : float, optional</span>
</span><span id="Grace.calc_md-584"><a href="#Grace.calc_md-584"><span class="linenos">584</span></a><span class="sd">            Thermostat coupling time in femtoseconds (default is 100.0 fs).</span>
</span><span id="Grace.calc_md-585"><a href="#Grace.calc_md-585"><span class="linenos">585</span></a><span class="sd">    </span>
</span><span id="Grace.calc_md-586"><a href="#Grace.calc_md-586"><span class="linenos">586</span></a><span class="sd">        pressure_damping_timescale : float or None, optional</span>
</span><span id="Grace.calc_md-587"><a href="#Grace.calc_md-587"><span class="linenos">587</span></a><span class="sd">            Barostat coupling time in femtoseconds. Only relevant for NPT runs</span>
</span><span id="Grace.calc_md-588"><a href="#Grace.calc_md-588"><span class="linenos">588</span></a><span class="sd">            (default is None).</span>
</span><span id="Grace.calc_md-589"><a href="#Grace.calc_md-589"><span class="linenos">589</span></a><span class="sd">    </span>
</span><span id="Grace.calc_md-590"><a href="#Grace.calc_md-590"><span class="linenos">590</span></a><span class="sd">        trajectory : str, optional</span>
</span><span id="Grace.calc_md-591"><a href="#Grace.calc_md-591"><span class="linenos">591</span></a><span class="sd">            Output trajectory file name (default is &quot;md_run.traj&quot;).</span>
</span><span id="Grace.calc_md-592"><a href="#Grace.calc_md-592"><span class="linenos">592</span></a><span class="sd">    </span>
</span><span id="Grace.calc_md-593"><a href="#Grace.calc_md-593"><span class="linenos">593</span></a><span class="sd">        logfile : str, optional</span>
</span><span id="Grace.calc_md-594"><a href="#Grace.calc_md-594"><span class="linenos">594</span></a><span class="sd">            Output log file name (default is &quot;md_run.log&quot;).</span>
</span><span id="Grace.calc_md-595"><a href="#Grace.calc_md-595"><span class="linenos">595</span></a><span class="sd">    </span>
</span><span id="Grace.calc_md-596"><a href="#Grace.calc_md-596"><span class="linenos">596</span></a><span class="sd">        random_seed : int or None, optional</span>
</span><span id="Grace.calc_md-597"><a href="#Grace.calc_md-597"><span class="linenos">597</span></a><span class="sd">            Seed for random velocity initialization. If None, system clock</span>
</span><span id="Grace.calc_md-598"><a href="#Grace.calc_md-598"><span class="linenos">598</span></a><span class="sd">            is used (default is None).</span>
</span><span id="Grace.calc_md-599"><a href="#Grace.calc_md-599"><span class="linenos">599</span></a><span class="sd">            </span>
</span><span id="Grace.calc_md-600"><a href="#Grace.calc_md-600"><span class="linenos">600</span></a><span class="sd">        mask : None, sequence of 3 ints (0/1), or (3,3) array-like, optional</span>
</span><span id="Grace.calc_md-601"><a href="#Grace.calc_md-601"><span class="linenos">601</span></a><span class="sd">            Specify which components of the computational box (strain tensor)</span>
</span><span id="Grace.calc_md-602"><a href="#Grace.calc_md-602"><span class="linenos">602</span></a><span class="sd">            are allowed to change under the barostat (default is None equalling</span>
</span><span id="Grace.calc_md-603"><a href="#Grace.calc_md-603"><span class="linenos">603</span></a><span class="sd">            to *No mask*). Only relevant for NPT simulations; it has no effect </span>
</span><span id="Grace.calc_md-604"><a href="#Grace.calc_md-604"><span class="linenos">604</span></a><span class="sd">            for NVT / Langevin ensembles.</span>
</span><span id="Grace.calc_md-605"><a href="#Grace.calc_md-605"><span class="linenos">605</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace.calc_md-606"><a href="#Grace.calc_md-606"><span class="linenos">606</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;md&#39;</span>
</span><span id="Grace.calc_md-607"><a href="#Grace.calc_md-607"><span class="linenos">607</span></a>        <span class="n">ensemble</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="Grace.calc_md-608"><a href="#Grace.calc_md-608"><span class="linenos">608</span></a>        <span class="k">if</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;langevin&#39;</span><span class="p">,</span> <span class="s1">&#39;nvt&#39;</span><span class="p">]:</span> <span class="c1">#requested NVT, ignore NPT settings</span>
</span><span id="Grace.calc_md-609"><a href="#Grace.calc_md-609"><span class="linenos">609</span></a>            <span class="n">pressure</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Grace.calc_md-610"><a href="#Grace.calc_md-610"><span class="linenos">610</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Grace.calc_md-611"><a href="#Grace.calc_md-611"><span class="linenos">611</span></a>        <span class="k">if</span> <span class="n">pressure</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace.calc_md-612"><a href="#Grace.calc_md-612"><span class="linenos">612</span></a>            <span class="n">pressure_damping_timescale</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Grace.calc_md-613"><a href="#Grace.calc_md-613"><span class="linenos">613</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">calc_md</span><span class="p">(</span>
</span><span id="Grace.calc_md-614"><a href="#Grace.calc_md-614"><span class="linenos">614</span></a>            <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
</span><span id="Grace.calc_md-615"><a href="#Grace.calc_md-615"><span class="linenos">615</span></a>            <span class="n">pressure</span><span class="o">=</span><span class="n">pressure</span><span class="p">,</span>
</span><span id="Grace.calc_md-616"><a href="#Grace.calc_md-616"><span class="linenos">616</span></a>            <span class="n">n_ionic_steps</span><span class="o">=</span><span class="n">n_ionic_steps</span><span class="p">,</span>
</span><span id="Grace.calc_md-617"><a href="#Grace.calc_md-617"><span class="linenos">617</span></a>            <span class="n">time_step</span><span class="o">=</span><span class="n">time_step</span><span class="p">,</span>
</span><span id="Grace.calc_md-618"><a href="#Grace.calc_md-618"><span class="linenos">618</span></a>            <span class="n">n_print</span><span class="o">=</span><span class="n">n_print</span><span class="p">,</span>
</span><span id="Grace.calc_md-619"><a href="#Grace.calc_md-619"><span class="linenos">619</span></a>            <span class="n">temperature_damping_timescale</span><span class="o">=</span><span class="n">temperature_damping_timescale</span><span class="p">,</span>
</span><span id="Grace.calc_md-620"><a href="#Grace.calc_md-620"><span class="linenos">620</span></a>            <span class="n">pressure_damping_timescale</span><span class="o">=</span><span class="n">pressure_damping_timescale</span><span class="p">,</span>
</span><span id="Grace.calc_md-621"><a href="#Grace.calc_md-621"><span class="linenos">621</span></a>        <span class="p">)</span>
</span><span id="Grace.calc_md-622"><a href="#Grace.calc_md-622"><span class="linenos">622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grace_model</span>
</span><span id="Grace.calc_md-623"><a href="#Grace.calc_md-623"><span class="linenos">623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;ensemble&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="Grace.calc_md-624"><a href="#Grace.calc_md-624"><span class="linenos">624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;trajectory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trajectory</span>
</span><span id="Grace.calc_md-625"><a href="#Grace.calc_md-625"><span class="linenos">625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;logfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logfile</span> 
</span><span id="Grace.calc_md-626"><a href="#Grace.calc_md-626"><span class="linenos">626</span></a>        <span class="k">if</span> <span class="n">starting_temperature</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace.calc_md-627"><a href="#Grace.calc_md-627"><span class="linenos">627</span></a>            <span class="n">starting_temperature</span> <span class="o">=</span> <span class="n">temperature</span>
</span><span id="Grace.calc_md-628"><a href="#Grace.calc_md-628"><span class="linenos">628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;starting_temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">starting_temperature</span>
</span><span id="Grace.calc_md-629"><a href="#Grace.calc_md-629"><span class="linenos">629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;random_seed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_seed</span>
</span><span id="Grace.calc_md-630"><a href="#Grace.calc_md-630"><span class="linenos">630</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span>
</span></pre></div>


            <div class="docstring"><p>Run a molecular dynamics simulation using a GRACE foundation model.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>grace_model</strong> (Literal[*_grace_models], optional):
GRACE model to use for the relaxation.<br />
Must be one of the supported models, which can be obtained via 
<code><a href="#Grace.available_models">available_models()</a></code>. Default is <code>"GRACE-2L-OMAT"</code>.</li>
<li><strong>ensemble</strong> ({"NVT", "nvt", "Langevin", "langevin", "NPT", "npt"}, optional):
Type of statistical ensemble:
<ul>
<li>"NVT" or "Langevin": constant volume and temperature.</li>
<li>"NPT": constant pressure and temperature.
Case-insensitive (default is "NVT").</li>
</ul></li>
<li><strong>temperature</strong> (float, optional):
Target simulation temperature in Kelvin (default is 300.0).</li>
<li><strong>starting_temperature</strong> (int or None, optional):
Initial temperature of the system in Kelvin. If None, uses
the target <code>temperature</code> (default is None).</li>
<li><strong>pressure</strong> (float or None, optional):
Target external pressure in GPa for NPT runs. Ignored if ensemble
is NVT or Langevin (default is None).</li>
<li><strong>time_step</strong> (float, optional):
Integration time step in femtoseconds (default is 2.0 fs).</li>
<li><strong>n_ionic_steps</strong> (int, optional):
Number of MD steps to perform (default is 100).</li>
<li><strong>n_print</strong> (int, optional):
Frequency of log printing and trajectory writing (default is 10).</li>
<li><strong>temperature_damping_timescale</strong> (float, optional):
Thermostat coupling time in femtoseconds (default is 100.0 fs).</li>
<li><strong>pressure_damping_timescale</strong> (float or None, optional):
Barostat coupling time in femtoseconds. Only relevant for NPT runs
(default is None).</li>
<li><strong>trajectory</strong> (str, optional):
Output trajectory file name (default is "md_run.traj").</li>
<li><strong>logfile</strong> (str, optional):
Output log file name (default is "md_run.log").</li>
<li><strong>random_seed</strong> (int or None, optional):
Seed for random velocity initialization. If None, system clock
is used (default is None).</li>
<li><strong>mask</strong> (None, sequence of 3 ints (0/1), or (3,3) array-like, optional):
Specify which components of the computational box (strain tensor)
are allowed to change under the barostat (default is None equalling
to <em>No mask</em>). Only relevant for NPT simulations; it has no effect 
for NVT / Langevin ensembles.</li>
</ul>
</div>


                            </div>
                            <div id="Grace.write_input" class="classattr">
                                        <input id="Grace.write_input-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_input</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Grace.write_input-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace.write_input"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace.write_input-768"><a href="#Grace.write_input-768"><span class="linenos">768</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write_input</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace.write_input-769"><a href="#Grace.write_input-769"><span class="linenos">769</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace.write_input-770"><a href="#Grace.write_input-770"><span class="linenos">770</span></a><span class="sd">        Write input files required for the Grace calculation.</span>
</span><span id="Grace.write_input-771"><a href="#Grace.write_input-771"><span class="linenos">771</span></a>
</span><span id="Grace.write_input-772"><a href="#Grace.write_input-772"><span class="linenos">772</span></a><span class="sd">        This function writes the structure file (`structure.cif`), stores the input</span>
</span><span id="Grace.write_input-773"><a href="#Grace.write_input-773"><span class="linenos">773</span></a><span class="sd">        dictionary to the HDF5 format, and delegates further writing depending on the</span>
</span><span id="Grace.write_input-774"><a href="#Grace.write_input-774"><span class="linenos">774</span></a><span class="sd">        calculation mode (MD or static/minimize).</span>
</span><span id="Grace.write_input-775"><a href="#Grace.write_input-775"><span class="linenos">775</span></a>
</span><span id="Grace.write_input-776"><a href="#Grace.write_input-776"><span class="linenos">776</span></a><span class="sd">        Returns</span>
</span><span id="Grace.write_input-777"><a href="#Grace.write_input-777"><span class="linenos">777</span></a><span class="sd">        -------</span>
</span><span id="Grace.write_input-778"><a href="#Grace.write_input-778"><span class="linenos">778</span></a><span class="sd">        None</span>
</span><span id="Grace.write_input-779"><a href="#Grace.write_input-779"><span class="linenos">779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace.write_input-780"><a href="#Grace.write_input-780"><span class="linenos">780</span></a>        <span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s1">&#39;structure.cif&#39;</span><span class="p">),</span>
</span><span id="Grace.write_input-781"><a href="#Grace.write_input-781"><span class="linenos">781</span></a>              <span class="n">pyiron_to_ase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">))</span>
</span><span id="Grace.write_input-782"><a href="#Grace.write_input-782"><span class="linenos">782</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>
</span><span id="Grace.write_input-783"><a href="#Grace.write_input-783"><span class="linenos">783</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">:</span>
</span><span id="Grace.write_input-784"><a href="#Grace.write_input-784"><span class="linenos">784</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_calc_static</span><span class="p">()</span>
</span><span id="Grace.write_input-785"><a href="#Grace.write_input-785"><span class="linenos">785</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;minimize&#39;</span><span class="p">:</span>
</span><span id="Grace.write_input-786"><a href="#Grace.write_input-786"><span class="linenos">786</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_calc_minimize</span><span class="p">()</span>
</span><span id="Grace.write_input-787"><a href="#Grace.write_input-787"><span class="linenos">787</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;md&#39;</span><span class="p">:</span>
</span><span id="Grace.write_input-788"><a href="#Grace.write_input-788"><span class="linenos">788</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_calc_md</span><span class="p">()</span>
</span><span id="Grace.write_input-789"><a href="#Grace.write_input-789"><span class="linenos">789</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Grace.write_input-790"><a href="#Grace.write_input-790"><span class="linenos">790</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Grace.write_input-791"><a href="#Grace.write_input-791"><span class="linenos">791</span></a>                <span class="s2">&quot;No calculation type set. Use calc_static(), calc_minimize() or calc_md() first.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write input files required for the Grace calculation.</p>

<p>This function writes the structure file (<code>structure.cif</code>), stores the input
dictionary to the HDF5 format, and delegates further writing depending on the
calculation mode (MD or static/minimize).</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="Grace.collect_output" class="classattr">
                                        <input id="Grace.collect_output-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">collect_output</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Grace.collect_output-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace.collect_output"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace.collect_output-793"><a href="#Grace.collect_output-793"><span class="linenos">793</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">collect_output</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace.collect_output-794"><a href="#Grace.collect_output-794"><span class="linenos">794</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace.collect_output-795"><a href="#Grace.collect_output-795"><span class="linenos">795</span></a><span class="sd">        Collect and store the results of a calculation.</span>
</span><span id="Grace.collect_output-796"><a href="#Grace.collect_output-796"><span class="linenos">796</span></a><span class="sd">    </span>
</span><span id="Grace.collect_output-797"><a href="#Grace.collect_output-797"><span class="linenos">797</span></a><span class="sd">        This method parses the final structure, trajectory, and other output properties</span>
</span><span id="Grace.collect_output-798"><a href="#Grace.collect_output-798"><span class="linenos">798</span></a><span class="sd">        from the calculation and stores them in HDF5 format. The internal structure</span>
</span><span id="Grace.collect_output-799"><a href="#Grace.collect_output-799"><span class="linenos">799</span></a><span class="sd">        is updated, and various properties such as energies, structure, forces, and </span>
</span><span id="Grace.collect_output-800"><a href="#Grace.collect_output-800"><span class="linenos">800</span></a><span class="sd">        stresses are saved to the output group.</span>
</span><span id="Grace.collect_output-801"><a href="#Grace.collect_output-801"><span class="linenos">801</span></a><span class="sd">    </span>
</span><span id="Grace.collect_output-802"><a href="#Grace.collect_output-802"><span class="linenos">802</span></a><span class="sd">        Returns</span>
</span><span id="Grace.collect_output-803"><a href="#Grace.collect_output-803"><span class="linenos">803</span></a><span class="sd">        -------</span>
</span><span id="Grace.collect_output-804"><a href="#Grace.collect_output-804"><span class="linenos">804</span></a><span class="sd">        None</span>
</span><span id="Grace.collect_output-805"><a href="#Grace.collect_output-805"><span class="linenos">805</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace.collect_output-806"><a href="#Grace.collect_output-806"><span class="linenos">806</span></a>
</span><span id="Grace.collect_output-807"><a href="#Grace.collect_output-807"><span class="linenos">807</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">voigt_to_tensor</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="Grace.collect_output-808"><a href="#Grace.collect_output-808"><span class="linenos">808</span></a>            <span class="c1"># s is a 6-element array from atoms.get_stress()</span>
</span><span id="Grace.collect_output-809"><a href="#Grace.collect_output-809"><span class="linenos">809</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
</span><span id="Grace.collect_output-810"><a href="#Grace.collect_output-810"><span class="linenos">810</span></a>                <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
</span><span id="Grace.collect_output-811"><a href="#Grace.collect_output-811"><span class="linenos">811</span></a>                <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
</span><span id="Grace.collect_output-812"><a href="#Grace.collect_output-812"><span class="linenos">812</span></a>                <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span><span id="Grace.collect_output-813"><a href="#Grace.collect_output-813"><span class="linenos">813</span></a>            <span class="p">])</span>
</span><span id="Grace.collect_output-814"><a href="#Grace.collect_output-814"><span class="linenos">814</span></a>
</span><span id="Grace.collect_output-815"><a href="#Grace.collect_output-815"><span class="linenos">815</span></a>        <span class="n">relaxed_ase_structure</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span>
</span><span id="Grace.collect_output-816"><a href="#Grace.collect_output-816"><span class="linenos">816</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s1">&#39;final_structure.cif&#39;</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;cif&#39;</span><span class="p">)</span>
</span><span id="Grace.collect_output-817"><a href="#Grace.collect_output-817"><span class="linenos">817</span></a>        <span class="n">relaxed_pyiron_structure</span> <span class="o">=</span> <span class="n">ase_to_pyiron</span><span class="p">(</span><span class="n">relaxed_ase_structure</span><span class="p">)</span>
</span><span id="Grace.collect_output-818"><a href="#Grace.collect_output-818"><span class="linenos">818</span></a>
</span><span id="Grace.collect_output-819"><a href="#Grace.collect_output-819"><span class="linenos">819</span></a>        <span class="c1"># Store the relaxed structure in the HDF5 group</span>
</span><span id="Grace.collect_output-820"><a href="#Grace.collect_output-820"><span class="linenos">820</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace.collect_output-821"><a href="#Grace.collect_output-821"><span class="linenos">821</span></a>            <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;structure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relaxed_pyiron_structure</span>
</span><span id="Grace.collect_output-822"><a href="#Grace.collect_output-822"><span class="linenos">822</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">relaxed_pyiron_structure</span>  <span class="c1"># Update the job&#39;s structure</span>
</span><span id="Grace.collect_output-823"><a href="#Grace.collect_output-823"><span class="linenos">823</span></a>
</span><span id="Grace.collect_output-824"><a href="#Grace.collect_output-824"><span class="linenos">824</span></a>        <span class="c1"># Parse trajectory from minimize</span>
</span><span id="Grace.collect_output-825"><a href="#Grace.collect_output-825"><span class="linenos">825</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;minimize&#39;</span><span class="p">,</span> <span class="s1">&#39;md&#39;</span><span class="p">]:</span>
</span><span id="Grace.collect_output-826"><a href="#Grace.collect_output-826"><span class="linenos">826</span></a>            <span class="c1"># For minimize and md, we expect a trajectory file with the relaxed structure</span>
</span><span id="Grace.collect_output-827"><a href="#Grace.collect_output-827"><span class="linenos">827</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;minimize&#39;</span><span class="p">:</span>
</span><span id="Grace.collect_output-828"><a href="#Grace.collect_output-828"><span class="linenos">828</span></a>                <span class="n">traj_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;save_path&#39;</span><span class="p">]</span>
</span><span id="Grace.collect_output-829"><a href="#Grace.collect_output-829"><span class="linenos">829</span></a>                <span class="n">traj</span> <span class="o">=</span> <span class="n">Trajectory</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">traj_file</span><span class="p">))</span>
</span><span id="Grace.collect_output-830"><a href="#Grace.collect_output-830"><span class="linenos">830</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Grace.collect_output-831"><a href="#Grace.collect_output-831"><span class="linenos">831</span></a>                <span class="n">traj_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;trajectory&#39;</span><span class="p">]</span>
</span><span id="Grace.collect_output-832"><a href="#Grace.collect_output-832"><span class="linenos">832</span></a>                <span class="n">traj</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">traj_file</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span id="Grace.collect_output-833"><a href="#Grace.collect_output-833"><span class="linenos">833</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Grace.collect_output-834"><a href="#Grace.collect_output-834"><span class="linenos">834</span></a>                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace.collect_output-835"><a href="#Grace.collect_output-835"><span class="linenos">835</span></a>                    <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">])</span>
</span><span id="Grace.collect_output-836"><a href="#Grace.collect_output-836"><span class="linenos">836</span></a>                    <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">positions</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">])</span>
</span><span id="Grace.collect_output-837"><a href="#Grace.collect_output-837"><span class="linenos">837</span></a>                    <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;stresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Grace.collect_output-838"><a href="#Grace.collect_output-838"><span class="linenos">838</span></a>                        <span class="p">[</span><span class="n">voigt_to_tensor</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">get_stress</span><span class="p">())</span><span class="o">*</span><span class="n">EV_PER_ANG3_TO_GPA</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">])</span>
</span><span id="Grace.collect_output-839"><a href="#Grace.collect_output-839"><span class="linenos">839</span></a>                    <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">get_forces</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">])</span>
</span><span id="Grace.collect_output-840"><a href="#Grace.collect_output-840"><span class="linenos">840</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Grace.collect_output-841"><a href="#Grace.collect_output-841"><span class="linenos">841</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="Grace.collect_output-842"><a href="#Grace.collect_output-842"><span class="linenos">842</span></a>                    <span class="sa">f</span><span class="s1">&#39;Cannot parse output from </span><span class="si">{</span><span class="n">traj_file</span><span class="si">}</span><span class="s1"> file.&#39;</span><span class="p">)</span>
</span><span id="Grace.collect_output-843"><a href="#Grace.collect_output-843"><span class="linenos">843</span></a>        
</span><span id="Grace.collect_output-844"><a href="#Grace.collect_output-844"><span class="linenos">844</span></a>        <span class="c1"># Parse other properties</span>
</span><span id="Grace.collect_output-845"><a href="#Grace.collect_output-845"><span class="linenos">845</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">:</span>
</span><span id="Grace.collect_output-846"><a href="#Grace.collect_output-846"><span class="linenos">846</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_calc_static</span><span class="p">()</span>  
</span><span id="Grace.collect_output-847"><a href="#Grace.collect_output-847"><span class="linenos">847</span></a>            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;max_force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="Grace.collect_output-848"><a href="#Grace.collect_output-848"><span class="linenos">848</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace.collect_output-849"><a href="#Grace.collect_output-849"><span class="linenos">849</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-850"><a href="#Grace.collect_output-850"><span class="linenos">850</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_tot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-851"><a href="#Grace.collect_output-851"><span class="linenos">851</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-852"><a href="#Grace.collect_output-852"><span class="linenos">852</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;max_force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;max_force&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-853"><a href="#Grace.collect_output-853"><span class="linenos">853</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;stresses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Grace.collect_output-854"><a href="#Grace.collect_output-854"><span class="linenos">854</span></a>                    <span class="p">[</span><span class="n">voigt_to_tensor</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">EV_PER_ANG3_TO_GPA</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stresses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
</span><span id="Grace.collect_output-855"><a href="#Grace.collect_output-855"><span class="linenos">855</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-856"><a href="#Grace.collect_output-856"><span class="linenos">856</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;cells&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">relaxed_pyiron_structure</span><span class="o">.</span><span class="n">get_cell</span><span class="p">()])</span>
</span><span id="Grace.collect_output-857"><a href="#Grace.collect_output-857"><span class="linenos">857</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">relaxed_pyiron_structure</span><span class="o">.</span><span class="n">positions</span><span class="p">])</span>
</span><span id="Grace.collect_output-858"><a href="#Grace.collect_output-858"><span class="linenos">858</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;minimize&#39;</span><span class="p">:</span>
</span><span id="Grace.collect_output-859"><a href="#Grace.collect_output-859"><span class="linenos">859</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_calc_minimize</span><span class="p">()</span>
</span><span id="Grace.collect_output-860"><a href="#Grace.collect_output-860"><span class="linenos">860</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace.collect_output-861"><a href="#Grace.collect_output-861"><span class="linenos">861</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-862"><a href="#Grace.collect_output-862"><span class="linenos">862</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_tot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-863"><a href="#Grace.collect_output-863"><span class="linenos">863</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;max_force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-864"><a href="#Grace.collect_output-864"><span class="linenos">864</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Step&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>        
</span><span id="Grace.collect_output-865"><a href="#Grace.collect_output-865"><span class="linenos">865</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_input</span><span class="p">[</span><span class="s1">&#39;calc_mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;md&#39;</span><span class="p">:</span>
</span><span id="Grace.collect_output-866"><a href="#Grace.collect_output-866"><span class="linenos">866</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_calc_md</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;logfile&#39;</span><span class="p">])</span>
</span><span id="Grace.collect_output-867"><a href="#Grace.collect_output-867"><span class="linenos">867</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace.collect_output-868"><a href="#Grace.collect_output-868"><span class="linenos">868</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Epot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-869"><a href="#Grace.collect_output-869"><span class="linenos">869</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_tot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Etot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-870"><a href="#Grace.collect_output-870"><span class="linenos">870</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;energy_kin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Ekin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-871"><a href="#Grace.collect_output-871"><span class="linenos">871</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-872"><a href="#Grace.collect_output-872"><span class="linenos">872</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-873"><a href="#Grace.collect_output-873"><span class="linenos">873</span></a>                <span class="n">h5out</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
</span><span id="Grace.collect_output-874"><a href="#Grace.collect_output-874"><span class="linenos">874</span></a>
</span><span id="Grace.collect_output-875"><a href="#Grace.collect_output-875"><span class="linenos">875</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compress</span><span class="p">()</span>
</span><span id="Grace.collect_output-876"><a href="#Grace.collect_output-876"><span class="linenos">876</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Collect and store the results of a calculation.</p>

<p>This method parses the final structure, trajectory, and other output properties
from the calculation and stores them in HDF5 format. The internal structure
is updated, and various properties such as energies, structure, forces, and 
stresses are saved to the output group.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="Grace.get_structure" class="classattr">
                                        <input id="Grace.get_structure-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_structure</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span></span><span class="return-annotation">) -> <span class="n">ase</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">Atoms</span>:</span></span>

                <label class="view-source-button" for="Grace.get_structure-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace.get_structure"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace.get_structure-878"><a href="#Grace.get_structure-878"><span class="linenos">878</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Atoms</span><span class="p">:</span>
</span><span id="Grace.get_structure-879"><a href="#Grace.get_structure-879"><span class="linenos">879</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace.get_structure-880"><a href="#Grace.get_structure-880"><span class="linenos">880</span></a><span class="sd">        Retrieve the structure at a given frame from the calculation output.</span>
</span><span id="Grace.get_structure-881"><a href="#Grace.get_structure-881"><span class="linenos">881</span></a>
</span><span id="Grace.get_structure-882"><a href="#Grace.get_structure-882"><span class="linenos">882</span></a><span class="sd">        This function returns the atomic structure (positions, cell, species) at the</span>
</span><span id="Grace.get_structure-883"><a href="#Grace.get_structure-883"><span class="linenos">883</span></a><span class="sd">        specified frame index. The frame index is adjusted to ensure it is valid.</span>
</span><span id="Grace.get_structure-884"><a href="#Grace.get_structure-884"><span class="linenos">884</span></a>
</span><span id="Grace.get_structure-885"><a href="#Grace.get_structure-885"><span class="linenos">885</span></a><span class="sd">        Parameters</span>
</span><span id="Grace.get_structure-886"><a href="#Grace.get_structure-886"><span class="linenos">886</span></a><span class="sd">        ----------</span>
</span><span id="Grace.get_structure-887"><a href="#Grace.get_structure-887"><span class="linenos">887</span></a><span class="sd">        frame : int, optional</span>
</span><span id="Grace.get_structure-888"><a href="#Grace.get_structure-888"><span class="linenos">888</span></a><span class="sd">            The frame index to retrieve. If negative, it is counted from the last frame,</span>
</span><span id="Grace.get_structure-889"><a href="#Grace.get_structure-889"><span class="linenos">889</span></a><span class="sd">            by default -1.</span>
</span><span id="Grace.get_structure-890"><a href="#Grace.get_structure-890"><span class="linenos">890</span></a>
</span><span id="Grace.get_structure-891"><a href="#Grace.get_structure-891"><span class="linenos">891</span></a><span class="sd">        Returns</span>
</span><span id="Grace.get_structure-892"><a href="#Grace.get_structure-892"><span class="linenos">892</span></a><span class="sd">        -------</span>
</span><span id="Grace.get_structure-893"><a href="#Grace.get_structure-893"><span class="linenos">893</span></a><span class="sd">        Atoms</span>
</span><span id="Grace.get_structure-894"><a href="#Grace.get_structure-894"><span class="linenos">894</span></a><span class="sd">            The ASE Atoms object representing the structure at the given frame.</span>
</span><span id="Grace.get_structure-895"><a href="#Grace.get_structure-895"><span class="linenos">895</span></a>
</span><span id="Grace.get_structure-896"><a href="#Grace.get_structure-896"><span class="linenos">896</span></a><span class="sd">        Raises</span>
</span><span id="Grace.get_structure-897"><a href="#Grace.get_structure-897"><span class="linenos">897</span></a><span class="sd">        ------</span>
</span><span id="Grace.get_structure-898"><a href="#Grace.get_structure-898"><span class="linenos">898</span></a><span class="sd">        ValueError</span>
</span><span id="Grace.get_structure-899"><a href="#Grace.get_structure-899"><span class="linenos">899</span></a><span class="sd">            If no structures are found in the job output.</span>
</span><span id="Grace.get_structure-900"><a href="#Grace.get_structure-900"><span class="linenos">900</span></a><span class="sd">        IndexError</span>
</span><span id="Grace.get_structure-901"><a href="#Grace.get_structure-901"><span class="linenos">901</span></a><span class="sd">            If the frame index is out of range.</span>
</span><span id="Grace.get_structure-902"><a href="#Grace.get_structure-902"><span class="linenos">902</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace.get_structure-903"><a href="#Grace.get_structure-903"><span class="linenos">903</span></a>        <span class="n">num_structures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_structures</span>
</span><span id="Grace.get_structure-904"><a href="#Grace.get_structure-904"><span class="linenos">904</span></a>        <span class="k">if</span> <span class="n">num_structures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Grace.get_structure-905"><a href="#Grace.get_structure-905"><span class="linenos">905</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No structures found in the job output.&quot;</span><span class="p">)</span>
</span><span id="Grace.get_structure-906"><a href="#Grace.get_structure-906"><span class="linenos">906</span></a>
</span><span id="Grace.get_structure-907"><a href="#Grace.get_structure-907"><span class="linenos">907</span></a>        <span class="c1"># Ensure frame is valid</span>
</span><span id="Grace.get_structure-908"><a href="#Grace.get_structure-908"><span class="linenos">908</span></a>        <span class="k">if</span> <span class="n">frame</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Grace.get_structure-909"><a href="#Grace.get_structure-909"><span class="linenos">909</span></a>            <span class="n">frame</span> <span class="o">+=</span> <span class="n">num_structures</span>
</span><span id="Grace.get_structure-910"><a href="#Grace.get_structure-910"><span class="linenos">910</span></a>        <span class="k">if</span> <span class="n">frame</span> <span class="o">&gt;=</span> <span class="n">num_structures</span><span class="p">:</span>
</span><span id="Grace.get_structure-911"><a href="#Grace.get_structure-911"><span class="linenos">911</span></a>            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Grace.get_structure-912"><a href="#Grace.get_structure-912"><span class="linenos">912</span></a>                <span class="sa">f</span><span class="s2">&quot;Frame </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s2"> is out of range for </span><span class="si">{</span><span class="n">num_structures</span><span class="si">}</span><span class="s2"> structures.&quot;</span><span class="p">)</span>
</span><span id="Grace.get_structure-913"><a href="#Grace.get_structure-913"><span class="linenos">913</span></a>
</span><span id="Grace.get_structure-914"><a href="#Grace.get_structure-914"><span class="linenos">914</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/generic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace.get_structure-915"><a href="#Grace.get_structure-915"><span class="linenos">915</span></a>            <span class="n">positions</span> <span class="o">=</span> <span class="n">h5out</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="n">frame</span><span class="p">]</span>
</span><span id="Grace.get_structure-916"><a href="#Grace.get_structure-916"><span class="linenos">916</span></a>            <span class="n">cell</span> <span class="o">=</span> <span class="n">h5out</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">][</span><span class="n">frame</span><span class="p">]</span>
</span><span id="Grace.get_structure-917"><a href="#Grace.get_structure-917"><span class="linenos">917</span></a>        <span class="c1"># Read positions and cell</span>
</span><span id="Grace.get_structure-918"><a href="#Grace.get_structure-918"><span class="linenos">918</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;output/structure&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h5out</span><span class="p">:</span>
</span><span id="Grace.get_structure-919"><a href="#Grace.get_structure-919"><span class="linenos">919</span></a>            <span class="n">species</span> <span class="o">=</span> <span class="n">h5out</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">]</span>
</span><span id="Grace.get_structure-920"><a href="#Grace.get_structure-920"><span class="linenos">920</span></a>            <span class="n">indices</span> <span class="o">=</span> <span class="n">h5out</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span>
</span><span id="Grace.get_structure-921"><a href="#Grace.get_structure-921"><span class="linenos">921</span></a>
</span><span id="Grace.get_structure-922"><a href="#Grace.get_structure-922"><span class="linenos">922</span></a>        <span class="c1"># Generate symbols list</span>
</span><span id="Grace.get_structure-923"><a href="#Grace.get_structure-923"><span class="linenos">923</span></a>        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
</span><span id="Grace.get_structure-924"><a href="#Grace.get_structure-924"><span class="linenos">924</span></a>        <span class="k">return</span> <span class="n">ase_to_pyiron</span><span class="p">(</span><span class="n">Atoms</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the structure at a given frame from the calculation output.</p>

<p>This function returns the atomic structure (positions, cell, species) at the
specified frame index. The frame index is adjusted to ensure it is valid.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>frame</strong> (int, optional):
The frame index to retrieve. If negative, it is counted from the last frame,
by default -1.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Atoms</strong>: The ASE Atoms object representing the structure at the given frame.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If no structures are found in the job output.</li>
<li><strong>IndexError</strong>: If the frame index is out of range.</li>
</ul>
</div>


                            </div>
                            <div id="Grace.compress" class="classattr">
                                        <input id="Grace.compress-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compress</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">files_to_compress</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Grace.compress-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Grace.compress"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Grace.compress-926"><a href="#Grace.compress-926"><span class="linenos">926</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files_to_compress</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Grace.compress-927"><a href="#Grace.compress-927"><span class="linenos">927</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Grace.compress-928"><a href="#Grace.compress-928"><span class="linenos">928</span></a><span class="sd">        Compress the output files of a job object.</span>
</span><span id="Grace.compress-929"><a href="#Grace.compress-929"><span class="linenos">929</span></a><span class="sd">    </span>
</span><span id="Grace.compress-930"><a href="#Grace.compress-930"><span class="linenos">930</span></a><span class="sd">        Args:</span>
</span><span id="Grace.compress-931"><a href="#Grace.compress-931"><span class="linenos">931</span></a><span class="sd">            files_to_compress (list): A list of files to compress (optional)</span>
</span><span id="Grace.compress-932"><a href="#Grace.compress-932"><span class="linenos">932</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Grace.compress-933"><a href="#Grace.compress-933"><span class="linenos">933</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="Grace.compress-934"><a href="#Grace.compress-934"><span class="linenos">934</span></a>        <span class="c1"># delete empty files</span>
</span><span id="Grace.compress-935"><a href="#Grace.compress-935"><span class="linenos">935</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
</span><span id="Grace.compress-936"><a href="#Grace.compress-936"><span class="linenos">936</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Grace.compress-937"><a href="#Grace.compress-937"><span class="linenos">937</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Grace.compress-938"><a href="#Grace.compress-938"><span class="linenos">938</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Grace.compress-939"><a href="#Grace.compress-939"><span class="linenos">939</span></a>        <span class="c1"># delete slurm scripts</span>
</span><span id="Grace.compress-940"><a href="#Grace.compress-940"><span class="linenos">940</span></a>        <span class="k">if</span> <span class="s2">&quot;run_queue.sh&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
</span><span id="Grace.compress-941"><a href="#Grace.compress-941"><span class="linenos">941</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s2">&quot;run_queue.sh&quot;</span><span class="p">)</span>
</span><span id="Grace.compress-942"><a href="#Grace.compress-942"><span class="linenos">942</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Grace.compress-943"><a href="#Grace.compress-943"><span class="linenos">943</span></a>        <span class="c1"># compress all remaining files</span>
</span><span id="Grace.compress-944"><a href="#Grace.compress-944"><span class="linenos">944</span></a>        <span class="k">if</span> <span class="n">files_to_compress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Grace.compress-945"><a href="#Grace.compress-945"><span class="linenos">945</span></a>            <span class="n">files_to_compress</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Grace.compress-946"><a href="#Grace.compress-946"><span class="linenos">946</span></a>                <span class="n">f</span>
</span><span id="Grace.compress-947"><a href="#Grace.compress-947"><span class="linenos">947</span></a>                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</span><span id="Grace.compress-948"><a href="#Grace.compress-948"><span class="linenos">948</span></a>                <span class="k">if</span> <span class="n">f</span>
</span><span id="Grace.compress-949"><a href="#Grace.compress-949"><span class="linenos">949</span></a>                <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="Grace.compress-950"><a href="#Grace.compress-950"><span class="linenos">950</span></a>                    <span class="s2">&quot;final_structure.cif&quot;</span><span class="p">,</span>
</span><span id="Grace.compress-951"><a href="#Grace.compress-951"><span class="linenos">951</span></a>                <span class="p">]</span>
</span><span id="Grace.compress-952"><a href="#Grace.compress-952"><span class="linenos">952</span></a>            <span class="p">]</span>
</span><span id="Grace.compress-953"><a href="#Grace.compress-953"><span class="linenos">953</span></a>        
</span><span id="Grace.compress-954"><a href="#Grace.compress-954"><span class="linenos">954</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Grace</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">files_to_compress</span><span class="o">=</span><span class="n">files_to_compress</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compress the output files of a job object.</p>

<p>Args:
    files_to_compress (list): A list of files to compress (optional)</p>
</div>


                            </div>
                </section>
                <section id="CalcParams">
                            <input id="CalcParams-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CalcParams</span><wbr>(<span class="base">pyiron_base.storage.parameters.GenericParameters</span>):

                <label class="view-source-button" for="CalcParams-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CalcParams"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CalcParams-957"><a href="#CalcParams-957"><span class="linenos">957</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CalcParams</span><span class="p">(</span><span class="n">GenericParameters</span><span class="p">):</span>
</span><span id="CalcParams-958"><a href="#CalcParams-958"><span class="linenos">958</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CalcParams-959"><a href="#CalcParams-959"><span class="linenos">959</span></a><span class="sd">    Class to manage the calculation parameters for Grace calculations.</span>
</span><span id="CalcParams-960"><a href="#CalcParams-960"><span class="linenos">960</span></a>
</span><span id="CalcParams-961"><a href="#CalcParams-961"><span class="linenos">961</span></a><span class="sd">    This class extends from `GenericParameters` and is used to define and manage</span>
</span><span id="CalcParams-962"><a href="#CalcParams-962"><span class="linenos">962</span></a><span class="sd">    parameters specific to Grace calculations. It allows for initialization of</span>
</span><span id="CalcParams-963"><a href="#CalcParams-963"><span class="linenos">963</span></a><span class="sd">    parameters and stores them in a table, with a default table name of &quot;grace&quot;.</span>
</span><span id="CalcParams-964"><a href="#CalcParams-964"><span class="linenos">964</span></a><span class="sd">    The class can be used to load and store various Grace calculation settings and</span>
</span><span id="CalcParams-965"><a href="#CalcParams-965"><span class="linenos">965</span></a><span class="sd">    other related configurations.</span>
</span><span id="CalcParams-966"><a href="#CalcParams-966"><span class="linenos">966</span></a>
</span><span id="CalcParams-967"><a href="#CalcParams-967"><span class="linenos">967</span></a><span class="sd">    Parameters</span>
</span><span id="CalcParams-968"><a href="#CalcParams-968"><span class="linenos">968</span></a><span class="sd">    ----------</span>
</span><span id="CalcParams-969"><a href="#CalcParams-969"><span class="linenos">969</span></a><span class="sd">    table_name : str, optional</span>
</span><span id="CalcParams-970"><a href="#CalcParams-970"><span class="linenos">970</span></a><span class="sd">        The name of the table where the parameters are stored. By default, it is set</span>
</span><span id="CalcParams-971"><a href="#CalcParams-971"><span class="linenos">971</span></a><span class="sd">        to &quot;grace&quot;, but it can be customized if necessary.</span>
</span><span id="CalcParams-972"><a href="#CalcParams-972"><span class="linenos">972</span></a>
</span><span id="CalcParams-973"><a href="#CalcParams-973"><span class="linenos">973</span></a><span class="sd">    Methods</span>
</span><span id="CalcParams-974"><a href="#CalcParams-974"><span class="linenos">974</span></a><span class="sd">    -------</span>
</span><span id="CalcParams-975"><a href="#CalcParams-975"><span class="linenos">975</span></a><span class="sd">    __init__(self, table_name=&quot;grace&quot;)</span>
</span><span id="CalcParams-976"><a href="#CalcParams-976"><span class="linenos">976</span></a><span class="sd">        Initializes the parameters for the calculation.</span>
</span><span id="CalcParams-977"><a href="#CalcParams-977"><span class="linenos">977</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CalcParams-978"><a href="#CalcParams-978"><span class="linenos">978</span></a>
</span><span id="CalcParams-979"><a href="#CalcParams-979"><span class="linenos">979</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;grace&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CalcParams-980"><a href="#CalcParams-980"><span class="linenos">980</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CalcParams-981"><a href="#CalcParams-981"><span class="linenos">981</span></a><span class="sd">        Initialize the CalcParams object with the given table name.</span>
</span><span id="CalcParams-982"><a href="#CalcParams-982"><span class="linenos">982</span></a>
</span><span id="CalcParams-983"><a href="#CalcParams-983"><span class="linenos">983</span></a><span class="sd">        Parameters</span>
</span><span id="CalcParams-984"><a href="#CalcParams-984"><span class="linenos">984</span></a><span class="sd">        ----------</span>
</span><span id="CalcParams-985"><a href="#CalcParams-985"><span class="linenos">985</span></a><span class="sd">        table_name : str, optional</span>
</span><span id="CalcParams-986"><a href="#CalcParams-986"><span class="linenos">986</span></a><span class="sd">            The name of the table where the parameters are stored. By default,</span>
</span><span id="CalcParams-987"><a href="#CalcParams-987"><span class="linenos">987</span></a><span class="sd">            it is set to &quot;grace&quot;.</span>
</span><span id="CalcParams-988"><a href="#CalcParams-988"><span class="linenos">988</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CalcParams-989"><a href="#CalcParams-989"><span class="linenos">989</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">CalcParams</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CalcParams-990"><a href="#CalcParams-990"><span class="linenos">990</span></a>            <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
</span><span id="CalcParams-991"><a href="#CalcParams-991"><span class="linenos">991</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Class to manage the calculation parameters for Grace calculations.</p>

<p>This class extends from <code>GenericParameters</code> and is used to define and manage
parameters specific to Grace calculations. It allows for initialization of
parameters and stores them in a table, with a default table name of "grace".
The class can be used to load and store various Grace calculation settings and
other related configurations.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>table_name</strong> (str, optional):
The name of the table where the parameters are stored. By default, it is set
to "grace", but it can be customized if necessary.</li>
</ul>

<h6 id="methods">Methods</h6>

<p>__init__(self, table_name="grace")
    Initializes the parameters for the calculation.</p>
</div>


                            <div id="CalcParams.__init__" class="classattr">
                                        <input id="CalcParams.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CalcParams</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;grace&#39;</span></span>)</span>

                <label class="view-source-button" for="CalcParams.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CalcParams.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CalcParams.__init__-979"><a href="#CalcParams.__init__-979"><span class="linenos">979</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;grace&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CalcParams.__init__-980"><a href="#CalcParams.__init__-980"><span class="linenos">980</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="CalcParams.__init__-981"><a href="#CalcParams.__init__-981"><span class="linenos">981</span></a><span class="sd">        Initialize the CalcParams object with the given table name.</span>
</span><span id="CalcParams.__init__-982"><a href="#CalcParams.__init__-982"><span class="linenos">982</span></a>
</span><span id="CalcParams.__init__-983"><a href="#CalcParams.__init__-983"><span class="linenos">983</span></a><span class="sd">        Parameters</span>
</span><span id="CalcParams.__init__-984"><a href="#CalcParams.__init__-984"><span class="linenos">984</span></a><span class="sd">        ----------</span>
</span><span id="CalcParams.__init__-985"><a href="#CalcParams.__init__-985"><span class="linenos">985</span></a><span class="sd">        table_name : str, optional</span>
</span><span id="CalcParams.__init__-986"><a href="#CalcParams.__init__-986"><span class="linenos">986</span></a><span class="sd">            The name of the table where the parameters are stored. By default,</span>
</span><span id="CalcParams.__init__-987"><a href="#CalcParams.__init__-987"><span class="linenos">987</span></a><span class="sd">            it is set to &quot;grace&quot;.</span>
</span><span id="CalcParams.__init__-988"><a href="#CalcParams.__init__-988"><span class="linenos">988</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CalcParams.__init__-989"><a href="#CalcParams.__init__-989"><span class="linenos">989</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">CalcParams</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CalcParams.__init__-990"><a href="#CalcParams.__init__-990"><span class="linenos">990</span></a>            <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
</span><span id="CalcParams.__init__-991"><a href="#CalcParams.__init__-991"><span class="linenos">991</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the CalcParams object with the given table name.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>table_name</strong> (str, optional):
The name of the table where the parameters are stored. By default,
it is set to "grace".</li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>