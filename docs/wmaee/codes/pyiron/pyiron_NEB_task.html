<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>wmaee.codes.pyiron.pyiron_NEB_task API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../../../index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;
                Module Index
            </a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#module-name-pyiron_neb_taskpy">Module Name: pyiron_NEB_task.py</a></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#get_species_symbols_new">get_species_symbols_new</a>
            </li>
            <li>
                    <a class="class" href="#NEB">NEB</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#NEB.__init__">NEB</a>
                        </li>
                        <li>
                                <a class="variable" href="#NEB.pr">pr</a>
                        </li>
                        <li>
                                <a class="variable" href="#NEB.initial">initial</a>
                        </li>
                        <li>
                                <a class="function" href="#NEB.add_initial_state">add_initial_state</a>
                        </li>
                        <li>
                                <a class="function" href="#NEB.set_initial_state">set_initial_state</a>
                        </li>
                        <li>
                                <a class="function" href="#NEB.set_final_state">set_final_state</a>
                        </li>
                        <li>
                                <a class="function" href="#NEB.reorder_final">reorder_final</a>
                        </li>
                        <li>
                                <a class="function" href="#NEB.create_neb_job">create_neb_job</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#NEBjob">NEBjob</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#NEBjob.get_initial_images">get_initial_images</a>
                        </li>
                        <li>
                                <a class="function" href="#NEBjob.get_final_images">get_final_images</a>
                        </li>
                        <li>
                                <a class="function" href="#NEBjob.write_and_transfer_to_remote">write_and_transfer_to_remote</a>
                        </li>
                        <li>
                                <a class="function" href="#NEBjob.collect_data">collect_data</a>
                        </li>
                        <li>
                                <a class="function" href="#NEBjob.transfer_from_remote_and_collect">transfer_from_remote_and_collect</a>
                        </li>
                        <li>
                                <a class="function" href="#NEBjob.get_energy_fit">get_energy_fit</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
wmaee<wbr>.codes<wbr>.pyiron<wbr>.pyiron_NEB_task    </h1>

                        <div class="docstring"><p>==============================================================================</p>

<h1 id="module-name-pyiron_neb_taskpy">Module Name: pyiron_NEB_task.py</h1>

<p>Description:
    This module provides a framework for setting up and executing NEB (Nudged
    Elastic Band) calculations using the pyiron framework with VASP. It includes
    classes and methods to manage initial and final states, reorder atoms,
    create NEB jobs, handle image interpolation, and collect and fit energy data.</p>

<pre><code>WARNING: It assumes remote and manual execution of VASP (on the cluster), it 
only handles transfer of the input/output files, not the execution (as should 
be ideally the case with pyiron).
</code></pre>

<p>Dependencies:
    - pyiron_atomistics
    - pyiron_base
    - NumPy
    - SciPy</p>

<p>Usage:
    from NEB import NEB
    # Create a NEB object, set initial and final states, and run the NEB calculation
    neb = NEB(pr, 'NEB_Calculation')
    neb.set_initial_state(initial_job)
    neb.set_final_state(final_job)
    neb_job = neb.create_neb_job(job_name='neb', nImages=5)
    neb_job.write_and_transfer_to_remote()
    # run the job manually on HPC
    neb_job.transfer_from_remote_and_collect()
    # get the barrier
    print(job['output/neb/barrier_forward'])</p>

<p>==============================================================================</p>
</div>

                        <input id="mod-pyiron_NEB_task-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-pyiron_NEB_task-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">==============================================================================</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">Module Name: pyiron_NEB_task.py</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">==============================================================================</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">Description:</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">    This module provides a framework for setting up and executing NEB (Nudged</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">    Elastic Band) calculations using the pyiron framework with VASP. It includes</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">    classes and methods to manage initial and final states, reorder atoms,</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">    create NEB jobs, handle image interpolation, and collect and fit energy data.</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">    </span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">    WARNING: It assumes remote and manual execution of VASP (on the cluster), it </span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">    only handles transfer of the input/output files, not the execution (as should </span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">    be ideally the case with pyiron).</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">Dependencies:</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">    - pyiron_atomistics</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">    - pyiron_base</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">    - NumPy</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">    - SciPy</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">Usage:</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">    from NEB import NEB</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">    # Create a NEB object, set initial and final states, and run the NEB calculation</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    neb = NEB(pr, &#39;NEB_Calculation&#39;)</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    neb.set_initial_state(initial_job)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    neb.set_final_state(final_job)</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    neb_job = neb.create_neb_job(job_name=&#39;neb&#39;, nImages=5)</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    neb_job.write_and_transfer_to_remote()</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    # run the job manually on HPC</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    neb_job.transfer_from_remote_and_collect()</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    # get the barrier</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    print(job[&#39;output/neb/barrier_forward&#39;])</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">==============================================================================</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;David Holec&quot;</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.0.1&quot;</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;david.holec@unileoben.ac.ay&quot;</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="n">__status__</span> <span class="o">=</span> <span class="s2">&quot;Prototype&quot;</span>  <span class="c1"># Options: &quot;Development&quot;, &quot;Production&quot;, &quot;Prototype&quot;</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;2024-08-09&quot;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;BSD 3-Clause License&quot;</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="kn">from</span> <span class="nn">pyiron_atomistics.vasp.vasp</span> <span class="kn">import</span> <span class="n">Vasp</span> <span class="k">as</span> <span class="n">Vasp_job</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="kn">from</span> <span class="nn">pyiron_atomistics.vasp.structure</span> <span class="kn">import</span> <span class="n">read_atoms</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="kn">from</span> <span class="nn">pyiron_atomistics.vasp.parser.oszicar</span> <span class="kn">import</span> <span class="n">Oszicar</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="kn">from</span> <span class="nn">pyiron_atomistics.atomistics.job.atomistic</span> <span class="kn">import</span> <span class="n">Trajectory</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="kn">from</span> <span class="nn">pyiron_atomistics.atomistics.structure.atoms</span> <span class="kn">import</span> <span class="n">Atoms</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="kn">from</span> <span class="nn">pyiron_base</span> <span class="kn">import</span> <span class="n">state</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="kn">from</span> <span class="nn">pyiron_base.jobs.job.extension.jobstatus</span> <span class="kn">import</span> <span class="n">job_status_successful_lst</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="kn">import</span> <span class="nn">os.path</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">rmtree</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="kn">from</span> <span class="nn">numpy.polynomial</span> <span class="kn">import</span> <span class="n">Polynomial</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="k">def</span> <span class="nf">get_species_symbols_new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    MONKEY PATCH to get correct order of POTCARs.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">    </span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    Returns:</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        numpy.ndarray: List of the symbols of the species.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="n">sp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="k">if</span> <span class="n">el</span> <span class="o">!=</span> <span class="n">sp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>            <span class="n">sp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">Abbreviation</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">sp</span><span class="p">])</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="c1"># Patch the `get_species_symbols` method of the `Atoms` class</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="n">Atoms</span><span class="o">.</span><span class="n">get_species_symbols</span> <span class="o">=</span> <span class="n">get_species_symbols_new</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="k">def</span> <span class="nf">_wrap_positions</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">wrap</span><span class="p">):</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">    Wrap atomic positions into the unit cell.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">    Parameters:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        struct (Atoms): Atomic structure.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        wrap (float or list): Wrap value(s) for each dimension.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">    Returns:</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">        Atoms: Structure with wrapped positions.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wrap</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="n">wrap</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrap</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>    <span class="n">new_pos</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">struct</span><span class="o">.</span><span class="n">get_scaled_positions</span><span class="p">():</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>            <span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">wrap</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>                <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">1.0</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="n">new_pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="n">struct</span><span class="o">.</span><span class="n">set_scaled_positions</span><span class="p">(</span><span class="n">new_pos</span><span class="p">)</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="k">return</span> <span class="n">struct</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="k">class</span> <span class="nc">NEB</span><span class="p">():</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">    Class to handle the setup and execution of NEB (Nudged Elastic Band) calculations.</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">NEB_calc_name</span><span class="p">):</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        Initialize the NEB class.</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">        Parameters:</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">            pr (Project): Pyiron project object.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">            NEB_calc_name (str): Name of the NEB calculation.</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pr</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">NEB_calc_name</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="nf">add_initial_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_job</span><span class="p">,</span> <span class="n">delete_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">        Add the initial state for the NEB calculation.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        Parameters:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">            initial_job (Vasp_job): Initial state as a VASP job.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">            delete_existing (bool, optional): Whether to delete existing files.</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">        </span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">        Raises:</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">            TypeError: If `initial_job` is not of type `Vasp_job`.</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">initial_job</span><span class="p">,</span> <span class="n">Vasp_job</span><span class="p">):</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Initial job must be a VASP job (pyiron_atomistics.vasp.vasp.Vasp)&quot;</span><span class="p">)</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_job</span> <span class="o">=</span> <span class="n">initial_job</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">initial_job</span><span class="o">.</span><span class="n">get_structure</span><span class="p">()</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">initial_job</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(),</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="c1"># Setup symbolic links and directory structure</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="n">rel_path_to_initial</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_job</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;initial.h5&#39;</span><span class="p">)</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>                <span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;initial_hdf5&#39;</span><span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>                <span class="k">pass</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">rel_path_to_initial</span><span class="o">+</span><span class="s1">&#39;.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;initial.h5&#39;</span><span class="p">)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;initial_hdf5&#39;</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;initial_hdf5&#39;</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="n">rel_path_to_initial</span><span class="o">+</span><span class="s1">&#39;_hdf5&#39;</span><span class="p">,</span> <span class="n">initial_job</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="s1">&#39;initial&#39;</span><span class="p">,</span> <span class="n">target_is_directory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">set_initial_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_job</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">        Set the initial state from an existing VASP job.</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">        Parameters:</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">            initial_job (Vasp_job): Initial state as a VASP job.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_job</span> <span class="o">=</span> <span class="n">initial_job</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="n">struct</span> <span class="o">=</span> <span class="n">initial_job</span><span class="o">.</span><span class="n">get_structure</span><span class="p">()</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">struct</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>    
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">set_final_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_job</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        Set the final state for the NEB calculation.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">        Parameters:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">            final_job (Vasp_job): Final state as a VASP job.</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final_job</span> <span class="o">=</span> <span class="n">final_job</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="n">struct</span> <span class="o">=</span> <span class="n">final_job</span><span class="o">.</span><span class="n">get_structure</span><span class="p">()</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">struct</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="nf">reorder_final</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">moving_index</span><span class="p">,</span> <span class="n">max_shift</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">        Reorder the final structure based on the initial structure.</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">        Parameters:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">            moving_index (int): Index of the moving atom.</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">            max_shift (float, optional): Maximum allowable shift for atom mapping.</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">            verbose (bool, optional): If True, prints information about the atom positions.</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">        </span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">        Raises:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">            Exception: If there are issues with the atom mapping.</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="n">final</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>            <span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>            <span class="n">final</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">final</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>            
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="n">mapped</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">final</span><span class="p">))]</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="n">mapping</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initial</span><span class="p">))]</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="k">for</span> <span class="n">iat</span><span class="p">,</span> <span class="n">at</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">initial</span><span class="p">):</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="k">if</span> <span class="n">iat</span> <span class="o">==</span> <span class="n">moving_index</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;position in the initial structure:&#39;</span><span class="p">,</span> <span class="n">at</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>                <span class="n">nn</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">get_neighborhood</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="n">max_shift</span><span class="p">)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">distances</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with mapping: atom </span><span class="si">{</span><span class="n">iat</span><span class="si">}</span><span class="s2"> in the initial structure was identified with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">distances</span><span class="p">)</span><span class="si">}</span><span class="s2"> images&quot;</span><span class="p">)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>                <span class="k">elif</span> <span class="n">mapped</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with mapping: atom </span><span class="si">{</span><span class="n">iat</span><span class="si">}</span><span class="s2"> in the initial should be mapped to </span><span class="si">{</span><span class="n">nn</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> in the final structure but this atom has already been mapped.&quot;</span><span class="p">)</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>                    <span class="n">mapped</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>                    <span class="n">mapping</span><span class="p">[</span><span class="n">iat</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="n">unmapped</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">final</span><span class="p">))</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">mapped</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unmapped</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with mapping: only 1 atom must remain after mapping! Unmapped atoms: </span><span class="si">{</span><span class="n">unmapped</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="n">mapping</span><span class="p">[</span><span class="n">moving_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">unmapped</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;position in the final structure:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">unmapped</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="n">new_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">final</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initial</span><span class="p">))]</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="n">new_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">final</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initial</span><span class="p">))]</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="n">new_final</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">create</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>            <span class="n">cell</span><span class="o">=</span><span class="n">final</span><span class="o">.</span><span class="n">cell</span><span class="p">,</span> 
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>            <span class="n">positions</span><span class="o">=</span><span class="n">new_positions</span><span class="p">,</span> 
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>            <span class="n">elements</span><span class="o">=</span><span class="n">new_elements</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="p">)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">new_final</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>    <span class="k">def</span> <span class="nf">create_neb_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="s1">&#39;neb&#39;</span><span class="p">,</span> <span class="n">nImages</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">        Create a NEB job.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        Parameters:</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">            job_name (str, optional): Name of the NEB job.</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">            nImages (int, optional): Number of images for the NEB calculation.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        </span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">        Returns:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">            NEBjob: Created NEB job object.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="p">[</span><span class="n">job_name</span><span class="p">]</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">create_job</span><span class="p">(</span><span class="n">job_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">job_type</span><span class="o">.</span><span class="n">Vasp</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="n">job_name</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>            <span class="n">job</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">NEBjob</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial</span>         
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">set_kpoints</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;GC&#39;</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">calc_minimize</span><span class="p">(</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>                <span class="n">electronic_steps</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>                <span class="n">retain_charge_density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;ISIF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;ENCUT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">520</span>  <span class="c1"># from MP</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;IMAGES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nImages</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;IBRION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;NFREE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;neb&#39;</span><span class="p">)</span>            
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;nImages&#39;</span><span class="p">,</span> <span class="n">nImages</span><span class="p">)</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;initial_image&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;final_image&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span><span class="p">)</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;initial_energy&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_job</span><span class="p">[</span><span class="s1">&#39;output/generic/energy_pot&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;final_energy&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_job</span><span class="p">[</span><span class="s1">&#39;output/generic/energy_pot&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">_create_images</span><span class="p">()</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">write_input</span><span class="p">()</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="n">state</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Job `</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s1">` exists. Loading from database instead of creating it!&#39;</span><span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="k">return</span> <span class="n">job</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="k">class</span> <span class="nc">NEBjob</span><span class="p">(</span><span class="n">Vasp_job</span><span class="p">):</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">    Class for handling specific NEB (Nudged Elastic Band) job operations.</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>    
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>    
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>    <span class="k">def</span> <span class="nf">_create_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">        Create interpolated images between the initial and final states.</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">        Parameters:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">(),</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="n">final</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/final_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">(),</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="n">nImages</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/nImages&#39;</span><span class="p">]</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nImages</span><span class="p">):</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>            <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">initial</span><span class="o">.</span><span class="n">cell</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">final</span><span class="o">.</span><span class="n">cell</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>            <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">initial</span><span class="o">.</span><span class="n">positions</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">final</span><span class="o">.</span><span class="n">positions</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;initial_cells&#39;</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;initial_positions&#39;</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>    <span class="k">def</span> <span class="nf">get_initial_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        Retrieve the initial interpolated images.</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">        Returns:</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">            Trajectory: Trajectory object containing the initial images.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_positions&#39;</span><span class="p">]</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_cells&#39;</span><span class="p">]</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="k">return</span> <span class="n">Trajectory</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">)</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>    
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>    <span class="k">def</span> <span class="nf">get_final_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">        Retrieve the final interpolated images after relaxation.</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">        Returns:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">            Trajectory: Trajectory object containing the final images.</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb/final_positions&#39;</span><span class="p">]</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb/final_cells&#39;</span><span class="p">]</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="k">return</span> <span class="n">Trajectory</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">)</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>    
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>    <span class="k">def</span> <span class="nf">_write_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">        Write the interpolated images to the appropriate directories.</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;_hdf5/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_name</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="n">nImages</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/nImages&#39;</span><span class="p">]</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>        <span class="n">initial_structs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_initial_images</span><span class="p">()</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>        
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nImages</span><span class="p">):</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="n">case</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">case</span><span class="p">):</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>            <span class="n">struct</span> <span class="o">=</span> <span class="n">initial_structs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>            <span class="n">struct</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;vasp&#39;</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>    
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>    <span class="k">def</span> <span class="nf">write_and_transfer_to_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">        Write the input files and transfer them to the remote cluster.</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">        Warnings:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="sd">            If the job is already marked as finished, a warning is issued and no action is taken.</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">job_status_successful_lst</span><span class="p">:</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_images</span><span class="p">()</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_input</span><span class="p">()</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>            
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">queue_adapter</span><span class="o">.</span><span class="n">convert_path_to_remote</span><span class="p">(</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">file_name</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>            <span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>            <span class="n">working_directory</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">queue_adapter</span><span class="o">.</span><span class="n">convert_path_to_remote</span><span class="p">(</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>                <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>            <span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;_hdf5/**&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>                
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>                    <span class="n">state</span><span class="o">.</span><span class="n">queue_adapter</span><span class="o">.</span><span class="n">transfer_file_to_remote</span><span class="p">(</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>                        <span class="n">file</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">transfer_back</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>                    <span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>            <span class="n">state</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Job `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="si">}</span><span class="s1">` is marked as finished, uploading doesn</span><span class="se">\&#39;</span><span class="s1">t make sense&#39;</span><span class="p">)</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>            
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>    <span class="k">def</span> <span class="nf">collect_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">        Collect the data from the NEB calculation.</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">        Parameters:</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">            wrap (float or bool, optional): Wrap value for atomic positions. Set to `False` to disable wrapping.</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;_hdf5/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_name</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>        <span class="n">nImages</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/nImages&#39;</span><span class="p">]</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>        <span class="n">final</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/final_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>        
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>            <span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>            <span class="n">final</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">final</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="n">cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial</span><span class="o">.</span><span class="n">cell</span><span class="p">]</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial</span><span class="o">.</span><span class="n">positions</span><span class="p">]</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="n">energy_pot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nImages</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>            <span class="n">case</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>            <span class="n">out</span> <span class="o">=</span> <span class="n">Oszicar</span><span class="p">()</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>            <span class="n">out</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span> <span class="n">case</span> <span class="o">+</span> <span class="s1">&#39;/OSZICAR&#39;</span><span class="p">)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>            <span class="n">energy_pot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">])</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>            <span class="n">struct</span> <span class="o">=</span> <span class="n">read_atoms</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span> <span class="n">case</span> <span class="o">+</span> <span class="s1">&#39;/CONTCAR&#39;</span><span class="p">)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>            <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>                <span class="n">struct</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>            <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>            <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="n">relaxation_steps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">])</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="n">energy_pot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="p">[[</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_energy&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">relaxation_steps</span><span class="p">]</span> <span class="o">+</span> 
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>            <span class="n">energy_pot</span> <span class="o">+</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>            <span class="p">[[</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/final_energy&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">relaxation_steps</span><span class="p">]</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;neb&#39;</span><span class="p">)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">,</span> <span class="n">energy_pot</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;final_cells&#39;</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;final_positions&#39;</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="n">ene</span> <span class="o">=</span> <span class="n">energy_pot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;barrier_forward&#39;</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">ene</span><span class="p">)</span> <span class="o">-</span> <span class="n">ene</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;barrier_backward&#39;</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">ene</span><span class="p">)</span> <span class="o">-</span> <span class="n">ene</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_polynomial_fit_with_derivative_constraints</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">nImages</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>    <span class="k">def</span> <span class="nf">transfer_from_remote_and_collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">        Transfer files from the remote cluster and collect data locally.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transfer_from_remote</span><span class="p">()</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">collect</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collect_data</span><span class="p">()</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>    
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>    <span class="k">def</span> <span class="nf">_polynomial_fit_with_derivative_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a><span class="sd">        Fit a polynomial to the NEB energy profile with derivative constraints.</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">        The polynomial is constrained such that its derivatives at x=0 and x=1 are zero.</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">        Parameters:</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">            n (int, optional): The order of the polynomial.</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">        Returns:</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">            Polynomial: The fitted polynomial.</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb/energy_pot&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>        
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>        <span class="k">def</span> <span class="nf">poly_val_and_deriv</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">            Evaluate the polynomial and its derivative.</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">            Parameters:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">                x (float or numpy.ndarray): Point(s) at which to evaluate.</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">            Returns:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">                tuple: Tuple containing the polynomial value and its derivative.</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>            <span class="n">dp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>            <span class="k">return</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>        <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">            Objective function to minimize.</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">            Parameters:</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="sd">                x (float or numpy.ndarray): x-values of the data points.</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="sd">                y (float or numpy.ndarray): y-values of the data points.</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">            Returns:</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="sd">                float: Sum of squared residuals.</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>            <span class="n">p_vals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">poly_val_and_deriv</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">p_vals</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="k">def</span> <span class="nf">constraint_deriv_0</span><span class="p">(</span><span class="n">coeffs</span><span class="p">):</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">            Constraint for the derivative at x=0 to be zero.</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">            Parameters:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">            Returns:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">                float: Derivative at x=0.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">dp0</span> <span class="o">=</span> <span class="n">poly_val_and_deriv</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>            <span class="k">return</span> <span class="n">dp0</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>        <span class="k">def</span> <span class="nf">constraint_deriv_1</span><span class="p">(</span><span class="n">coeffs</span><span class="p">):</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">            Constraint for the derivative at x=1 to be zero.</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">            Parameters:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">            Returns:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">                float: Derivative at x=1.</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">dp1</span> <span class="o">=</span> <span class="n">poly_val_and_deriv</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>            <span class="k">return</span> <span class="n">dp1</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="k">def</span> <span class="nf">constraint_val_0</span><span class="p">(</span><span class="n">coeffs</span><span class="p">):</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">            Constraint for the polynomial value at x=0 to match the first data point.</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">            Parameters:</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">            Returns:</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">                float: Difference between polynomial value at x=0 and y[0].</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>            <span class="n">p0</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">poly_val_and_deriv</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>            <span class="k">return</span> <span class="n">p0</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>        <span class="k">def</span> <span class="nf">constraint_val_1</span><span class="p">(</span><span class="n">coeffs</span><span class="p">):</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">            Constraint for the polynomial value at x=1 to match the last data point.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">            Parameters:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">            Returns:</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">                float: Difference between polynomial value at x=1 and y[-1].</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>            <span class="n">p1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">poly_val_and_deriv</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>            <span class="k">return</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>        <span class="n">initial_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="k">def</span> <span class="nf">constraint_max_val</span><span class="p">(</span><span class="n">coeffs</span><span class="p">):</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">            Constraint for the polynomial maximum to match the maximum y value.</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="sd">            Parameters:</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a><span class="sd">            Returns:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="sd">                float: Difference between maximum polynomial value and maximum y value.</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>            <span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>            <span class="n">p_vals</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">p_vals</span><span class="p">)</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint_deriv_0</span><span class="p">},</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint_deriv_1</span><span class="p">},</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint_val_0</span><span class="p">},</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint_val_1</span><span class="p">},</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint_max_val</span><span class="p">}</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>        <span class="p">]</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">)</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>        <span class="n">optimized_coeffs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>        <span class="n">fitted_polynomial</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">optimized_coeffs</span><span class="p">)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span> <span class="n">fitted_polynomial</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>    <span class="k">def</span> <span class="nf">get_energy_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a><span class="sd">        Get the fitted polynomial for the NEB energy profile.</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a><span class="sd">        Returns:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a><span class="sd">            Polynomial: The fitted polynomial.</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb/fit&#39;</span><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="get_species_symbols_new">
                            <input id="get_species_symbols_new-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_species_symbols_new</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_species_symbols_new-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_species_symbols_new"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_species_symbols_new-61"><a href="#get_species_symbols_new-61"><span class="linenos">61</span></a><span class="k">def</span> <span class="nf">get_species_symbols_new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="get_species_symbols_new-62"><a href="#get_species_symbols_new-62"><span class="linenos">62</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_species_symbols_new-63"><a href="#get_species_symbols_new-63"><span class="linenos">63</span></a><span class="sd">    MONKEY PATCH to get correct order of POTCARs.</span>
</span><span id="get_species_symbols_new-64"><a href="#get_species_symbols_new-64"><span class="linenos">64</span></a><span class="sd">    </span>
</span><span id="get_species_symbols_new-65"><a href="#get_species_symbols_new-65"><span class="linenos">65</span></a><span class="sd">    Returns:</span>
</span><span id="get_species_symbols_new-66"><a href="#get_species_symbols_new-66"><span class="linenos">66</span></a><span class="sd">        numpy.ndarray: List of the symbols of the species.</span>
</span><span id="get_species_symbols_new-67"><a href="#get_species_symbols_new-67"><span class="linenos">67</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_species_symbols_new-68"><a href="#get_species_symbols_new-68"><span class="linenos">68</span></a>    <span class="n">sp</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="get_species_symbols_new-69"><a href="#get_species_symbols_new-69"><span class="linenos">69</span></a>    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="get_species_symbols_new-70"><a href="#get_species_symbols_new-70"><span class="linenos">70</span></a>        <span class="k">if</span> <span class="n">el</span> <span class="o">!=</span> <span class="n">sp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="get_species_symbols_new-71"><a href="#get_species_symbols_new-71"><span class="linenos">71</span></a>            <span class="n">sp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
</span><span id="get_species_symbols_new-72"><a href="#get_species_symbols_new-72"><span class="linenos">72</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">Abbreviation</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">sp</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>MONKEY PATCH to get correct order of POTCARs.</p>

<p>Returns:
    numpy.ndarray: List of the symbols of the species.</p>
</div>


                </section>
                <section id="NEB">
                            <input id="NEB-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">NEB</span>:

                <label class="view-source-button" for="NEB-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEB"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEB-103"><a href="#NEB-103"><span class="linenos">103</span></a><span class="k">class</span> <span class="nc">NEB</span><span class="p">():</span>
</span><span id="NEB-104"><a href="#NEB-104"><span class="linenos">104</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEB-105"><a href="#NEB-105"><span class="linenos">105</span></a><span class="sd">    Class to handle the setup and execution of NEB (Nudged Elastic Band) calculations.</span>
</span><span id="NEB-106"><a href="#NEB-106"><span class="linenos">106</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="NEB-107"><a href="#NEB-107"><span class="linenos">107</span></a>    
</span><span id="NEB-108"><a href="#NEB-108"><span class="linenos">108</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">NEB_calc_name</span><span class="p">):</span>
</span><span id="NEB-109"><a href="#NEB-109"><span class="linenos">109</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEB-110"><a href="#NEB-110"><span class="linenos">110</span></a><span class="sd">        Initialize the NEB class.</span>
</span><span id="NEB-111"><a href="#NEB-111"><span class="linenos">111</span></a>
</span><span id="NEB-112"><a href="#NEB-112"><span class="linenos">112</span></a><span class="sd">        Parameters:</span>
</span><span id="NEB-113"><a href="#NEB-113"><span class="linenos">113</span></a><span class="sd">            pr (Project): Pyiron project object.</span>
</span><span id="NEB-114"><a href="#NEB-114"><span class="linenos">114</span></a><span class="sd">            NEB_calc_name (str): Name of the NEB calculation.</span>
</span><span id="NEB-115"><a href="#NEB-115"><span class="linenos">115</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEB-116"><a href="#NEB-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pr</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">NEB_calc_name</span><span class="p">)</span>
</span><span id="NEB-117"><a href="#NEB-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NEB-118"><a href="#NEB-118"><span class="linenos">118</span></a>        
</span><span id="NEB-119"><a href="#NEB-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">add_initial_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_job</span><span class="p">,</span> <span class="n">delete_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="NEB-120"><a href="#NEB-120"><span class="linenos">120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEB-121"><a href="#NEB-121"><span class="linenos">121</span></a><span class="sd">        Add the initial state for the NEB calculation.</span>
</span><span id="NEB-122"><a href="#NEB-122"><span class="linenos">122</span></a>
</span><span id="NEB-123"><a href="#NEB-123"><span class="linenos">123</span></a><span class="sd">        Parameters:</span>
</span><span id="NEB-124"><a href="#NEB-124"><span class="linenos">124</span></a><span class="sd">            initial_job (Vasp_job): Initial state as a VASP job.</span>
</span><span id="NEB-125"><a href="#NEB-125"><span class="linenos">125</span></a><span class="sd">            delete_existing (bool, optional): Whether to delete existing files.</span>
</span><span id="NEB-126"><a href="#NEB-126"><span class="linenos">126</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="NEB-127"><a href="#NEB-127"><span class="linenos">127</span></a><span class="sd">        </span>
</span><span id="NEB-128"><a href="#NEB-128"><span class="linenos">128</span></a><span class="sd">        Raises:</span>
</span><span id="NEB-129"><a href="#NEB-129"><span class="linenos">129</span></a><span class="sd">            TypeError: If `initial_job` is not of type `Vasp_job`.</span>
</span><span id="NEB-130"><a href="#NEB-130"><span class="linenos">130</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEB-131"><a href="#NEB-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">initial_job</span><span class="p">,</span> <span class="n">Vasp_job</span><span class="p">):</span>
</span><span id="NEB-132"><a href="#NEB-132"><span class="linenos">132</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Initial job must be a VASP job (pyiron_atomistics.vasp.vasp.Vasp)&quot;</span><span class="p">)</span>
</span><span id="NEB-133"><a href="#NEB-133"><span class="linenos">133</span></a>        
</span><span id="NEB-134"><a href="#NEB-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_job</span> <span class="o">=</span> <span class="n">initial_job</span>
</span><span id="NEB-135"><a href="#NEB-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">initial_job</span><span class="o">.</span><span class="n">get_structure</span><span class="p">()</span>
</span><span id="NEB-136"><a href="#NEB-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NEB-137"><a href="#NEB-137"><span class="linenos">137</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">initial_job</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(),</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEB-138"><a href="#NEB-138"><span class="linenos">138</span></a>        
</span><span id="NEB-139"><a href="#NEB-139"><span class="linenos">139</span></a>        <span class="c1"># Setup symbolic links and directory structure</span>
</span><span id="NEB-140"><a href="#NEB-140"><span class="linenos">140</span></a>        <span class="n">rel_path_to_initial</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_job</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="NEB-141"><a href="#NEB-141"><span class="linenos">141</span></a>        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</span><span id="NEB-142"><a href="#NEB-142"><span class="linenos">142</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="NEB-143"><a href="#NEB-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
</span><span id="NEB-144"><a href="#NEB-144"><span class="linenos">144</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="NEB-145"><a href="#NEB-145"><span class="linenos">145</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;initial.h5&#39;</span><span class="p">)</span>
</span><span id="NEB-146"><a href="#NEB-146"><span class="linenos">146</span></a>                <span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;initial_hdf5&#39;</span><span class="p">)</span>
</span><span id="NEB-147"><a href="#NEB-147"><span class="linenos">147</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="NEB-148"><a href="#NEB-148"><span class="linenos">148</span></a>                <span class="k">pass</span>
</span><span id="NEB-149"><a href="#NEB-149"><span class="linenos">149</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">rel_path_to_initial</span><span class="o">+</span><span class="s1">&#39;.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;initial.h5&#39;</span><span class="p">)</span>
</span><span id="NEB-150"><a href="#NEB-150"><span class="linenos">150</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;initial_hdf5&#39;</span><span class="p">)</span>
</span><span id="NEB-151"><a href="#NEB-151"><span class="linenos">151</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;initial_hdf5&#39;</span><span class="p">)</span>
</span><span id="NEB-152"><a href="#NEB-152"><span class="linenos">152</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="n">rel_path_to_initial</span><span class="o">+</span><span class="s1">&#39;_hdf5&#39;</span><span class="p">,</span> <span class="n">initial_job</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="s1">&#39;initial&#39;</span><span class="p">,</span> <span class="n">target_is_directory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="NEB-153"><a href="#NEB-153"><span class="linenos">153</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
</span><span id="NEB-154"><a href="#NEB-154"><span class="linenos">154</span></a>        
</span><span id="NEB-155"><a href="#NEB-155"><span class="linenos">155</span></a>    <span class="k">def</span> <span class="nf">set_initial_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_job</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="NEB-156"><a href="#NEB-156"><span class="linenos">156</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEB-157"><a href="#NEB-157"><span class="linenos">157</span></a><span class="sd">        Set the initial state from an existing VASP job.</span>
</span><span id="NEB-158"><a href="#NEB-158"><span class="linenos">158</span></a>
</span><span id="NEB-159"><a href="#NEB-159"><span class="linenos">159</span></a><span class="sd">        Parameters:</span>
</span><span id="NEB-160"><a href="#NEB-160"><span class="linenos">160</span></a><span class="sd">            initial_job (Vasp_job): Initial state as a VASP job.</span>
</span><span id="NEB-161"><a href="#NEB-161"><span class="linenos">161</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="NEB-162"><a href="#NEB-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEB-163"><a href="#NEB-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_job</span> <span class="o">=</span> <span class="n">initial_job</span>
</span><span id="NEB-164"><a href="#NEB-164"><span class="linenos">164</span></a>        <span class="n">struct</span> <span class="o">=</span> <span class="n">initial_job</span><span class="o">.</span><span class="n">get_structure</span><span class="p">()</span>
</span><span id="NEB-165"><a href="#NEB-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">struct</span>
</span><span id="NEB-166"><a href="#NEB-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NEB-167"><a href="#NEB-167"><span class="linenos">167</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEB-168"><a href="#NEB-168"><span class="linenos">168</span></a>    
</span><span id="NEB-169"><a href="#NEB-169"><span class="linenos">169</span></a>    <span class="k">def</span> <span class="nf">set_final_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_job</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="NEB-170"><a href="#NEB-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEB-171"><a href="#NEB-171"><span class="linenos">171</span></a><span class="sd">        Set the final state for the NEB calculation.</span>
</span><span id="NEB-172"><a href="#NEB-172"><span class="linenos">172</span></a>
</span><span id="NEB-173"><a href="#NEB-173"><span class="linenos">173</span></a><span class="sd">        Parameters:</span>
</span><span id="NEB-174"><a href="#NEB-174"><span class="linenos">174</span></a><span class="sd">            final_job (Vasp_job): Final state as a VASP job.</span>
</span><span id="NEB-175"><a href="#NEB-175"><span class="linenos">175</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="NEB-176"><a href="#NEB-176"><span class="linenos">176</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEB-177"><a href="#NEB-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final_job</span> <span class="o">=</span> <span class="n">final_job</span>
</span><span id="NEB-178"><a href="#NEB-178"><span class="linenos">178</span></a>        <span class="n">struct</span> <span class="o">=</span> <span class="n">final_job</span><span class="o">.</span><span class="n">get_structure</span><span class="p">()</span>
</span><span id="NEB-179"><a href="#NEB-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">struct</span>
</span><span id="NEB-180"><a href="#NEB-180"><span class="linenos">180</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NEB-181"><a href="#NEB-181"><span class="linenos">181</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEB-182"><a href="#NEB-182"><span class="linenos">182</span></a>        
</span><span id="NEB-183"><a href="#NEB-183"><span class="linenos">183</span></a>        
</span><span id="NEB-184"><a href="#NEB-184"><span class="linenos">184</span></a>    <span class="k">def</span> <span class="nf">reorder_final</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">moving_index</span><span class="p">,</span> <span class="n">max_shift</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="NEB-185"><a href="#NEB-185"><span class="linenos">185</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEB-186"><a href="#NEB-186"><span class="linenos">186</span></a><span class="sd">        Reorder the final structure based on the initial structure.</span>
</span><span id="NEB-187"><a href="#NEB-187"><span class="linenos">187</span></a>
</span><span id="NEB-188"><a href="#NEB-188"><span class="linenos">188</span></a><span class="sd">        Parameters:</span>
</span><span id="NEB-189"><a href="#NEB-189"><span class="linenos">189</span></a><span class="sd">            moving_index (int): Index of the moving atom.</span>
</span><span id="NEB-190"><a href="#NEB-190"><span class="linenos">190</span></a><span class="sd">            max_shift (float, optional): Maximum allowable shift for atom mapping.</span>
</span><span id="NEB-191"><a href="#NEB-191"><span class="linenos">191</span></a><span class="sd">            verbose (bool, optional): If True, prints information about the atom positions.</span>
</span><span id="NEB-192"><a href="#NEB-192"><span class="linenos">192</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="NEB-193"><a href="#NEB-193"><span class="linenos">193</span></a><span class="sd">        </span>
</span><span id="NEB-194"><a href="#NEB-194"><span class="linenos">194</span></a><span class="sd">        Raises:</span>
</span><span id="NEB-195"><a href="#NEB-195"><span class="linenos">195</span></a><span class="sd">            Exception: If there are issues with the atom mapping.</span>
</span><span id="NEB-196"><a href="#NEB-196"><span class="linenos">196</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEB-197"><a href="#NEB-197"><span class="linenos">197</span></a>        
</span><span id="NEB-198"><a href="#NEB-198"><span class="linenos">198</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial</span>
</span><span id="NEB-199"><a href="#NEB-199"><span class="linenos">199</span></a>        <span class="n">final</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span>
</span><span id="NEB-200"><a href="#NEB-200"><span class="linenos">200</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NEB-201"><a href="#NEB-201"><span class="linenos">201</span></a>            <span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEB-202"><a href="#NEB-202"><span class="linenos">202</span></a>            <span class="n">final</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">final</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEB-203"><a href="#NEB-203"><span class="linenos">203</span></a>            
</span><span id="NEB-204"><a href="#NEB-204"><span class="linenos">204</span></a>        <span class="n">mapped</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">final</span><span class="p">))]</span>
</span><span id="NEB-205"><a href="#NEB-205"><span class="linenos">205</span></a>        <span class="n">mapping</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initial</span><span class="p">))]</span>
</span><span id="NEB-206"><a href="#NEB-206"><span class="linenos">206</span></a>        
</span><span id="NEB-207"><a href="#NEB-207"><span class="linenos">207</span></a>        <span class="k">for</span> <span class="n">iat</span><span class="p">,</span> <span class="n">at</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">initial</span><span class="p">):</span>
</span><span id="NEB-208"><a href="#NEB-208"><span class="linenos">208</span></a>            <span class="k">if</span> <span class="n">iat</span> <span class="o">==</span> <span class="n">moving_index</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="NEB-209"><a href="#NEB-209"><span class="linenos">209</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;position in the initial structure:&#39;</span><span class="p">,</span> <span class="n">at</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
</span><span id="NEB-210"><a href="#NEB-210"><span class="linenos">210</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NEB-211"><a href="#NEB-211"><span class="linenos">211</span></a>                <span class="n">nn</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">get_neighborhood</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="n">max_shift</span><span class="p">)</span>
</span><span id="NEB-212"><a href="#NEB-212"><span class="linenos">212</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">distances</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="NEB-213"><a href="#NEB-213"><span class="linenos">213</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with mapping: atom </span><span class="si">{</span><span class="n">iat</span><span class="si">}</span><span class="s2"> in the initial structure was identified with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">distances</span><span class="p">)</span><span class="si">}</span><span class="s2"> images&quot;</span><span class="p">)</span>
</span><span id="NEB-214"><a href="#NEB-214"><span class="linenos">214</span></a>                <span class="k">elif</span> <span class="n">mapped</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
</span><span id="NEB-215"><a href="#NEB-215"><span class="linenos">215</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with mapping: atom </span><span class="si">{</span><span class="n">iat</span><span class="si">}</span><span class="s2"> in the initial should be mapped to </span><span class="si">{</span><span class="n">nn</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> in the final structure but this atom has already been mapped.&quot;</span><span class="p">)</span>
</span><span id="NEB-216"><a href="#NEB-216"><span class="linenos">216</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="NEB-217"><a href="#NEB-217"><span class="linenos">217</span></a>                    <span class="n">mapped</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NEB-218"><a href="#NEB-218"><span class="linenos">218</span></a>                    <span class="n">mapping</span><span class="p">[</span><span class="n">iat</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NEB-219"><a href="#NEB-219"><span class="linenos">219</span></a>        
</span><span id="NEB-220"><a href="#NEB-220"><span class="linenos">220</span></a>        <span class="n">unmapped</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">final</span><span class="p">))</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">mapped</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="NEB-221"><a href="#NEB-221"><span class="linenos">221</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unmapped</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="NEB-222"><a href="#NEB-222"><span class="linenos">222</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with mapping: only 1 atom must remain after mapping! Unmapped atoms: </span><span class="si">{</span><span class="n">unmapped</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NEB-223"><a href="#NEB-223"><span class="linenos">223</span></a>        
</span><span id="NEB-224"><a href="#NEB-224"><span class="linenos">224</span></a>        <span class="n">mapping</span><span class="p">[</span><span class="n">moving_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">unmapped</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NEB-225"><a href="#NEB-225"><span class="linenos">225</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="NEB-226"><a href="#NEB-226"><span class="linenos">226</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;position in the final structure:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">unmapped</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="NEB-227"><a href="#NEB-227"><span class="linenos">227</span></a>        
</span><span id="NEB-228"><a href="#NEB-228"><span class="linenos">228</span></a>        <span class="n">new_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">final</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initial</span><span class="p">))]</span>
</span><span id="NEB-229"><a href="#NEB-229"><span class="linenos">229</span></a>        <span class="n">new_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">final</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initial</span><span class="p">))]</span>
</span><span id="NEB-230"><a href="#NEB-230"><span class="linenos">230</span></a>        <span class="n">new_final</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">create</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span>
</span><span id="NEB-231"><a href="#NEB-231"><span class="linenos">231</span></a>            <span class="n">cell</span><span class="o">=</span><span class="n">final</span><span class="o">.</span><span class="n">cell</span><span class="p">,</span> 
</span><span id="NEB-232"><a href="#NEB-232"><span class="linenos">232</span></a>            <span class="n">positions</span><span class="o">=</span><span class="n">new_positions</span><span class="p">,</span> 
</span><span id="NEB-233"><a href="#NEB-233"><span class="linenos">233</span></a>            <span class="n">elements</span><span class="o">=</span><span class="n">new_elements</span>
</span><span id="NEB-234"><a href="#NEB-234"><span class="linenos">234</span></a>        <span class="p">)</span>
</span><span id="NEB-235"><a href="#NEB-235"><span class="linenos">235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">new_final</span>
</span><span id="NEB-236"><a href="#NEB-236"><span class="linenos">236</span></a>        
</span><span id="NEB-237"><a href="#NEB-237"><span class="linenos">237</span></a>    <span class="k">def</span> <span class="nf">create_neb_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="s1">&#39;neb&#39;</span><span class="p">,</span> <span class="n">nImages</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
</span><span id="NEB-238"><a href="#NEB-238"><span class="linenos">238</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEB-239"><a href="#NEB-239"><span class="linenos">239</span></a><span class="sd">        Create a NEB job.</span>
</span><span id="NEB-240"><a href="#NEB-240"><span class="linenos">240</span></a>
</span><span id="NEB-241"><a href="#NEB-241"><span class="linenos">241</span></a><span class="sd">        Parameters:</span>
</span><span id="NEB-242"><a href="#NEB-242"><span class="linenos">242</span></a><span class="sd">            job_name (str, optional): Name of the NEB job.</span>
</span><span id="NEB-243"><a href="#NEB-243"><span class="linenos">243</span></a><span class="sd">            nImages (int, optional): Number of images for the NEB calculation.</span>
</span><span id="NEB-244"><a href="#NEB-244"><span class="linenos">244</span></a><span class="sd">        </span>
</span><span id="NEB-245"><a href="#NEB-245"><span class="linenos">245</span></a><span class="sd">        Returns:</span>
</span><span id="NEB-246"><a href="#NEB-246"><span class="linenos">246</span></a><span class="sd">            NEBjob: Created NEB job object.</span>
</span><span id="NEB-247"><a href="#NEB-247"><span class="linenos">247</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEB-248"><a href="#NEB-248"><span class="linenos">248</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="NEB-249"><a href="#NEB-249"><span class="linenos">249</span></a>            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="p">[</span><span class="n">job_name</span><span class="p">]</span>
</span><span id="NEB-250"><a href="#NEB-250"><span class="linenos">250</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="NEB-251"><a href="#NEB-251"><span class="linenos">251</span></a>            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">create_job</span><span class="p">(</span><span class="n">job_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">job_type</span><span class="o">.</span><span class="n">Vasp</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="n">job_name</span><span class="p">)</span>
</span><span id="NEB-252"><a href="#NEB-252"><span class="linenos">252</span></a>            <span class="n">job</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">NEBjob</span>
</span><span id="NEB-253"><a href="#NEB-253"><span class="linenos">253</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial</span>         
</span><span id="NEB-254"><a href="#NEB-254"><span class="linenos">254</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">set_kpoints</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;GC&#39;</span><span class="p">)</span>
</span><span id="NEB-255"><a href="#NEB-255"><span class="linenos">255</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">calc_minimize</span><span class="p">(</span>
</span><span id="NEB-256"><a href="#NEB-256"><span class="linenos">256</span></a>                <span class="n">electronic_steps</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
</span><span id="NEB-257"><a href="#NEB-257"><span class="linenos">257</span></a>                <span class="n">retain_charge_density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="NEB-258"><a href="#NEB-258"><span class="linenos">258</span></a>            <span class="p">)</span>
</span><span id="NEB-259"><a href="#NEB-259"><span class="linenos">259</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;ISIF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="NEB-260"><a href="#NEB-260"><span class="linenos">260</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;ENCUT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">520</span>  <span class="c1"># from MP</span>
</span><span id="NEB-261"><a href="#NEB-261"><span class="linenos">261</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;IMAGES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nImages</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="NEB-262"><a href="#NEB-262"><span class="linenos">262</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;IBRION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="NEB-263"><a href="#NEB-263"><span class="linenos">263</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;NFREE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="NEB-264"><a href="#NEB-264"><span class="linenos">264</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="NEB-265"><a href="#NEB-265"><span class="linenos">265</span></a>            
</span><span id="NEB-266"><a href="#NEB-266"><span class="linenos">266</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;neb&#39;</span><span class="p">)</span>            
</span><span id="NEB-267"><a href="#NEB-267"><span class="linenos">267</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;nImages&#39;</span><span class="p">,</span> <span class="n">nImages</span><span class="p">)</span>
</span><span id="NEB-268"><a href="#NEB-268"><span class="linenos">268</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;initial_image&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">)</span>
</span><span id="NEB-269"><a href="#NEB-269"><span class="linenos">269</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;final_image&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span><span class="p">)</span>
</span><span id="NEB-270"><a href="#NEB-270"><span class="linenos">270</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;initial_energy&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_job</span><span class="p">[</span><span class="s1">&#39;output/generic/energy_pot&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="NEB-271"><a href="#NEB-271"><span class="linenos">271</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;final_energy&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_job</span><span class="p">[</span><span class="s1">&#39;output/generic/energy_pot&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="NEB-272"><a href="#NEB-272"><span class="linenos">272</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">_create_images</span><span class="p">()</span>
</span><span id="NEB-273"><a href="#NEB-273"><span class="linenos">273</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="NEB-274"><a href="#NEB-274"><span class="linenos">274</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">write_input</span><span class="p">()</span>
</span><span id="NEB-275"><a href="#NEB-275"><span class="linenos">275</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NEB-276"><a href="#NEB-276"><span class="linenos">276</span></a>            <span class="n">state</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Job `</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s1">` exists. Loading from database instead of creating it!&#39;</span><span class="p">)</span>
</span><span id="NEB-277"><a href="#NEB-277"><span class="linenos">277</span></a>        <span class="k">return</span> <span class="n">job</span>
</span></pre></div>


            <div class="docstring"><p>Class to handle the setup and execution of NEB (Nudged Elastic Band) calculations.</p>
</div>


                            <div id="NEB.__init__" class="classattr">
                                        <input id="NEB.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">NEB</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pr</span>, </span><span class="param"><span class="n">NEB_calc_name</span></span>)</span>

                <label class="view-source-button" for="NEB.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEB.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEB.__init__-108"><a href="#NEB.__init__-108"><span class="linenos">108</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pr</span><span class="p">,</span> <span class="n">NEB_calc_name</span><span class="p">):</span>
</span><span id="NEB.__init__-109"><a href="#NEB.__init__-109"><span class="linenos">109</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEB.__init__-110"><a href="#NEB.__init__-110"><span class="linenos">110</span></a><span class="sd">        Initialize the NEB class.</span>
</span><span id="NEB.__init__-111"><a href="#NEB.__init__-111"><span class="linenos">111</span></a>
</span><span id="NEB.__init__-112"><a href="#NEB.__init__-112"><span class="linenos">112</span></a><span class="sd">        Parameters:</span>
</span><span id="NEB.__init__-113"><a href="#NEB.__init__-113"><span class="linenos">113</span></a><span class="sd">            pr (Project): Pyiron project object.</span>
</span><span id="NEB.__init__-114"><a href="#NEB.__init__-114"><span class="linenos">114</span></a><span class="sd">            NEB_calc_name (str): Name of the NEB calculation.</span>
</span><span id="NEB.__init__-115"><a href="#NEB.__init__-115"><span class="linenos">115</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEB.__init__-116"><a href="#NEB.__init__-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pr</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">NEB_calc_name</span><span class="p">)</span>
</span><span id="NEB.__init__-117"><a href="#NEB.__init__-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the NEB class.</p>

<p>Parameters:
    pr (Project): Pyiron project object.
    NEB_calc_name (str): Name of the NEB calculation.</p>
</div>


                            </div>
                            <div id="NEB.pr" class="classattr">
                                <div class="attr variable">
            <span class="name">pr</span>

        
    </div>
    <a class="headerlink" href="#NEB.pr"></a>
    
    

                            </div>
                            <div id="NEB.initial" class="classattr">
                                <div class="attr variable">
            <span class="name">initial</span>

        
    </div>
    <a class="headerlink" href="#NEB.initial"></a>
    
    

                            </div>
                            <div id="NEB.add_initial_state" class="classattr">
                                        <input id="NEB.add_initial_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_initial_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">initial_job</span>, </span><span class="param"><span class="n">delete_existing</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NEB.add_initial_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEB.add_initial_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEB.add_initial_state-119"><a href="#NEB.add_initial_state-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">add_initial_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_job</span><span class="p">,</span> <span class="n">delete_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="NEB.add_initial_state-120"><a href="#NEB.add_initial_state-120"><span class="linenos">120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEB.add_initial_state-121"><a href="#NEB.add_initial_state-121"><span class="linenos">121</span></a><span class="sd">        Add the initial state for the NEB calculation.</span>
</span><span id="NEB.add_initial_state-122"><a href="#NEB.add_initial_state-122"><span class="linenos">122</span></a>
</span><span id="NEB.add_initial_state-123"><a href="#NEB.add_initial_state-123"><span class="linenos">123</span></a><span class="sd">        Parameters:</span>
</span><span id="NEB.add_initial_state-124"><a href="#NEB.add_initial_state-124"><span class="linenos">124</span></a><span class="sd">            initial_job (Vasp_job): Initial state as a VASP job.</span>
</span><span id="NEB.add_initial_state-125"><a href="#NEB.add_initial_state-125"><span class="linenos">125</span></a><span class="sd">            delete_existing (bool, optional): Whether to delete existing files.</span>
</span><span id="NEB.add_initial_state-126"><a href="#NEB.add_initial_state-126"><span class="linenos">126</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="NEB.add_initial_state-127"><a href="#NEB.add_initial_state-127"><span class="linenos">127</span></a><span class="sd">        </span>
</span><span id="NEB.add_initial_state-128"><a href="#NEB.add_initial_state-128"><span class="linenos">128</span></a><span class="sd">        Raises:</span>
</span><span id="NEB.add_initial_state-129"><a href="#NEB.add_initial_state-129"><span class="linenos">129</span></a><span class="sd">            TypeError: If `initial_job` is not of type `Vasp_job`.</span>
</span><span id="NEB.add_initial_state-130"><a href="#NEB.add_initial_state-130"><span class="linenos">130</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEB.add_initial_state-131"><a href="#NEB.add_initial_state-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">initial_job</span><span class="p">,</span> <span class="n">Vasp_job</span><span class="p">):</span>
</span><span id="NEB.add_initial_state-132"><a href="#NEB.add_initial_state-132"><span class="linenos">132</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Initial job must be a VASP job (pyiron_atomistics.vasp.vasp.Vasp)&quot;</span><span class="p">)</span>
</span><span id="NEB.add_initial_state-133"><a href="#NEB.add_initial_state-133"><span class="linenos">133</span></a>        
</span><span id="NEB.add_initial_state-134"><a href="#NEB.add_initial_state-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_job</span> <span class="o">=</span> <span class="n">initial_job</span>
</span><span id="NEB.add_initial_state-135"><a href="#NEB.add_initial_state-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">initial_job</span><span class="o">.</span><span class="n">get_structure</span><span class="p">()</span>
</span><span id="NEB.add_initial_state-136"><a href="#NEB.add_initial_state-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NEB.add_initial_state-137"><a href="#NEB.add_initial_state-137"><span class="linenos">137</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">initial_job</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(),</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEB.add_initial_state-138"><a href="#NEB.add_initial_state-138"><span class="linenos">138</span></a>        
</span><span id="NEB.add_initial_state-139"><a href="#NEB.add_initial_state-139"><span class="linenos">139</span></a>        <span class="c1"># Setup symbolic links and directory structure</span>
</span><span id="NEB.add_initial_state-140"><a href="#NEB.add_initial_state-140"><span class="linenos">140</span></a>        <span class="n">rel_path_to_initial</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_job</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="NEB.add_initial_state-141"><a href="#NEB.add_initial_state-141"><span class="linenos">141</span></a>        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</span><span id="NEB.add_initial_state-142"><a href="#NEB.add_initial_state-142"><span class="linenos">142</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span><span id="NEB.add_initial_state-143"><a href="#NEB.add_initial_state-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
</span><span id="NEB.add_initial_state-144"><a href="#NEB.add_initial_state-144"><span class="linenos">144</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="NEB.add_initial_state-145"><a href="#NEB.add_initial_state-145"><span class="linenos">145</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;initial.h5&#39;</span><span class="p">)</span>
</span><span id="NEB.add_initial_state-146"><a href="#NEB.add_initial_state-146"><span class="linenos">146</span></a>                <span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;initial_hdf5&#39;</span><span class="p">)</span>
</span><span id="NEB.add_initial_state-147"><a href="#NEB.add_initial_state-147"><span class="linenos">147</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="NEB.add_initial_state-148"><a href="#NEB.add_initial_state-148"><span class="linenos">148</span></a>                <span class="k">pass</span>
</span><span id="NEB.add_initial_state-149"><a href="#NEB.add_initial_state-149"><span class="linenos">149</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">rel_path_to_initial</span><span class="o">+</span><span class="s1">&#39;.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;initial.h5&#39;</span><span class="p">)</span>
</span><span id="NEB.add_initial_state-150"><a href="#NEB.add_initial_state-150"><span class="linenos">150</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;initial_hdf5&#39;</span><span class="p">)</span>
</span><span id="NEB.add_initial_state-151"><a href="#NEB.add_initial_state-151"><span class="linenos">151</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;initial_hdf5&#39;</span><span class="p">)</span>
</span><span id="NEB.add_initial_state-152"><a href="#NEB.add_initial_state-152"><span class="linenos">152</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="n">rel_path_to_initial</span><span class="o">+</span><span class="s1">&#39;_hdf5&#39;</span><span class="p">,</span> <span class="n">initial_job</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="s1">&#39;initial&#39;</span><span class="p">,</span> <span class="n">target_is_directory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="NEB.add_initial_state-153"><a href="#NEB.add_initial_state-153"><span class="linenos">153</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add the initial state for the NEB calculation.</p>

<p>Parameters:
    initial_job (Vasp_job): Initial state as a VASP job.
    delete_existing (bool, optional): Whether to delete existing files.
    wrap (float, optional): Wrap value for the atomic positions.</p>

<p>Raises:
    TypeError: If <code>initial_job</code> is not of type <code>Vasp_job</code>.</p>
</div>


                            </div>
                            <div id="NEB.set_initial_state" class="classattr">
                                        <input id="NEB.set_initial_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_initial_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">initial_job</span>, </span><span class="param"><span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NEB.set_initial_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEB.set_initial_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEB.set_initial_state-155"><a href="#NEB.set_initial_state-155"><span class="linenos">155</span></a>    <span class="k">def</span> <span class="nf">set_initial_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_job</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="NEB.set_initial_state-156"><a href="#NEB.set_initial_state-156"><span class="linenos">156</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEB.set_initial_state-157"><a href="#NEB.set_initial_state-157"><span class="linenos">157</span></a><span class="sd">        Set the initial state from an existing VASP job.</span>
</span><span id="NEB.set_initial_state-158"><a href="#NEB.set_initial_state-158"><span class="linenos">158</span></a>
</span><span id="NEB.set_initial_state-159"><a href="#NEB.set_initial_state-159"><span class="linenos">159</span></a><span class="sd">        Parameters:</span>
</span><span id="NEB.set_initial_state-160"><a href="#NEB.set_initial_state-160"><span class="linenos">160</span></a><span class="sd">            initial_job (Vasp_job): Initial state as a VASP job.</span>
</span><span id="NEB.set_initial_state-161"><a href="#NEB.set_initial_state-161"><span class="linenos">161</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="NEB.set_initial_state-162"><a href="#NEB.set_initial_state-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEB.set_initial_state-163"><a href="#NEB.set_initial_state-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_job</span> <span class="o">=</span> <span class="n">initial_job</span>
</span><span id="NEB.set_initial_state-164"><a href="#NEB.set_initial_state-164"><span class="linenos">164</span></a>        <span class="n">struct</span> <span class="o">=</span> <span class="n">initial_job</span><span class="o">.</span><span class="n">get_structure</span><span class="p">()</span>
</span><span id="NEB.set_initial_state-165"><a href="#NEB.set_initial_state-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">struct</span>
</span><span id="NEB.set_initial_state-166"><a href="#NEB.set_initial_state-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NEB.set_initial_state-167"><a href="#NEB.set_initial_state-167"><span class="linenos">167</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the initial state from an existing VASP job.</p>

<p>Parameters:
    initial_job (Vasp_job): Initial state as a VASP job.
    wrap (float, optional): Wrap value for the atomic positions.</p>
</div>


                            </div>
                            <div id="NEB.set_final_state" class="classattr">
                                        <input id="NEB.set_final_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_final_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">final_job</span>, </span><span class="param"><span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NEB.set_final_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEB.set_final_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEB.set_final_state-169"><a href="#NEB.set_final_state-169"><span class="linenos">169</span></a>    <span class="k">def</span> <span class="nf">set_final_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_job</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="NEB.set_final_state-170"><a href="#NEB.set_final_state-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEB.set_final_state-171"><a href="#NEB.set_final_state-171"><span class="linenos">171</span></a><span class="sd">        Set the final state for the NEB calculation.</span>
</span><span id="NEB.set_final_state-172"><a href="#NEB.set_final_state-172"><span class="linenos">172</span></a>
</span><span id="NEB.set_final_state-173"><a href="#NEB.set_final_state-173"><span class="linenos">173</span></a><span class="sd">        Parameters:</span>
</span><span id="NEB.set_final_state-174"><a href="#NEB.set_final_state-174"><span class="linenos">174</span></a><span class="sd">            final_job (Vasp_job): Final state as a VASP job.</span>
</span><span id="NEB.set_final_state-175"><a href="#NEB.set_final_state-175"><span class="linenos">175</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="NEB.set_final_state-176"><a href="#NEB.set_final_state-176"><span class="linenos">176</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEB.set_final_state-177"><a href="#NEB.set_final_state-177"><span class="linenos">177</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final_job</span> <span class="o">=</span> <span class="n">final_job</span>
</span><span id="NEB.set_final_state-178"><a href="#NEB.set_final_state-178"><span class="linenos">178</span></a>        <span class="n">struct</span> <span class="o">=</span> <span class="n">final_job</span><span class="o">.</span><span class="n">get_structure</span><span class="p">()</span>
</span><span id="NEB.set_final_state-179"><a href="#NEB.set_final_state-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">struct</span>
</span><span id="NEB.set_final_state-180"><a href="#NEB.set_final_state-180"><span class="linenos">180</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NEB.set_final_state-181"><a href="#NEB.set_final_state-181"><span class="linenos">181</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the final state for the NEB calculation.</p>

<p>Parameters:
    final_job (Vasp_job): Final state as a VASP job.
    wrap (float, optional): Wrap value for the atomic positions.</p>
</div>


                            </div>
                            <div id="NEB.reorder_final" class="classattr">
                                        <input id="NEB.reorder_final-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reorder_final</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">moving_index</span>, </span><span class="param"><span class="n">max_shift</span><span class="o">=</span><span class="mf">0.05</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NEB.reorder_final-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEB.reorder_final"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEB.reorder_final-184"><a href="#NEB.reorder_final-184"><span class="linenos">184</span></a>    <span class="k">def</span> <span class="nf">reorder_final</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">moving_index</span><span class="p">,</span> <span class="n">max_shift</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="NEB.reorder_final-185"><a href="#NEB.reorder_final-185"><span class="linenos">185</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEB.reorder_final-186"><a href="#NEB.reorder_final-186"><span class="linenos">186</span></a><span class="sd">        Reorder the final structure based on the initial structure.</span>
</span><span id="NEB.reorder_final-187"><a href="#NEB.reorder_final-187"><span class="linenos">187</span></a>
</span><span id="NEB.reorder_final-188"><a href="#NEB.reorder_final-188"><span class="linenos">188</span></a><span class="sd">        Parameters:</span>
</span><span id="NEB.reorder_final-189"><a href="#NEB.reorder_final-189"><span class="linenos">189</span></a><span class="sd">            moving_index (int): Index of the moving atom.</span>
</span><span id="NEB.reorder_final-190"><a href="#NEB.reorder_final-190"><span class="linenos">190</span></a><span class="sd">            max_shift (float, optional): Maximum allowable shift for atom mapping.</span>
</span><span id="NEB.reorder_final-191"><a href="#NEB.reorder_final-191"><span class="linenos">191</span></a><span class="sd">            verbose (bool, optional): If True, prints information about the atom positions.</span>
</span><span id="NEB.reorder_final-192"><a href="#NEB.reorder_final-192"><span class="linenos">192</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="NEB.reorder_final-193"><a href="#NEB.reorder_final-193"><span class="linenos">193</span></a><span class="sd">        </span>
</span><span id="NEB.reorder_final-194"><a href="#NEB.reorder_final-194"><span class="linenos">194</span></a><span class="sd">        Raises:</span>
</span><span id="NEB.reorder_final-195"><a href="#NEB.reorder_final-195"><span class="linenos">195</span></a><span class="sd">            Exception: If there are issues with the atom mapping.</span>
</span><span id="NEB.reorder_final-196"><a href="#NEB.reorder_final-196"><span class="linenos">196</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEB.reorder_final-197"><a href="#NEB.reorder_final-197"><span class="linenos">197</span></a>        
</span><span id="NEB.reorder_final-198"><a href="#NEB.reorder_final-198"><span class="linenos">198</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial</span>
</span><span id="NEB.reorder_final-199"><a href="#NEB.reorder_final-199"><span class="linenos">199</span></a>        <span class="n">final</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span>
</span><span id="NEB.reorder_final-200"><a href="#NEB.reorder_final-200"><span class="linenos">200</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NEB.reorder_final-201"><a href="#NEB.reorder_final-201"><span class="linenos">201</span></a>            <span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEB.reorder_final-202"><a href="#NEB.reorder_final-202"><span class="linenos">202</span></a>            <span class="n">final</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">final</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEB.reorder_final-203"><a href="#NEB.reorder_final-203"><span class="linenos">203</span></a>            
</span><span id="NEB.reorder_final-204"><a href="#NEB.reorder_final-204"><span class="linenos">204</span></a>        <span class="n">mapped</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">final</span><span class="p">))]</span>
</span><span id="NEB.reorder_final-205"><a href="#NEB.reorder_final-205"><span class="linenos">205</span></a>        <span class="n">mapping</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initial</span><span class="p">))]</span>
</span><span id="NEB.reorder_final-206"><a href="#NEB.reorder_final-206"><span class="linenos">206</span></a>        
</span><span id="NEB.reorder_final-207"><a href="#NEB.reorder_final-207"><span class="linenos">207</span></a>        <span class="k">for</span> <span class="n">iat</span><span class="p">,</span> <span class="n">at</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">initial</span><span class="p">):</span>
</span><span id="NEB.reorder_final-208"><a href="#NEB.reorder_final-208"><span class="linenos">208</span></a>            <span class="k">if</span> <span class="n">iat</span> <span class="o">==</span> <span class="n">moving_index</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="NEB.reorder_final-209"><a href="#NEB.reorder_final-209"><span class="linenos">209</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;position in the initial structure:&#39;</span><span class="p">,</span> <span class="n">at</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
</span><span id="NEB.reorder_final-210"><a href="#NEB.reorder_final-210"><span class="linenos">210</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NEB.reorder_final-211"><a href="#NEB.reorder_final-211"><span class="linenos">211</span></a>                <span class="n">nn</span> <span class="o">=</span> <span class="n">final</span><span class="o">.</span><span class="n">get_neighborhood</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="o">=</span><span class="n">max_shift</span><span class="p">)</span>
</span><span id="NEB.reorder_final-212"><a href="#NEB.reorder_final-212"><span class="linenos">212</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">distances</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="NEB.reorder_final-213"><a href="#NEB.reorder_final-213"><span class="linenos">213</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with mapping: atom </span><span class="si">{</span><span class="n">iat</span><span class="si">}</span><span class="s2"> in the initial structure was identified with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">distances</span><span class="p">)</span><span class="si">}</span><span class="s2"> images&quot;</span><span class="p">)</span>
</span><span id="NEB.reorder_final-214"><a href="#NEB.reorder_final-214"><span class="linenos">214</span></a>                <span class="k">elif</span> <span class="n">mapped</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
</span><span id="NEB.reorder_final-215"><a href="#NEB.reorder_final-215"><span class="linenos">215</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with mapping: atom </span><span class="si">{</span><span class="n">iat</span><span class="si">}</span><span class="s2"> in the initial should be mapped to </span><span class="si">{</span><span class="n">nn</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> in the final structure but this atom has already been mapped.&quot;</span><span class="p">)</span>
</span><span id="NEB.reorder_final-216"><a href="#NEB.reorder_final-216"><span class="linenos">216</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="NEB.reorder_final-217"><a href="#NEB.reorder_final-217"><span class="linenos">217</span></a>                    <span class="n">mapped</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NEB.reorder_final-218"><a href="#NEB.reorder_final-218"><span class="linenos">218</span></a>                    <span class="n">mapping</span><span class="p">[</span><span class="n">iat</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NEB.reorder_final-219"><a href="#NEB.reorder_final-219"><span class="linenos">219</span></a>        
</span><span id="NEB.reorder_final-220"><a href="#NEB.reorder_final-220"><span class="linenos">220</span></a>        <span class="n">unmapped</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">final</span><span class="p">))</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">mapped</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="NEB.reorder_final-221"><a href="#NEB.reorder_final-221"><span class="linenos">221</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unmapped</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="NEB.reorder_final-222"><a href="#NEB.reorder_final-222"><span class="linenos">222</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with mapping: only 1 atom must remain after mapping! Unmapped atoms: </span><span class="si">{</span><span class="n">unmapped</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NEB.reorder_final-223"><a href="#NEB.reorder_final-223"><span class="linenos">223</span></a>        
</span><span id="NEB.reorder_final-224"><a href="#NEB.reorder_final-224"><span class="linenos">224</span></a>        <span class="n">mapping</span><span class="p">[</span><span class="n">moving_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">unmapped</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NEB.reorder_final-225"><a href="#NEB.reorder_final-225"><span class="linenos">225</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="NEB.reorder_final-226"><a href="#NEB.reorder_final-226"><span class="linenos">226</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;position in the final structure:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">unmapped</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="NEB.reorder_final-227"><a href="#NEB.reorder_final-227"><span class="linenos">227</span></a>        
</span><span id="NEB.reorder_final-228"><a href="#NEB.reorder_final-228"><span class="linenos">228</span></a>        <span class="n">new_positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">final</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initial</span><span class="p">))]</span>
</span><span id="NEB.reorder_final-229"><a href="#NEB.reorder_final-229"><span class="linenos">229</span></a>        <span class="n">new_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">final</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initial</span><span class="p">))]</span>
</span><span id="NEB.reorder_final-230"><a href="#NEB.reorder_final-230"><span class="linenos">230</span></a>        <span class="n">new_final</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">create</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span>
</span><span id="NEB.reorder_final-231"><a href="#NEB.reorder_final-231"><span class="linenos">231</span></a>            <span class="n">cell</span><span class="o">=</span><span class="n">final</span><span class="o">.</span><span class="n">cell</span><span class="p">,</span> 
</span><span id="NEB.reorder_final-232"><a href="#NEB.reorder_final-232"><span class="linenos">232</span></a>            <span class="n">positions</span><span class="o">=</span><span class="n">new_positions</span><span class="p">,</span> 
</span><span id="NEB.reorder_final-233"><a href="#NEB.reorder_final-233"><span class="linenos">233</span></a>            <span class="n">elements</span><span class="o">=</span><span class="n">new_elements</span>
</span><span id="NEB.reorder_final-234"><a href="#NEB.reorder_final-234"><span class="linenos">234</span></a>        <span class="p">)</span>
</span><span id="NEB.reorder_final-235"><a href="#NEB.reorder_final-235"><span class="linenos">235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">new_final</span>
</span></pre></div>


            <div class="docstring"><p>Reorder the final structure based on the initial structure.</p>

<p>Parameters:
    moving_index (int): Index of the moving atom.
    max_shift (float, optional): Maximum allowable shift for atom mapping.
    verbose (bool, optional): If True, prints information about the atom positions.
    wrap (float, optional): Wrap value for the atomic positions.</p>

<p>Raises:
    Exception: If there are issues with the atom mapping.</p>
</div>


                            </div>
                            <div id="NEB.create_neb_job" class="classattr">
                                        <input id="NEB.create_neb_job-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_neb_job</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">job_name</span><span class="o">=</span><span class="s1">&#39;neb&#39;</span>, </span><span class="param"><span class="n">nImages</span><span class="o">=</span><span class="mi">3</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NEB.create_neb_job-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEB.create_neb_job"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEB.create_neb_job-237"><a href="#NEB.create_neb_job-237"><span class="linenos">237</span></a>    <span class="k">def</span> <span class="nf">create_neb_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="s1">&#39;neb&#39;</span><span class="p">,</span> <span class="n">nImages</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
</span><span id="NEB.create_neb_job-238"><a href="#NEB.create_neb_job-238"><span class="linenos">238</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEB.create_neb_job-239"><a href="#NEB.create_neb_job-239"><span class="linenos">239</span></a><span class="sd">        Create a NEB job.</span>
</span><span id="NEB.create_neb_job-240"><a href="#NEB.create_neb_job-240"><span class="linenos">240</span></a>
</span><span id="NEB.create_neb_job-241"><a href="#NEB.create_neb_job-241"><span class="linenos">241</span></a><span class="sd">        Parameters:</span>
</span><span id="NEB.create_neb_job-242"><a href="#NEB.create_neb_job-242"><span class="linenos">242</span></a><span class="sd">            job_name (str, optional): Name of the NEB job.</span>
</span><span id="NEB.create_neb_job-243"><a href="#NEB.create_neb_job-243"><span class="linenos">243</span></a><span class="sd">            nImages (int, optional): Number of images for the NEB calculation.</span>
</span><span id="NEB.create_neb_job-244"><a href="#NEB.create_neb_job-244"><span class="linenos">244</span></a><span class="sd">        </span>
</span><span id="NEB.create_neb_job-245"><a href="#NEB.create_neb_job-245"><span class="linenos">245</span></a><span class="sd">        Returns:</span>
</span><span id="NEB.create_neb_job-246"><a href="#NEB.create_neb_job-246"><span class="linenos">246</span></a><span class="sd">            NEBjob: Created NEB job object.</span>
</span><span id="NEB.create_neb_job-247"><a href="#NEB.create_neb_job-247"><span class="linenos">247</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEB.create_neb_job-248"><a href="#NEB.create_neb_job-248"><span class="linenos">248</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="NEB.create_neb_job-249"><a href="#NEB.create_neb_job-249"><span class="linenos">249</span></a>            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="p">[</span><span class="n">job_name</span><span class="p">]</span>
</span><span id="NEB.create_neb_job-250"><a href="#NEB.create_neb_job-250"><span class="linenos">250</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="NEB.create_neb_job-251"><a href="#NEB.create_neb_job-251"><span class="linenos">251</span></a>            <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">create_job</span><span class="p">(</span><span class="n">job_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pr</span><span class="o">.</span><span class="n">job_type</span><span class="o">.</span><span class="n">Vasp</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="n">job_name</span><span class="p">)</span>
</span><span id="NEB.create_neb_job-252"><a href="#NEB.create_neb_job-252"><span class="linenos">252</span></a>            <span class="n">job</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">NEBjob</span>
</span><span id="NEB.create_neb_job-253"><a href="#NEB.create_neb_job-253"><span class="linenos">253</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial</span>         
</span><span id="NEB.create_neb_job-254"><a href="#NEB.create_neb_job-254"><span class="linenos">254</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">set_kpoints</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;GC&#39;</span><span class="p">)</span>
</span><span id="NEB.create_neb_job-255"><a href="#NEB.create_neb_job-255"><span class="linenos">255</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">calc_minimize</span><span class="p">(</span>
</span><span id="NEB.create_neb_job-256"><a href="#NEB.create_neb_job-256"><span class="linenos">256</span></a>                <span class="n">electronic_steps</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
</span><span id="NEB.create_neb_job-257"><a href="#NEB.create_neb_job-257"><span class="linenos">257</span></a>                <span class="n">retain_charge_density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="NEB.create_neb_job-258"><a href="#NEB.create_neb_job-258"><span class="linenos">258</span></a>            <span class="p">)</span>
</span><span id="NEB.create_neb_job-259"><a href="#NEB.create_neb_job-259"><span class="linenos">259</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;ISIF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="NEB.create_neb_job-260"><a href="#NEB.create_neb_job-260"><span class="linenos">260</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;ENCUT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">520</span>  <span class="c1"># from MP</span>
</span><span id="NEB.create_neb_job-261"><a href="#NEB.create_neb_job-261"><span class="linenos">261</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;IMAGES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nImages</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="NEB.create_neb_job-262"><a href="#NEB.create_neb_job-262"><span class="linenos">262</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;IBRION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="NEB.create_neb_job-263"><a href="#NEB.create_neb_job-263"><span class="linenos">263</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s1">&#39;NFREE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="NEB.create_neb_job-264"><a href="#NEB.create_neb_job-264"><span class="linenos">264</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="NEB.create_neb_job-265"><a href="#NEB.create_neb_job-265"><span class="linenos">265</span></a>            
</span><span id="NEB.create_neb_job-266"><a href="#NEB.create_neb_job-266"><span class="linenos">266</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;neb&#39;</span><span class="p">)</span>            
</span><span id="NEB.create_neb_job-267"><a href="#NEB.create_neb_job-267"><span class="linenos">267</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;nImages&#39;</span><span class="p">,</span> <span class="n">nImages</span><span class="p">)</span>
</span><span id="NEB.create_neb_job-268"><a href="#NEB.create_neb_job-268"><span class="linenos">268</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;initial_image&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial</span><span class="p">)</span>
</span><span id="NEB.create_neb_job-269"><a href="#NEB.create_neb_job-269"><span class="linenos">269</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;final_image&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span><span class="p">)</span>
</span><span id="NEB.create_neb_job-270"><a href="#NEB.create_neb_job-270"><span class="linenos">270</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;initial_energy&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_job</span><span class="p">[</span><span class="s1">&#39;output/generic/energy_pot&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="NEB.create_neb_job-271"><a href="#NEB.create_neb_job-271"><span class="linenos">271</span></a>            <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;final_energy&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_job</span><span class="p">[</span><span class="s1">&#39;output/generic/energy_pot&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="NEB.create_neb_job-272"><a href="#NEB.create_neb_job-272"><span class="linenos">272</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">_create_images</span><span class="p">()</span>
</span><span id="NEB.create_neb_job-273"><a href="#NEB.create_neb_job-273"><span class="linenos">273</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="NEB.create_neb_job-274"><a href="#NEB.create_neb_job-274"><span class="linenos">274</span></a>            <span class="n">job</span><span class="o">.</span><span class="n">write_input</span><span class="p">()</span>
</span><span id="NEB.create_neb_job-275"><a href="#NEB.create_neb_job-275"><span class="linenos">275</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NEB.create_neb_job-276"><a href="#NEB.create_neb_job-276"><span class="linenos">276</span></a>            <span class="n">state</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Job `</span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s1">` exists. Loading from database instead of creating it!&#39;</span><span class="p">)</span>
</span><span id="NEB.create_neb_job-277"><a href="#NEB.create_neb_job-277"><span class="linenos">277</span></a>        <span class="k">return</span> <span class="n">job</span>
</span></pre></div>


            <div class="docstring"><p>Create a NEB job.</p>

<p>Parameters:
    job_name (str, optional): Name of the NEB job.
    nImages (int, optional): Number of images for the NEB calculation.</p>

<p>Returns:
    NEBjob: Created NEB job object.</p>
</div>


                            </div>
                </section>
                <section id="NEBjob">
                            <input id="NEBjob-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">NEBjob</span><wbr>(<span class="base">pyiron_atomistics.vasp.vasp.Vasp</span>):

                <label class="view-source-button" for="NEBjob-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEBjob"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEBjob-280"><a href="#NEBjob-280"><span class="linenos">280</span></a><span class="k">class</span> <span class="nc">NEBjob</span><span class="p">(</span><span class="n">Vasp_job</span><span class="p">):</span>
</span><span id="NEBjob-281"><a href="#NEBjob-281"><span class="linenos">281</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-282"><a href="#NEBjob-282"><span class="linenos">282</span></a><span class="sd">    Class for handling specific NEB (Nudged Elastic Band) job operations.</span>
</span><span id="NEBjob-283"><a href="#NEBjob-283"><span class="linenos">283</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="NEBjob-284"><a href="#NEBjob-284"><span class="linenos">284</span></a>    
</span><span id="NEBjob-285"><a href="#NEBjob-285"><span class="linenos">285</span></a>
</span><span id="NEBjob-286"><a href="#NEBjob-286"><span class="linenos">286</span></a>    
</span><span id="NEBjob-287"><a href="#NEBjob-287"><span class="linenos">287</span></a>    <span class="k">def</span> <span class="nf">_create_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="NEBjob-288"><a href="#NEBjob-288"><span class="linenos">288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-289"><a href="#NEBjob-289"><span class="linenos">289</span></a><span class="sd">        Create interpolated images between the initial and final states.</span>
</span><span id="NEBjob-290"><a href="#NEBjob-290"><span class="linenos">290</span></a>
</span><span id="NEBjob-291"><a href="#NEBjob-291"><span class="linenos">291</span></a><span class="sd">        Parameters:</span>
</span><span id="NEBjob-292"><a href="#NEBjob-292"><span class="linenos">292</span></a><span class="sd">            wrap (float, optional): Wrap value for the atomic positions.</span>
</span><span id="NEBjob-293"><a href="#NEBjob-293"><span class="linenos">293</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob-294"><a href="#NEBjob-294"><span class="linenos">294</span></a>        <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NEBjob-295"><a href="#NEBjob-295"><span class="linenos">295</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NEBjob-296"><a href="#NEBjob-296"><span class="linenos">296</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">(),</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEBjob-297"><a href="#NEBjob-297"><span class="linenos">297</span></a>        <span class="n">final</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/final_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">(),</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEBjob-298"><a href="#NEBjob-298"><span class="linenos">298</span></a>        <span class="n">nImages</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/nImages&#39;</span><span class="p">]</span>
</span><span id="NEBjob-299"><a href="#NEBjob-299"><span class="linenos">299</span></a>        
</span><span id="NEBjob-300"><a href="#NEBjob-300"><span class="linenos">300</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nImages</span><span class="p">):</span>
</span><span id="NEBjob-301"><a href="#NEBjob-301"><span class="linenos">301</span></a>            <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">initial</span><span class="o">.</span><span class="n">cell</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">final</span><span class="o">.</span><span class="n">cell</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span><span id="NEBjob-302"><a href="#NEBjob-302"><span class="linenos">302</span></a>            <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">initial</span><span class="o">.</span><span class="n">positions</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">final</span><span class="o">.</span><span class="n">positions</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span><span id="NEBjob-303"><a href="#NEBjob-303"><span class="linenos">303</span></a>        
</span><span id="NEBjob-304"><a href="#NEBjob-304"><span class="linenos">304</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;initial_cells&#39;</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
</span><span id="NEBjob-305"><a href="#NEBjob-305"><span class="linenos">305</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;initial_positions&#39;</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>
</span><span id="NEBjob-306"><a href="#NEBjob-306"><span class="linenos">306</span></a>        
</span><span id="NEBjob-307"><a href="#NEBjob-307"><span class="linenos">307</span></a>    <span class="k">def</span> <span class="nf">get_initial_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NEBjob-308"><a href="#NEBjob-308"><span class="linenos">308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-309"><a href="#NEBjob-309"><span class="linenos">309</span></a><span class="sd">        Retrieve the initial interpolated images.</span>
</span><span id="NEBjob-310"><a href="#NEBjob-310"><span class="linenos">310</span></a>
</span><span id="NEBjob-311"><a href="#NEBjob-311"><span class="linenos">311</span></a><span class="sd">        Returns:</span>
</span><span id="NEBjob-312"><a href="#NEBjob-312"><span class="linenos">312</span></a><span class="sd">            Trajectory: Trajectory object containing the initial images.</span>
</span><span id="NEBjob-313"><a href="#NEBjob-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob-314"><a href="#NEBjob-314"><span class="linenos">314</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="NEBjob-315"><a href="#NEBjob-315"><span class="linenos">315</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_positions&#39;</span><span class="p">]</span>
</span><span id="NEBjob-316"><a href="#NEBjob-316"><span class="linenos">316</span></a>        <span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_cells&#39;</span><span class="p">]</span>
</span><span id="NEBjob-317"><a href="#NEBjob-317"><span class="linenos">317</span></a>        <span class="k">return</span> <span class="n">Trajectory</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">)</span>
</span><span id="NEBjob-318"><a href="#NEBjob-318"><span class="linenos">318</span></a>    
</span><span id="NEBjob-319"><a href="#NEBjob-319"><span class="linenos">319</span></a>    <span class="k">def</span> <span class="nf">get_final_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NEBjob-320"><a href="#NEBjob-320"><span class="linenos">320</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-321"><a href="#NEBjob-321"><span class="linenos">321</span></a><span class="sd">        Retrieve the final interpolated images after relaxation.</span>
</span><span id="NEBjob-322"><a href="#NEBjob-322"><span class="linenos">322</span></a>
</span><span id="NEBjob-323"><a href="#NEBjob-323"><span class="linenos">323</span></a><span class="sd">        Returns:</span>
</span><span id="NEBjob-324"><a href="#NEBjob-324"><span class="linenos">324</span></a><span class="sd">            Trajectory: Trajectory object containing the final images.</span>
</span><span id="NEBjob-325"><a href="#NEBjob-325"><span class="linenos">325</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob-326"><a href="#NEBjob-326"><span class="linenos">326</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="NEBjob-327"><a href="#NEBjob-327"><span class="linenos">327</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb/final_positions&#39;</span><span class="p">]</span>
</span><span id="NEBjob-328"><a href="#NEBjob-328"><span class="linenos">328</span></a>        <span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb/final_cells&#39;</span><span class="p">]</span>
</span><span id="NEBjob-329"><a href="#NEBjob-329"><span class="linenos">329</span></a>        <span class="k">return</span> <span class="n">Trajectory</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">)</span>
</span><span id="NEBjob-330"><a href="#NEBjob-330"><span class="linenos">330</span></a>    
</span><span id="NEBjob-331"><a href="#NEBjob-331"><span class="linenos">331</span></a>    <span class="k">def</span> <span class="nf">_write_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NEBjob-332"><a href="#NEBjob-332"><span class="linenos">332</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-333"><a href="#NEBjob-333"><span class="linenos">333</span></a><span class="sd">        Write the interpolated images to the appropriate directories.</span>
</span><span id="NEBjob-334"><a href="#NEBjob-334"><span class="linenos">334</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob-335"><a href="#NEBjob-335"><span class="linenos">335</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;_hdf5/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_name</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
</span><span id="NEBjob-336"><a href="#NEBjob-336"><span class="linenos">336</span></a>        <span class="n">nImages</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/nImages&#39;</span><span class="p">]</span>
</span><span id="NEBjob-337"><a href="#NEBjob-337"><span class="linenos">337</span></a>        <span class="n">initial_structs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_initial_images</span><span class="p">()</span>
</span><span id="NEBjob-338"><a href="#NEBjob-338"><span class="linenos">338</span></a>        
</span><span id="NEBjob-339"><a href="#NEBjob-339"><span class="linenos">339</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nImages</span><span class="p">):</span>
</span><span id="NEBjob-340"><a href="#NEBjob-340"><span class="linenos">340</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="NEBjob-341"><a href="#NEBjob-341"><span class="linenos">341</span></a>            <span class="n">case</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="NEBjob-342"><a href="#NEBjob-342"><span class="linenos">342</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">case</span><span class="p">):</span>
</span><span id="NEBjob-343"><a href="#NEBjob-343"><span class="linenos">343</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>
</span><span id="NEBjob-344"><a href="#NEBjob-344"><span class="linenos">344</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">case</span><span class="p">)</span>
</span><span id="NEBjob-345"><a href="#NEBjob-345"><span class="linenos">345</span></a>            <span class="n">struct</span> <span class="o">=</span> <span class="n">initial_structs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="NEBjob-346"><a href="#NEBjob-346"><span class="linenos">346</span></a>            <span class="n">struct</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;POSCAR&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;vasp&#39;</span><span class="p">)</span>
</span><span id="NEBjob-347"><a href="#NEBjob-347"><span class="linenos">347</span></a>    
</span><span id="NEBjob-348"><a href="#NEBjob-348"><span class="linenos">348</span></a>    <span class="k">def</span> <span class="nf">write_and_transfer_to_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NEBjob-349"><a href="#NEBjob-349"><span class="linenos">349</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-350"><a href="#NEBjob-350"><span class="linenos">350</span></a><span class="sd">        Write the input files and transfer them to the remote cluster.</span>
</span><span id="NEBjob-351"><a href="#NEBjob-351"><span class="linenos">351</span></a>
</span><span id="NEBjob-352"><a href="#NEBjob-352"><span class="linenos">352</span></a><span class="sd">        Warnings:</span>
</span><span id="NEBjob-353"><a href="#NEBjob-353"><span class="linenos">353</span></a><span class="sd">            If the job is already marked as finished, a warning is issued and no action is taken.</span>
</span><span id="NEBjob-354"><a href="#NEBjob-354"><span class="linenos">354</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob-355"><a href="#NEBjob-355"><span class="linenos">355</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">job_status_successful_lst</span><span class="p">:</span>
</span><span id="NEBjob-356"><a href="#NEBjob-356"><span class="linenos">356</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_images</span><span class="p">()</span>
</span><span id="NEBjob-357"><a href="#NEBjob-357"><span class="linenos">357</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_input</span><span class="p">()</span>
</span><span id="NEBjob-358"><a href="#NEBjob-358"><span class="linenos">358</span></a>            
</span><span id="NEBjob-359"><a href="#NEBjob-359"><span class="linenos">359</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">queue_adapter</span><span class="o">.</span><span class="n">convert_path_to_remote</span><span class="p">(</span>
</span><span id="NEBjob-360"><a href="#NEBjob-360"><span class="linenos">360</span></a>                <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">file_name</span>
</span><span id="NEBjob-361"><a href="#NEBjob-361"><span class="linenos">361</span></a>            <span class="p">)</span>
</span><span id="NEBjob-362"><a href="#NEBjob-362"><span class="linenos">362</span></a>            <span class="n">working_directory</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">queue_adapter</span><span class="o">.</span><span class="n">convert_path_to_remote</span><span class="p">(</span>
</span><span id="NEBjob-363"><a href="#NEBjob-363"><span class="linenos">363</span></a>                <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span>
</span><span id="NEBjob-364"><a href="#NEBjob-364"><span class="linenos">364</span></a>            <span class="p">)</span>
</span><span id="NEBjob-365"><a href="#NEBjob-365"><span class="linenos">365</span></a>            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;_hdf5/**&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="NEBjob-366"><a href="#NEBjob-366"><span class="linenos">366</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>                
</span><span id="NEBjob-367"><a href="#NEBjob-367"><span class="linenos">367</span></a>                    <span class="n">state</span><span class="o">.</span><span class="n">queue_adapter</span><span class="o">.</span><span class="n">transfer_file_to_remote</span><span class="p">(</span>
</span><span id="NEBjob-368"><a href="#NEBjob-368"><span class="linenos">368</span></a>                        <span class="n">file</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">transfer_back</span><span class="o">=</span><span class="kc">False</span>
</span><span id="NEBjob-369"><a href="#NEBjob-369"><span class="linenos">369</span></a>                    <span class="p">)</span>
</span><span id="NEBjob-370"><a href="#NEBjob-370"><span class="linenos">370</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NEBjob-371"><a href="#NEBjob-371"><span class="linenos">371</span></a>            <span class="n">state</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Job `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="si">}</span><span class="s1">` is marked as finished, uploading doesn</span><span class="se">\&#39;</span><span class="s1">t make sense&#39;</span><span class="p">)</span>
</span><span id="NEBjob-372"><a href="#NEBjob-372"><span class="linenos">372</span></a>            
</span><span id="NEBjob-373"><a href="#NEBjob-373"><span class="linenos">373</span></a>    <span class="k">def</span> <span class="nf">collect_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="NEBjob-374"><a href="#NEBjob-374"><span class="linenos">374</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-375"><a href="#NEBjob-375"><span class="linenos">375</span></a><span class="sd">        Collect the data from the NEB calculation.</span>
</span><span id="NEBjob-376"><a href="#NEBjob-376"><span class="linenos">376</span></a>
</span><span id="NEBjob-377"><a href="#NEBjob-377"><span class="linenos">377</span></a><span class="sd">        Parameters:</span>
</span><span id="NEBjob-378"><a href="#NEBjob-378"><span class="linenos">378</span></a><span class="sd">            wrap (float or bool, optional): Wrap value for atomic positions. Set to `False` to disable wrapping.</span>
</span><span id="NEBjob-379"><a href="#NEBjob-379"><span class="linenos">379</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob-380"><a href="#NEBjob-380"><span class="linenos">380</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;_hdf5/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_name</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
</span><span id="NEBjob-381"><a href="#NEBjob-381"><span class="linenos">381</span></a>        <span class="n">nImages</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/nImages&#39;</span><span class="p">]</span>
</span><span id="NEBjob-382"><a href="#NEBjob-382"><span class="linenos">382</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="NEBjob-383"><a href="#NEBjob-383"><span class="linenos">383</span></a>        <span class="n">final</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/final_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="NEBjob-384"><a href="#NEBjob-384"><span class="linenos">384</span></a>        
</span><span id="NEBjob-385"><a href="#NEBjob-385"><span class="linenos">385</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NEBjob-386"><a href="#NEBjob-386"><span class="linenos">386</span></a>            <span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEBjob-387"><a href="#NEBjob-387"><span class="linenos">387</span></a>            <span class="n">final</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">final</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEBjob-388"><a href="#NEBjob-388"><span class="linenos">388</span></a>        
</span><span id="NEBjob-389"><a href="#NEBjob-389"><span class="linenos">389</span></a>        <span class="n">cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial</span><span class="o">.</span><span class="n">cell</span><span class="p">]</span>
</span><span id="NEBjob-390"><a href="#NEBjob-390"><span class="linenos">390</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial</span><span class="o">.</span><span class="n">positions</span><span class="p">]</span>
</span><span id="NEBjob-391"><a href="#NEBjob-391"><span class="linenos">391</span></a>        <span class="n">energy_pot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NEBjob-392"><a href="#NEBjob-392"><span class="linenos">392</span></a>        
</span><span id="NEBjob-393"><a href="#NEBjob-393"><span class="linenos">393</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nImages</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="NEBjob-394"><a href="#NEBjob-394"><span class="linenos">394</span></a>            <span class="n">case</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="NEBjob-395"><a href="#NEBjob-395"><span class="linenos">395</span></a>            <span class="n">out</span> <span class="o">=</span> <span class="n">Oszicar</span><span class="p">()</span>
</span><span id="NEBjob-396"><a href="#NEBjob-396"><span class="linenos">396</span></a>            <span class="n">out</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span> <span class="n">case</span> <span class="o">+</span> <span class="s1">&#39;/OSZICAR&#39;</span><span class="p">)</span>
</span><span id="NEBjob-397"><a href="#NEBjob-397"><span class="linenos">397</span></a>            <span class="n">energy_pot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">])</span>
</span><span id="NEBjob-398"><a href="#NEBjob-398"><span class="linenos">398</span></a>            <span class="n">struct</span> <span class="o">=</span> <span class="n">read_atoms</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span> <span class="n">case</span> <span class="o">+</span> <span class="s1">&#39;/CONTCAR&#39;</span><span class="p">)</span>
</span><span id="NEBjob-399"><a href="#NEBjob-399"><span class="linenos">399</span></a>            <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NEBjob-400"><a href="#NEBjob-400"><span class="linenos">400</span></a>                <span class="n">struct</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEBjob-401"><a href="#NEBjob-401"><span class="linenos">401</span></a>            <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span>
</span><span id="NEBjob-402"><a href="#NEBjob-402"><span class="linenos">402</span></a>            <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
</span><span id="NEBjob-403"><a href="#NEBjob-403"><span class="linenos">403</span></a>        
</span><span id="NEBjob-404"><a href="#NEBjob-404"><span class="linenos">404</span></a>        <span class="n">relaxation_steps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">])</span>
</span><span id="NEBjob-405"><a href="#NEBjob-405"><span class="linenos">405</span></a>        <span class="n">energy_pot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="NEBjob-406"><a href="#NEBjob-406"><span class="linenos">406</span></a>            <span class="p">[[</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_energy&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">relaxation_steps</span><span class="p">]</span> <span class="o">+</span> 
</span><span id="NEBjob-407"><a href="#NEBjob-407"><span class="linenos">407</span></a>            <span class="n">energy_pot</span> <span class="o">+</span>
</span><span id="NEBjob-408"><a href="#NEBjob-408"><span class="linenos">408</span></a>            <span class="p">[[</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/final_energy&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">relaxation_steps</span><span class="p">]</span>
</span><span id="NEBjob-409"><a href="#NEBjob-409"><span class="linenos">409</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="NEBjob-410"><a href="#NEBjob-410"><span class="linenos">410</span></a>        
</span><span id="NEBjob-411"><a href="#NEBjob-411"><span class="linenos">411</span></a>        <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span>
</span><span id="NEBjob-412"><a href="#NEBjob-412"><span class="linenos">412</span></a>        <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
</span><span id="NEBjob-413"><a href="#NEBjob-413"><span class="linenos">413</span></a>        
</span><span id="NEBjob-414"><a href="#NEBjob-414"><span class="linenos">414</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;neb&#39;</span><span class="p">)</span>
</span><span id="NEBjob-415"><a href="#NEBjob-415"><span class="linenos">415</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">,</span> <span class="n">energy_pot</span><span class="p">)</span>
</span><span id="NEBjob-416"><a href="#NEBjob-416"><span class="linenos">416</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;final_cells&#39;</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
</span><span id="NEBjob-417"><a href="#NEBjob-417"><span class="linenos">417</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;final_positions&#39;</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>
</span><span id="NEBjob-418"><a href="#NEBjob-418"><span class="linenos">418</span></a>        <span class="n">ene</span> <span class="o">=</span> <span class="n">energy_pot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NEBjob-419"><a href="#NEBjob-419"><span class="linenos">419</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;barrier_forward&#39;</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">ene</span><span class="p">)</span> <span class="o">-</span> <span class="n">ene</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="NEBjob-420"><a href="#NEBjob-420"><span class="linenos">420</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;barrier_backward&#39;</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">ene</span><span class="p">)</span> <span class="o">-</span> <span class="n">ene</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="NEBjob-421"><a href="#NEBjob-421"><span class="linenos">421</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_polynomial_fit_with_derivative_constraints</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">nImages</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="NEBjob-422"><a href="#NEBjob-422"><span class="linenos">422</span></a>        
</span><span id="NEBjob-423"><a href="#NEBjob-423"><span class="linenos">423</span></a>    <span class="k">def</span> <span class="nf">transfer_from_remote_and_collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NEBjob-424"><a href="#NEBjob-424"><span class="linenos">424</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-425"><a href="#NEBjob-425"><span class="linenos">425</span></a><span class="sd">        Transfer files from the remote cluster and collect data locally.</span>
</span><span id="NEBjob-426"><a href="#NEBjob-426"><span class="linenos">426</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob-427"><a href="#NEBjob-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transfer_from_remote</span><span class="p">()</span>
</span><span id="NEBjob-428"><a href="#NEBjob-428"><span class="linenos">428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">collect</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NEBjob-429"><a href="#NEBjob-429"><span class="linenos">429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collect_data</span><span class="p">()</span>
</span><span id="NEBjob-430"><a href="#NEBjob-430"><span class="linenos">430</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NEBjob-431"><a href="#NEBjob-431"><span class="linenos">431</span></a>    
</span><span id="NEBjob-432"><a href="#NEBjob-432"><span class="linenos">432</span></a>    <span class="k">def</span> <span class="nf">_polynomial_fit_with_derivative_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="NEBjob-433"><a href="#NEBjob-433"><span class="linenos">433</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-434"><a href="#NEBjob-434"><span class="linenos">434</span></a><span class="sd">        Fit a polynomial to the NEB energy profile with derivative constraints.</span>
</span><span id="NEBjob-435"><a href="#NEBjob-435"><span class="linenos">435</span></a>
</span><span id="NEBjob-436"><a href="#NEBjob-436"><span class="linenos">436</span></a><span class="sd">        The polynomial is constrained such that its derivatives at x=0 and x=1 are zero.</span>
</span><span id="NEBjob-437"><a href="#NEBjob-437"><span class="linenos">437</span></a>
</span><span id="NEBjob-438"><a href="#NEBjob-438"><span class="linenos">438</span></a><span class="sd">        Parameters:</span>
</span><span id="NEBjob-439"><a href="#NEBjob-439"><span class="linenos">439</span></a><span class="sd">            n (int, optional): The order of the polynomial.</span>
</span><span id="NEBjob-440"><a href="#NEBjob-440"><span class="linenos">440</span></a>
</span><span id="NEBjob-441"><a href="#NEBjob-441"><span class="linenos">441</span></a><span class="sd">        Returns:</span>
</span><span id="NEBjob-442"><a href="#NEBjob-442"><span class="linenos">442</span></a><span class="sd">            Polynomial: The fitted polynomial.</span>
</span><span id="NEBjob-443"><a href="#NEBjob-443"><span class="linenos">443</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob-444"><a href="#NEBjob-444"><span class="linenos">444</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb/energy_pot&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NEBjob-445"><a href="#NEBjob-445"><span class="linenos">445</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</span><span id="NEBjob-446"><a href="#NEBjob-446"><span class="linenos">446</span></a>        
</span><span id="NEBjob-447"><a href="#NEBjob-447"><span class="linenos">447</span></a>        <span class="k">def</span> <span class="nf">poly_val_and_deriv</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="NEBjob-448"><a href="#NEBjob-448"><span class="linenos">448</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-449"><a href="#NEBjob-449"><span class="linenos">449</span></a><span class="sd">            Evaluate the polynomial and its derivative.</span>
</span><span id="NEBjob-450"><a href="#NEBjob-450"><span class="linenos">450</span></a>
</span><span id="NEBjob-451"><a href="#NEBjob-451"><span class="linenos">451</span></a><span class="sd">            Parameters:</span>
</span><span id="NEBjob-452"><a href="#NEBjob-452"><span class="linenos">452</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="NEBjob-453"><a href="#NEBjob-453"><span class="linenos">453</span></a><span class="sd">                x (float or numpy.ndarray): Point(s) at which to evaluate.</span>
</span><span id="NEBjob-454"><a href="#NEBjob-454"><span class="linenos">454</span></a>
</span><span id="NEBjob-455"><a href="#NEBjob-455"><span class="linenos">455</span></a><span class="sd">            Returns:</span>
</span><span id="NEBjob-456"><a href="#NEBjob-456"><span class="linenos">456</span></a><span class="sd">                tuple: Tuple containing the polynomial value and its derivative.</span>
</span><span id="NEBjob-457"><a href="#NEBjob-457"><span class="linenos">457</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="NEBjob-458"><a href="#NEBjob-458"><span class="linenos">458</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
</span><span id="NEBjob-459"><a href="#NEBjob-459"><span class="linenos">459</span></a>            <span class="n">dp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span>
</span><span id="NEBjob-460"><a href="#NEBjob-460"><span class="linenos">460</span></a>            <span class="k">return</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">dp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="NEBjob-461"><a href="#NEBjob-461"><span class="linenos">461</span></a>
</span><span id="NEBjob-462"><a href="#NEBjob-462"><span class="linenos">462</span></a>        <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="NEBjob-463"><a href="#NEBjob-463"><span class="linenos">463</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-464"><a href="#NEBjob-464"><span class="linenos">464</span></a><span class="sd">            Objective function to minimize.</span>
</span><span id="NEBjob-465"><a href="#NEBjob-465"><span class="linenos">465</span></a>
</span><span id="NEBjob-466"><a href="#NEBjob-466"><span class="linenos">466</span></a><span class="sd">            Parameters:</span>
</span><span id="NEBjob-467"><a href="#NEBjob-467"><span class="linenos">467</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="NEBjob-468"><a href="#NEBjob-468"><span class="linenos">468</span></a><span class="sd">                x (float or numpy.ndarray): x-values of the data points.</span>
</span><span id="NEBjob-469"><a href="#NEBjob-469"><span class="linenos">469</span></a><span class="sd">                y (float or numpy.ndarray): y-values of the data points.</span>
</span><span id="NEBjob-470"><a href="#NEBjob-470"><span class="linenos">470</span></a>
</span><span id="NEBjob-471"><a href="#NEBjob-471"><span class="linenos">471</span></a><span class="sd">            Returns:</span>
</span><span id="NEBjob-472"><a href="#NEBjob-472"><span class="linenos">472</span></a><span class="sd">                float: Sum of squared residuals.</span>
</span><span id="NEBjob-473"><a href="#NEBjob-473"><span class="linenos">473</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="NEBjob-474"><a href="#NEBjob-474"><span class="linenos">474</span></a>            <span class="n">p_vals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">poly_val_and_deriv</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="NEBjob-475"><a href="#NEBjob-475"><span class="linenos">475</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">p_vals</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="NEBjob-476"><a href="#NEBjob-476"><span class="linenos">476</span></a>
</span><span id="NEBjob-477"><a href="#NEBjob-477"><span class="linenos">477</span></a>        <span class="k">def</span> <span class="nf">constraint_deriv_0</span><span class="p">(</span><span class="n">coeffs</span><span class="p">):</span>
</span><span id="NEBjob-478"><a href="#NEBjob-478"><span class="linenos">478</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-479"><a href="#NEBjob-479"><span class="linenos">479</span></a><span class="sd">            Constraint for the derivative at x=0 to be zero.</span>
</span><span id="NEBjob-480"><a href="#NEBjob-480"><span class="linenos">480</span></a>
</span><span id="NEBjob-481"><a href="#NEBjob-481"><span class="linenos">481</span></a><span class="sd">            Parameters:</span>
</span><span id="NEBjob-482"><a href="#NEBjob-482"><span class="linenos">482</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="NEBjob-483"><a href="#NEBjob-483"><span class="linenos">483</span></a>
</span><span id="NEBjob-484"><a href="#NEBjob-484"><span class="linenos">484</span></a><span class="sd">            Returns:</span>
</span><span id="NEBjob-485"><a href="#NEBjob-485"><span class="linenos">485</span></a><span class="sd">                float: Derivative at x=0.</span>
</span><span id="NEBjob-486"><a href="#NEBjob-486"><span class="linenos">486</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="NEBjob-487"><a href="#NEBjob-487"><span class="linenos">487</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">dp0</span> <span class="o">=</span> <span class="n">poly_val_and_deriv</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="NEBjob-488"><a href="#NEBjob-488"><span class="linenos">488</span></a>            <span class="k">return</span> <span class="n">dp0</span>
</span><span id="NEBjob-489"><a href="#NEBjob-489"><span class="linenos">489</span></a>
</span><span id="NEBjob-490"><a href="#NEBjob-490"><span class="linenos">490</span></a>        <span class="k">def</span> <span class="nf">constraint_deriv_1</span><span class="p">(</span><span class="n">coeffs</span><span class="p">):</span>
</span><span id="NEBjob-491"><a href="#NEBjob-491"><span class="linenos">491</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-492"><a href="#NEBjob-492"><span class="linenos">492</span></a><span class="sd">            Constraint for the derivative at x=1 to be zero.</span>
</span><span id="NEBjob-493"><a href="#NEBjob-493"><span class="linenos">493</span></a>
</span><span id="NEBjob-494"><a href="#NEBjob-494"><span class="linenos">494</span></a><span class="sd">            Parameters:</span>
</span><span id="NEBjob-495"><a href="#NEBjob-495"><span class="linenos">495</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="NEBjob-496"><a href="#NEBjob-496"><span class="linenos">496</span></a>
</span><span id="NEBjob-497"><a href="#NEBjob-497"><span class="linenos">497</span></a><span class="sd">            Returns:</span>
</span><span id="NEBjob-498"><a href="#NEBjob-498"><span class="linenos">498</span></a><span class="sd">                float: Derivative at x=1.</span>
</span><span id="NEBjob-499"><a href="#NEBjob-499"><span class="linenos">499</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="NEBjob-500"><a href="#NEBjob-500"><span class="linenos">500</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">dp1</span> <span class="o">=</span> <span class="n">poly_val_and_deriv</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="NEBjob-501"><a href="#NEBjob-501"><span class="linenos">501</span></a>            <span class="k">return</span> <span class="n">dp1</span>
</span><span id="NEBjob-502"><a href="#NEBjob-502"><span class="linenos">502</span></a>
</span><span id="NEBjob-503"><a href="#NEBjob-503"><span class="linenos">503</span></a>        <span class="k">def</span> <span class="nf">constraint_val_0</span><span class="p">(</span><span class="n">coeffs</span><span class="p">):</span>
</span><span id="NEBjob-504"><a href="#NEBjob-504"><span class="linenos">504</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-505"><a href="#NEBjob-505"><span class="linenos">505</span></a><span class="sd">            Constraint for the polynomial value at x=0 to match the first data point.</span>
</span><span id="NEBjob-506"><a href="#NEBjob-506"><span class="linenos">506</span></a>
</span><span id="NEBjob-507"><a href="#NEBjob-507"><span class="linenos">507</span></a><span class="sd">            Parameters:</span>
</span><span id="NEBjob-508"><a href="#NEBjob-508"><span class="linenos">508</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="NEBjob-509"><a href="#NEBjob-509"><span class="linenos">509</span></a>
</span><span id="NEBjob-510"><a href="#NEBjob-510"><span class="linenos">510</span></a><span class="sd">            Returns:</span>
</span><span id="NEBjob-511"><a href="#NEBjob-511"><span class="linenos">511</span></a><span class="sd">                float: Difference between polynomial value at x=0 and y[0].</span>
</span><span id="NEBjob-512"><a href="#NEBjob-512"><span class="linenos">512</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="NEBjob-513"><a href="#NEBjob-513"><span class="linenos">513</span></a>            <span class="n">p0</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">poly_val_and_deriv</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="NEBjob-514"><a href="#NEBjob-514"><span class="linenos">514</span></a>            <span class="k">return</span> <span class="n">p0</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NEBjob-515"><a href="#NEBjob-515"><span class="linenos">515</span></a>
</span><span id="NEBjob-516"><a href="#NEBjob-516"><span class="linenos">516</span></a>        <span class="k">def</span> <span class="nf">constraint_val_1</span><span class="p">(</span><span class="n">coeffs</span><span class="p">):</span>
</span><span id="NEBjob-517"><a href="#NEBjob-517"><span class="linenos">517</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-518"><a href="#NEBjob-518"><span class="linenos">518</span></a><span class="sd">            Constraint for the polynomial value at x=1 to match the last data point.</span>
</span><span id="NEBjob-519"><a href="#NEBjob-519"><span class="linenos">519</span></a>
</span><span id="NEBjob-520"><a href="#NEBjob-520"><span class="linenos">520</span></a><span class="sd">            Parameters:</span>
</span><span id="NEBjob-521"><a href="#NEBjob-521"><span class="linenos">521</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="NEBjob-522"><a href="#NEBjob-522"><span class="linenos">522</span></a>
</span><span id="NEBjob-523"><a href="#NEBjob-523"><span class="linenos">523</span></a><span class="sd">            Returns:</span>
</span><span id="NEBjob-524"><a href="#NEBjob-524"><span class="linenos">524</span></a><span class="sd">                float: Difference between polynomial value at x=1 and y[-1].</span>
</span><span id="NEBjob-525"><a href="#NEBjob-525"><span class="linenos">525</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="NEBjob-526"><a href="#NEBjob-526"><span class="linenos">526</span></a>            <span class="n">p1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">poly_val_and_deriv</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="NEBjob-527"><a href="#NEBjob-527"><span class="linenos">527</span></a>            <span class="k">return</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NEBjob-528"><a href="#NEBjob-528"><span class="linenos">528</span></a>
</span><span id="NEBjob-529"><a href="#NEBjob-529"><span class="linenos">529</span></a>        <span class="n">initial_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="NEBjob-530"><a href="#NEBjob-530"><span class="linenos">530</span></a>
</span><span id="NEBjob-531"><a href="#NEBjob-531"><span class="linenos">531</span></a>        <span class="k">def</span> <span class="nf">constraint_max_val</span><span class="p">(</span><span class="n">coeffs</span><span class="p">):</span>
</span><span id="NEBjob-532"><a href="#NEBjob-532"><span class="linenos">532</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-533"><a href="#NEBjob-533"><span class="linenos">533</span></a><span class="sd">            Constraint for the polynomial maximum to match the maximum y value.</span>
</span><span id="NEBjob-534"><a href="#NEBjob-534"><span class="linenos">534</span></a>
</span><span id="NEBjob-535"><a href="#NEBjob-535"><span class="linenos">535</span></a><span class="sd">            Parameters:</span>
</span><span id="NEBjob-536"><a href="#NEBjob-536"><span class="linenos">536</span></a><span class="sd">                coeffs (list or numpy.ndarray): Coefficients of the polynomial.</span>
</span><span id="NEBjob-537"><a href="#NEBjob-537"><span class="linenos">537</span></a>
</span><span id="NEBjob-538"><a href="#NEBjob-538"><span class="linenos">538</span></a><span class="sd">            Returns:</span>
</span><span id="NEBjob-539"><a href="#NEBjob-539"><span class="linenos">539</span></a><span class="sd">                float: Difference between maximum polynomial value and maximum y value.</span>
</span><span id="NEBjob-540"><a href="#NEBjob-540"><span class="linenos">540</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="NEBjob-541"><a href="#NEBjob-541"><span class="linenos">541</span></a>            <span class="n">p</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
</span><span id="NEBjob-542"><a href="#NEBjob-542"><span class="linenos">542</span></a>            <span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="NEBjob-543"><a href="#NEBjob-543"><span class="linenos">543</span></a>            <span class="n">p_vals</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
</span><span id="NEBjob-544"><a href="#NEBjob-544"><span class="linenos">544</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">p_vals</span><span class="p">)</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="NEBjob-545"><a href="#NEBjob-545"><span class="linenos">545</span></a>
</span><span id="NEBjob-546"><a href="#NEBjob-546"><span class="linenos">546</span></a>        <span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="NEBjob-547"><a href="#NEBjob-547"><span class="linenos">547</span></a>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint_deriv_0</span><span class="p">},</span>
</span><span id="NEBjob-548"><a href="#NEBjob-548"><span class="linenos">548</span></a>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint_deriv_1</span><span class="p">},</span>
</span><span id="NEBjob-549"><a href="#NEBjob-549"><span class="linenos">549</span></a>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint_val_0</span><span class="p">},</span>
</span><span id="NEBjob-550"><a href="#NEBjob-550"><span class="linenos">550</span></a>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint_val_1</span><span class="p">},</span>
</span><span id="NEBjob-551"><a href="#NEBjob-551"><span class="linenos">551</span></a>            <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint_max_val</span><span class="p">}</span>
</span><span id="NEBjob-552"><a href="#NEBjob-552"><span class="linenos">552</span></a>        <span class="p">]</span>
</span><span id="NEBjob-553"><a href="#NEBjob-553"><span class="linenos">553</span></a>
</span><span id="NEBjob-554"><a href="#NEBjob-554"><span class="linenos">554</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">)</span>
</span><span id="NEBjob-555"><a href="#NEBjob-555"><span class="linenos">555</span></a>        <span class="n">optimized_coeffs</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
</span><span id="NEBjob-556"><a href="#NEBjob-556"><span class="linenos">556</span></a>        <span class="n">fitted_polynomial</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">optimized_coeffs</span><span class="p">)</span>
</span><span id="NEBjob-557"><a href="#NEBjob-557"><span class="linenos">557</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span> <span class="n">fitted_polynomial</span><span class="p">)</span>
</span><span id="NEBjob-558"><a href="#NEBjob-558"><span class="linenos">558</span></a>        
</span><span id="NEBjob-559"><a href="#NEBjob-559"><span class="linenos">559</span></a>    <span class="k">def</span> <span class="nf">get_energy_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NEBjob-560"><a href="#NEBjob-560"><span class="linenos">560</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob-561"><a href="#NEBjob-561"><span class="linenos">561</span></a><span class="sd">        Get the fitted polynomial for the NEB energy profile.</span>
</span><span id="NEBjob-562"><a href="#NEBjob-562"><span class="linenos">562</span></a>
</span><span id="NEBjob-563"><a href="#NEBjob-563"><span class="linenos">563</span></a><span class="sd">        Returns:</span>
</span><span id="NEBjob-564"><a href="#NEBjob-564"><span class="linenos">564</span></a><span class="sd">            Polynomial: The fitted polynomial.</span>
</span><span id="NEBjob-565"><a href="#NEBjob-565"><span class="linenos">565</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob-566"><a href="#NEBjob-566"><span class="linenos">566</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb/fit&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Class for handling specific NEB (Nudged Elastic Band) job operations.</p>
</div>


                            <div id="NEBjob.get_initial_images" class="classattr">
                                        <input id="NEBjob.get_initial_images-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_initial_images</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NEBjob.get_initial_images-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEBjob.get_initial_images"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEBjob.get_initial_images-307"><a href="#NEBjob.get_initial_images-307"><span class="linenos">307</span></a>    <span class="k">def</span> <span class="nf">get_initial_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NEBjob.get_initial_images-308"><a href="#NEBjob.get_initial_images-308"><span class="linenos">308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob.get_initial_images-309"><a href="#NEBjob.get_initial_images-309"><span class="linenos">309</span></a><span class="sd">        Retrieve the initial interpolated images.</span>
</span><span id="NEBjob.get_initial_images-310"><a href="#NEBjob.get_initial_images-310"><span class="linenos">310</span></a>
</span><span id="NEBjob.get_initial_images-311"><a href="#NEBjob.get_initial_images-311"><span class="linenos">311</span></a><span class="sd">        Returns:</span>
</span><span id="NEBjob.get_initial_images-312"><a href="#NEBjob.get_initial_images-312"><span class="linenos">312</span></a><span class="sd">            Trajectory: Trajectory object containing the initial images.</span>
</span><span id="NEBjob.get_initial_images-313"><a href="#NEBjob.get_initial_images-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob.get_initial_images-314"><a href="#NEBjob.get_initial_images-314"><span class="linenos">314</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="NEBjob.get_initial_images-315"><a href="#NEBjob.get_initial_images-315"><span class="linenos">315</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_positions&#39;</span><span class="p">]</span>
</span><span id="NEBjob.get_initial_images-316"><a href="#NEBjob.get_initial_images-316"><span class="linenos">316</span></a>        <span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_cells&#39;</span><span class="p">]</span>
</span><span id="NEBjob.get_initial_images-317"><a href="#NEBjob.get_initial_images-317"><span class="linenos">317</span></a>        <span class="k">return</span> <span class="n">Trajectory</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the initial interpolated images.</p>

<p>Returns:
    Trajectory: Trajectory object containing the initial images.</p>
</div>


                            </div>
                            <div id="NEBjob.get_final_images" class="classattr">
                                        <input id="NEBjob.get_final_images-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_final_images</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NEBjob.get_final_images-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEBjob.get_final_images"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEBjob.get_final_images-319"><a href="#NEBjob.get_final_images-319"><span class="linenos">319</span></a>    <span class="k">def</span> <span class="nf">get_final_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NEBjob.get_final_images-320"><a href="#NEBjob.get_final_images-320"><span class="linenos">320</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob.get_final_images-321"><a href="#NEBjob.get_final_images-321"><span class="linenos">321</span></a><span class="sd">        Retrieve the final interpolated images after relaxation.</span>
</span><span id="NEBjob.get_final_images-322"><a href="#NEBjob.get_final_images-322"><span class="linenos">322</span></a>
</span><span id="NEBjob.get_final_images-323"><a href="#NEBjob.get_final_images-323"><span class="linenos">323</span></a><span class="sd">        Returns:</span>
</span><span id="NEBjob.get_final_images-324"><a href="#NEBjob.get_final_images-324"><span class="linenos">324</span></a><span class="sd">            Trajectory: Trajectory object containing the final images.</span>
</span><span id="NEBjob.get_final_images-325"><a href="#NEBjob.get_final_images-325"><span class="linenos">325</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob.get_final_images-326"><a href="#NEBjob.get_final_images-326"><span class="linenos">326</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="NEBjob.get_final_images-327"><a href="#NEBjob.get_final_images-327"><span class="linenos">327</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb/final_positions&#39;</span><span class="p">]</span>
</span><span id="NEBjob.get_final_images-328"><a href="#NEBjob.get_final_images-328"><span class="linenos">328</span></a>        <span class="n">cells</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb/final_cells&#39;</span><span class="p">]</span>
</span><span id="NEBjob.get_final_images-329"><a href="#NEBjob.get_final_images-329"><span class="linenos">329</span></a>        <span class="k">return</span> <span class="n">Trajectory</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the final interpolated images after relaxation.</p>

<p>Returns:
    Trajectory: Trajectory object containing the final images.</p>
</div>


                            </div>
                            <div id="NEBjob.write_and_transfer_to_remote" class="classattr">
                                        <input id="NEBjob.write_and_transfer_to_remote-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_and_transfer_to_remote</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NEBjob.write_and_transfer_to_remote-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEBjob.write_and_transfer_to_remote"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEBjob.write_and_transfer_to_remote-348"><a href="#NEBjob.write_and_transfer_to_remote-348"><span class="linenos">348</span></a>    <span class="k">def</span> <span class="nf">write_and_transfer_to_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NEBjob.write_and_transfer_to_remote-349"><a href="#NEBjob.write_and_transfer_to_remote-349"><span class="linenos">349</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob.write_and_transfer_to_remote-350"><a href="#NEBjob.write_and_transfer_to_remote-350"><span class="linenos">350</span></a><span class="sd">        Write the input files and transfer them to the remote cluster.</span>
</span><span id="NEBjob.write_and_transfer_to_remote-351"><a href="#NEBjob.write_and_transfer_to_remote-351"><span class="linenos">351</span></a>
</span><span id="NEBjob.write_and_transfer_to_remote-352"><a href="#NEBjob.write_and_transfer_to_remote-352"><span class="linenos">352</span></a><span class="sd">        Warnings:</span>
</span><span id="NEBjob.write_and_transfer_to_remote-353"><a href="#NEBjob.write_and_transfer_to_remote-353"><span class="linenos">353</span></a><span class="sd">            If the job is already marked as finished, a warning is issued and no action is taken.</span>
</span><span id="NEBjob.write_and_transfer_to_remote-354"><a href="#NEBjob.write_and_transfer_to_remote-354"><span class="linenos">354</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob.write_and_transfer_to_remote-355"><a href="#NEBjob.write_and_transfer_to_remote-355"><span class="linenos">355</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">job_status_successful_lst</span><span class="p">:</span>
</span><span id="NEBjob.write_and_transfer_to_remote-356"><a href="#NEBjob.write_and_transfer_to_remote-356"><span class="linenos">356</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_images</span><span class="p">()</span>
</span><span id="NEBjob.write_and_transfer_to_remote-357"><a href="#NEBjob.write_and_transfer_to_remote-357"><span class="linenos">357</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_input</span><span class="p">()</span>
</span><span id="NEBjob.write_and_transfer_to_remote-358"><a href="#NEBjob.write_and_transfer_to_remote-358"><span class="linenos">358</span></a>            
</span><span id="NEBjob.write_and_transfer_to_remote-359"><a href="#NEBjob.write_and_transfer_to_remote-359"><span class="linenos">359</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">queue_adapter</span><span class="o">.</span><span class="n">convert_path_to_remote</span><span class="p">(</span>
</span><span id="NEBjob.write_and_transfer_to_remote-360"><a href="#NEBjob.write_and_transfer_to_remote-360"><span class="linenos">360</span></a>                <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">file_name</span>
</span><span id="NEBjob.write_and_transfer_to_remote-361"><a href="#NEBjob.write_and_transfer_to_remote-361"><span class="linenos">361</span></a>            <span class="p">)</span>
</span><span id="NEBjob.write_and_transfer_to_remote-362"><a href="#NEBjob.write_and_transfer_to_remote-362"><span class="linenos">362</span></a>            <span class="n">working_directory</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">queue_adapter</span><span class="o">.</span><span class="n">convert_path_to_remote</span><span class="p">(</span>
</span><span id="NEBjob.write_and_transfer_to_remote-363"><a href="#NEBjob.write_and_transfer_to_remote-363"><span class="linenos">363</span></a>                <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span>
</span><span id="NEBjob.write_and_transfer_to_remote-364"><a href="#NEBjob.write_and_transfer_to_remote-364"><span class="linenos">364</span></a>            <span class="p">)</span>
</span><span id="NEBjob.write_and_transfer_to_remote-365"><a href="#NEBjob.write_and_transfer_to_remote-365"><span class="linenos">365</span></a>            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;_hdf5/**&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="NEBjob.write_and_transfer_to_remote-366"><a href="#NEBjob.write_and_transfer_to_remote-366"><span class="linenos">366</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>                
</span><span id="NEBjob.write_and_transfer_to_remote-367"><a href="#NEBjob.write_and_transfer_to_remote-367"><span class="linenos">367</span></a>                    <span class="n">state</span><span class="o">.</span><span class="n">queue_adapter</span><span class="o">.</span><span class="n">transfer_file_to_remote</span><span class="p">(</span>
</span><span id="NEBjob.write_and_transfer_to_remote-368"><a href="#NEBjob.write_and_transfer_to_remote-368"><span class="linenos">368</span></a>                        <span class="n">file</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">transfer_back</span><span class="o">=</span><span class="kc">False</span>
</span><span id="NEBjob.write_and_transfer_to_remote-369"><a href="#NEBjob.write_and_transfer_to_remote-369"><span class="linenos">369</span></a>                    <span class="p">)</span>
</span><span id="NEBjob.write_and_transfer_to_remote-370"><a href="#NEBjob.write_and_transfer_to_remote-370"><span class="linenos">370</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NEBjob.write_and_transfer_to_remote-371"><a href="#NEBjob.write_and_transfer_to_remote-371"><span class="linenos">371</span></a>            <span class="n">state</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Job `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="si">}</span><span class="s1">` is marked as finished, uploading doesn</span><span class="se">\&#39;</span><span class="s1">t make sense&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write the input files and transfer them to the remote cluster.</p>

<p>Warnings:
    If the job is already marked as finished, a warning is issued and no action is taken.</p>
</div>


                            </div>
                            <div id="NEBjob.collect_data" class="classattr">
                                        <input id="NEBjob.collect_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">collect_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NEBjob.collect_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEBjob.collect_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEBjob.collect_data-373"><a href="#NEBjob.collect_data-373"><span class="linenos">373</span></a>    <span class="k">def</span> <span class="nf">collect_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mf">0.98</span><span class="p">):</span>
</span><span id="NEBjob.collect_data-374"><a href="#NEBjob.collect_data-374"><span class="linenos">374</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob.collect_data-375"><a href="#NEBjob.collect_data-375"><span class="linenos">375</span></a><span class="sd">        Collect the data from the NEB calculation.</span>
</span><span id="NEBjob.collect_data-376"><a href="#NEBjob.collect_data-376"><span class="linenos">376</span></a>
</span><span id="NEBjob.collect_data-377"><a href="#NEBjob.collect_data-377"><span class="linenos">377</span></a><span class="sd">        Parameters:</span>
</span><span id="NEBjob.collect_data-378"><a href="#NEBjob.collect_data-378"><span class="linenos">378</span></a><span class="sd">            wrap (float or bool, optional): Wrap value for atomic positions. Set to `False` to disable wrapping.</span>
</span><span id="NEBjob.collect_data-379"><a href="#NEBjob.collect_data-379"><span class="linenos">379</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob.collect_data-380"><a href="#NEBjob.collect_data-380"><span class="linenos">380</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;_hdf5/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_name</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
</span><span id="NEBjob.collect_data-381"><a href="#NEBjob.collect_data-381"><span class="linenos">381</span></a>        <span class="n">nImages</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/nImages&#39;</span><span class="p">]</span>
</span><span id="NEBjob.collect_data-382"><a href="#NEBjob.collect_data-382"><span class="linenos">382</span></a>        <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="NEBjob.collect_data-383"><a href="#NEBjob.collect_data-383"><span class="linenos">383</span></a>        <span class="n">final</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/final_image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_object</span><span class="p">()</span>
</span><span id="NEBjob.collect_data-384"><a href="#NEBjob.collect_data-384"><span class="linenos">384</span></a>        
</span><span id="NEBjob.collect_data-385"><a href="#NEBjob.collect_data-385"><span class="linenos">385</span></a>        <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NEBjob.collect_data-386"><a href="#NEBjob.collect_data-386"><span class="linenos">386</span></a>            <span class="n">initial</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEBjob.collect_data-387"><a href="#NEBjob.collect_data-387"><span class="linenos">387</span></a>            <span class="n">final</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">final</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEBjob.collect_data-388"><a href="#NEBjob.collect_data-388"><span class="linenos">388</span></a>        
</span><span id="NEBjob.collect_data-389"><a href="#NEBjob.collect_data-389"><span class="linenos">389</span></a>        <span class="n">cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial</span><span class="o">.</span><span class="n">cell</span><span class="p">]</span>
</span><span id="NEBjob.collect_data-390"><a href="#NEBjob.collect_data-390"><span class="linenos">390</span></a>        <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial</span><span class="o">.</span><span class="n">positions</span><span class="p">]</span>
</span><span id="NEBjob.collect_data-391"><a href="#NEBjob.collect_data-391"><span class="linenos">391</span></a>        <span class="n">energy_pot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NEBjob.collect_data-392"><a href="#NEBjob.collect_data-392"><span class="linenos">392</span></a>        
</span><span id="NEBjob.collect_data-393"><a href="#NEBjob.collect_data-393"><span class="linenos">393</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nImages</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="NEBjob.collect_data-394"><a href="#NEBjob.collect_data-394"><span class="linenos">394</span></a>            <span class="n">case</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="NEBjob.collect_data-395"><a href="#NEBjob.collect_data-395"><span class="linenos">395</span></a>            <span class="n">out</span> <span class="o">=</span> <span class="n">Oszicar</span><span class="p">()</span>
</span><span id="NEBjob.collect_data-396"><a href="#NEBjob.collect_data-396"><span class="linenos">396</span></a>            <span class="n">out</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span> <span class="n">case</span> <span class="o">+</span> <span class="s1">&#39;/OSZICAR&#39;</span><span class="p">)</span>
</span><span id="NEBjob.collect_data-397"><a href="#NEBjob.collect_data-397"><span class="linenos">397</span></a>            <span class="n">energy_pot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">])</span>
</span><span id="NEBjob.collect_data-398"><a href="#NEBjob.collect_data-398"><span class="linenos">398</span></a>            <span class="n">struct</span> <span class="o">=</span> <span class="n">read_atoms</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">path</span> <span class="o">+</span> <span class="n">case</span> <span class="o">+</span> <span class="s1">&#39;/CONTCAR&#39;</span><span class="p">)</span>
</span><span id="NEBjob.collect_data-399"><a href="#NEBjob.collect_data-399"><span class="linenos">399</span></a>            <span class="k">if</span> <span class="n">wrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NEBjob.collect_data-400"><a href="#NEBjob.collect_data-400"><span class="linenos">400</span></a>                <span class="n">struct</span> <span class="o">=</span> <span class="n">_wrap_positions</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">wrap</span><span class="p">)</span>
</span><span id="NEBjob.collect_data-401"><a href="#NEBjob.collect_data-401"><span class="linenos">401</span></a>            <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span>
</span><span id="NEBjob.collect_data-402"><a href="#NEBjob.collect_data-402"><span class="linenos">402</span></a>            <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
</span><span id="NEBjob.collect_data-403"><a href="#NEBjob.collect_data-403"><span class="linenos">403</span></a>        
</span><span id="NEBjob.collect_data-404"><a href="#NEBjob.collect_data-404"><span class="linenos">404</span></a>        <span class="n">relaxation_steps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">])</span>
</span><span id="NEBjob.collect_data-405"><a href="#NEBjob.collect_data-405"><span class="linenos">405</span></a>        <span class="n">energy_pot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="NEBjob.collect_data-406"><a href="#NEBjob.collect_data-406"><span class="linenos">406</span></a>            <span class="p">[[</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/initial_energy&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">relaxation_steps</span><span class="p">]</span> <span class="o">+</span> 
</span><span id="NEBjob.collect_data-407"><a href="#NEBjob.collect_data-407"><span class="linenos">407</span></a>            <span class="n">energy_pot</span> <span class="o">+</span>
</span><span id="NEBjob.collect_data-408"><a href="#NEBjob.collect_data-408"><span class="linenos">408</span></a>            <span class="p">[[</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;input/neb/final_energy&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">relaxation_steps</span><span class="p">]</span>
</span><span id="NEBjob.collect_data-409"><a href="#NEBjob.collect_data-409"><span class="linenos">409</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="NEBjob.collect_data-410"><a href="#NEBjob.collect_data-410"><span class="linenos">410</span></a>        
</span><span id="NEBjob.collect_data-411"><a href="#NEBjob.collect_data-411"><span class="linenos">411</span></a>        <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span>
</span><span id="NEBjob.collect_data-412"><a href="#NEBjob.collect_data-412"><span class="linenos">412</span></a>        <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
</span><span id="NEBjob.collect_data-413"><a href="#NEBjob.collect_data-413"><span class="linenos">413</span></a>        
</span><span id="NEBjob.collect_data-414"><a href="#NEBjob.collect_data-414"><span class="linenos">414</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;neb&#39;</span><span class="p">)</span>
</span><span id="NEBjob.collect_data-415"><a href="#NEBjob.collect_data-415"><span class="linenos">415</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;energy_pot&#39;</span><span class="p">,</span> <span class="n">energy_pot</span><span class="p">)</span>
</span><span id="NEBjob.collect_data-416"><a href="#NEBjob.collect_data-416"><span class="linenos">416</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;final_cells&#39;</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
</span><span id="NEBjob.collect_data-417"><a href="#NEBjob.collect_data-417"><span class="linenos">417</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;final_positions&#39;</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>
</span><span id="NEBjob.collect_data-418"><a href="#NEBjob.collect_data-418"><span class="linenos">418</span></a>        <span class="n">ene</span> <span class="o">=</span> <span class="n">energy_pot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NEBjob.collect_data-419"><a href="#NEBjob.collect_data-419"><span class="linenos">419</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;barrier_forward&#39;</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">ene</span><span class="p">)</span> <span class="o">-</span> <span class="n">ene</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="NEBjob.collect_data-420"><a href="#NEBjob.collect_data-420"><span class="linenos">420</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;barrier_backward&#39;</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">ene</span><span class="p">)</span> <span class="o">-</span> <span class="n">ene</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="NEBjob.collect_data-421"><a href="#NEBjob.collect_data-421"><span class="linenos">421</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_polynomial_fit_with_derivative_constraints</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">nImages</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Collect the data from the NEB calculation.</p>

<p>Parameters:
    wrap (float or bool, optional): Wrap value for atomic positions. Set to <code>False</code> to disable wrapping.</p>
</div>


                            </div>
                            <div id="NEBjob.transfer_from_remote_and_collect" class="classattr">
                                        <input id="NEBjob.transfer_from_remote_and_collect-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">transfer_from_remote_and_collect</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NEBjob.transfer_from_remote_and_collect-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEBjob.transfer_from_remote_and_collect"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEBjob.transfer_from_remote_and_collect-423"><a href="#NEBjob.transfer_from_remote_and_collect-423"><span class="linenos">423</span></a>    <span class="k">def</span> <span class="nf">transfer_from_remote_and_collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NEBjob.transfer_from_remote_and_collect-424"><a href="#NEBjob.transfer_from_remote_and_collect-424"><span class="linenos">424</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob.transfer_from_remote_and_collect-425"><a href="#NEBjob.transfer_from_remote_and_collect-425"><span class="linenos">425</span></a><span class="sd">        Transfer files from the remote cluster and collect data locally.</span>
</span><span id="NEBjob.transfer_from_remote_and_collect-426"><a href="#NEBjob.transfer_from_remote_and_collect-426"><span class="linenos">426</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob.transfer_from_remote_and_collect-427"><a href="#NEBjob.transfer_from_remote_and_collect-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transfer_from_remote</span><span class="p">()</span>
</span><span id="NEBjob.transfer_from_remote_and_collect-428"><a href="#NEBjob.transfer_from_remote_and_collect-428"><span class="linenos">428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">collect</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NEBjob.transfer_from_remote_and_collect-429"><a href="#NEBjob.transfer_from_remote_and_collect-429"><span class="linenos">429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collect_data</span><span class="p">()</span>
</span><span id="NEBjob.transfer_from_remote_and_collect-430"><a href="#NEBjob.transfer_from_remote_and_collect-430"><span class="linenos">430</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Transfer files from the remote cluster and collect data locally.</p>
</div>


                            </div>
                            <div id="NEBjob.get_energy_fit" class="classattr">
                                        <input id="NEBjob.get_energy_fit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_energy_fit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NEBjob.get_energy_fit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NEBjob.get_energy_fit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NEBjob.get_energy_fit-559"><a href="#NEBjob.get_energy_fit-559"><span class="linenos">559</span></a>    <span class="k">def</span> <span class="nf">get_energy_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NEBjob.get_energy_fit-560"><a href="#NEBjob.get_energy_fit-560"><span class="linenos">560</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NEBjob.get_energy_fit-561"><a href="#NEBjob.get_energy_fit-561"><span class="linenos">561</span></a><span class="sd">        Get the fitted polynomial for the NEB energy profile.</span>
</span><span id="NEBjob.get_energy_fit-562"><a href="#NEBjob.get_energy_fit-562"><span class="linenos">562</span></a>
</span><span id="NEBjob.get_energy_fit-563"><a href="#NEBjob.get_energy_fit-563"><span class="linenos">563</span></a><span class="sd">        Returns:</span>
</span><span id="NEBjob.get_energy_fit-564"><a href="#NEBjob.get_energy_fit-564"><span class="linenos">564</span></a><span class="sd">            Polynomial: The fitted polynomial.</span>
</span><span id="NEBjob.get_energy_fit-565"><a href="#NEBjob.get_energy_fit-565"><span class="linenos">565</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NEBjob.get_energy_fit-566"><a href="#NEBjob.get_energy_fit-566"><span class="linenos">566</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;output/neb/fit&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Get the fitted polynomial for the NEB energy profile.</p>

<p>Returns:
    Polynomial: The fitted polynomial.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>pyiron_atomistics.vasp.vasp.Vasp</dt>
                                <dd id="NEBjob.__init__" class="function">Vasp</dd>

            </div>
            <div><dt>pyiron_atomistics.vasp.interactive.VaspInteractive</dt>
                                <dd id="NEBjob.interactive_flush_frequency" class="variable">interactive_flush_frequency</dd>
                <dd id="NEBjob.structure" class="variable">structure</dd>
                <dd id="NEBjob.interactive_enforce_structure_reset" class="variable">interactive_enforce_structure_reset</dd>
                <dd id="NEBjob.interactive_close" class="function">interactive_close</dd>
                <dd id="NEBjob.interactive_energy_tot_getter" class="function">interactive_energy_tot_getter</dd>
                <dd id="NEBjob.interactive_energy_pot_getter" class="function">interactive_energy_pot_getter</dd>
                <dd id="NEBjob.validate_ready_to_run" class="function">validate_ready_to_run</dd>
                <dd id="NEBjob.interactive_forces_getter" class="function">interactive_forces_getter</dd>
                <dd id="NEBjob.interactive_initialize_interface" class="function">interactive_initialize_interface</dd>
                <dd id="NEBjob.calc_minimize" class="function">calc_minimize</dd>
                <dd id="NEBjob.calc_md" class="function">calc_md</dd>
                <dd id="NEBjob.run_if_interactive_non_modal" class="function">run_if_interactive_non_modal</dd>
                <dd id="NEBjob.run_if_interactive" class="function">run_if_interactive</dd>
                <dd id="NEBjob.interactive_fetch" class="function">interactive_fetch</dd>
                <dd id="NEBjob.interactive_positions_setter" class="function">interactive_positions_setter</dd>
                <dd id="NEBjob.interactive_prepare" class="function">interactive_prepare</dd>
                <dd id="NEBjob.convergence_check" class="function">convergence_check</dd>

            </div>
            <div><dt>pyiron_atomistics.vasp.base.VaspBase</dt>
                                <dd id="NEBjob.input" class="variable">input</dd>
                <dd id="NEBjob.get_enmax_among_species" class="variable">get_enmax_among_species</dd>
                <dd id="NEBjob.potential" class="variable">potential</dd>
                <dd id="NEBjob.plane_wave_cutoff" class="variable">plane_wave_cutoff</dd>
                <dd id="NEBjob.exchange_correlation_functional" class="variable">exchange_correlation_functional</dd>
                <dd id="NEBjob.spin_constraints" class="variable">spin_constraints</dd>
                <dd id="NEBjob.write_electrostatic_potential" class="variable">write_electrostatic_potential</dd>
                <dd id="NEBjob.write_charge_density" class="variable">write_charge_density</dd>
                <dd id="NEBjob.write_wave_funct" class="variable">write_wave_funct</dd>
                <dd id="NEBjob.write_resolved_dos" class="variable">write_resolved_dos</dd>
                <dd id="NEBjob.sorted_indices" class="variable">sorted_indices</dd>
                <dd id="NEBjob.fix_spin_constraint" class="variable">fix_spin_constraint</dd>
                <dd id="NEBjob.fix_symmetry" class="variable">fix_symmetry</dd>
                <dd id="NEBjob.potential_available" class="variable">potential_available</dd>
                <dd id="NEBjob.potential_view" class="variable">potential_view</dd>
                <dd id="NEBjob.potential_list" class="variable">potential_list</dd>
                <dd id="NEBjob.publication" class="variable">publication</dd>
                <dd id="NEBjob.get_kpoints" class="function">get_kpoints</dd>
                <dd id="NEBjob.set_input_to_read_only" class="function">set_input_to_read_only</dd>
                <dd id="NEBjob.get_input_parameter_dict" class="function">get_input_parameter_dict</dd>
                <dd id="NEBjob.save_output" class="function">save_output</dd>
                <dd id="NEBjob.get_output_parameter_dict" class="function">get_output_parameter_dict</dd>
                <dd id="NEBjob.cleanup" class="function">cleanup</dd>
                <dd id="NEBjob.collect_logfiles" class="function">collect_logfiles</dd>
                <dd id="NEBjob.collect_warnings" class="function">collect_warnings</dd>
                <dd id="NEBjob.collect_errors" class="function">collect_errors</dd>
                <dd id="NEBjob.copy_hamiltonian" class="function">copy_hamiltonian</dd>
                <dd id="NEBjob.from_directory" class="function">from_directory</dd>
                <dd id="NEBjob.stop_calculation" class="function">stop_calculation</dd>
                <dd id="NEBjob.to_dict" class="function">to_dict</dd>
                <dd id="NEBjob.from_dict" class="function">from_dict</dd>
                <dd id="NEBjob.to_hdf" class="function">to_hdf</dd>
                <dd id="NEBjob.from_hdf" class="function">from_hdf</dd>
                <dd id="NEBjob.reset_output" class="function">reset_output</dd>
                <dd id="NEBjob.get_final_structure_from_file" class="function">get_final_structure_from_file</dd>
                <dd id="NEBjob.write_magmoms" class="function">write_magmoms</dd>
                <dd id="NEBjob.set_eddrmm_handling" class="function">set_eddrmm_handling</dd>
                <dd id="NEBjob.get_eddrmm_handling" class="function">get_eddrmm_handling</dd>
                <dd id="NEBjob.set_coulomb_interactions" class="function">set_coulomb_interactions</dd>
                <dd id="NEBjob.set_algorithm" class="function">set_algorithm</dd>
                <dd id="NEBjob.calc_static" class="function">calc_static</dd>
                <dd id="NEBjob.set_for_band_structure_calc" class="function">set_for_band_structure_calc</dd>
                <dd id="NEBjob.set_convergence_precision" class="function">set_convergence_precision</dd>
                <dd id="NEBjob.set_dipole_correction" class="function">set_dipole_correction</dd>
                <dd id="NEBjob.set_electric_field" class="function">set_electric_field</dd>
                <dd id="NEBjob.set_occupancy_smearing" class="function">set_occupancy_smearing</dd>
                <dd id="NEBjob.set_fft_mesh" class="function">set_fft_mesh</dd>
                <dd id="NEBjob.set_mixing_parameters" class="function">set_mixing_parameters</dd>
                <dd id="NEBjob.set_empty_states" class="function">set_empty_states</dd>
                <dd id="NEBjob.get_nelect" class="function">get_nelect</dd>
                <dd id="NEBjob.get_magnetic_moments" class="function">get_magnetic_moments</dd>
                <dd id="NEBjob.get_charge_density" class="function">get_charge_density</dd>
                <dd id="NEBjob.get_valence_and_total_charge_density" class="function">get_valence_and_total_charge_density</dd>
                <dd id="NEBjob.get_electrostatic_potential" class="function">get_electrostatic_potential</dd>
                <dd id="NEBjob.restart" class="function">restart</dd>
                <dd id="NEBjob.restart_for_band_structure_calculations" class="function">restart_for_band_structure_calculations</dd>
                <dd id="NEBjob.get_icharg_value" class="function">get_icharg_value</dd>
                <dd id="NEBjob.restart_from_charge_density" class="function">restart_from_charge_density</dd>
                <dd id="NEBjob.append_charge_density" class="function">append_charge_density</dd>
                <dd id="NEBjob.restart_from_wave_and_charge" class="function">restart_from_wave_and_charge</dd>
                <dd id="NEBjob.compress" class="function">compress</dd>
                <dd id="NEBjob.restart_from_wave_functions" class="function">restart_from_wave_functions</dd>
                <dd id="NEBjob.append_wave_function" class="function">append_wave_function</dd>
                <dd id="NEBjob.set_rwigs" class="function">set_rwigs</dd>
                <dd id="NEBjob.get_rwigs" class="function">get_rwigs</dd>
                <dd id="NEBjob.set_spin_constraint" class="function">set_spin_constraint</dd>
                <dd id="NEBjob.list_potentials" class="function">list_potentials</dd>

            </div>
            <div><dt>pyiron_atomistics.dft.job.generic.GenericDFTJob</dt>
                                <dd id="NEBjob.map_functions" class="variable">map_functions</dd>
                <dd id="NEBjob.encut" class="variable">encut</dd>
                <dd id="NEBjob.kpoint_mesh" class="variable">kpoint_mesh</dd>
                <dd id="NEBjob.xc" class="variable">xc</dd>
                <dd id="NEBjob.k_mesh_spacing" class="variable">k_mesh_spacing</dd>
                <dd id="NEBjob.k_mesh_center_shift" class="variable">k_mesh_center_shift</dd>
                <dd id="NEBjob.reduce_kpoint_symmetry" class="variable">reduce_kpoint_symmetry</dd>
                <dd id="NEBjob.get_k_mesh_by_cell" class="function">get_k_mesh_by_cell</dd>
                <dd id="NEBjob.set_kpoints" class="function">set_kpoints</dd>
                <dd id="NEBjob.nbands_convergence_check" class="function">nbands_convergence_check</dd>
                <dd id="NEBjob.get_encut" class="function">get_encut</dd>
                <dd id="NEBjob.set_encut" class="function">set_encut</dd>
                <dd id="NEBjob.set_exchange_correlation_functional" class="function">set_exchange_correlation_functional</dd>
                <dd id="NEBjob.get_bader_charges" class="function">get_bader_charges</dd>
                <dd id="NEBjob.get_bader_volumes" class="function">get_bader_volumes</dd>
                <dd id="NEBjob.get_electronic_structure" class="function">get_electronic_structure</dd>
                <dd id="NEBjob.modify_kpoints" class="function">modify_kpoints</dd>
                <dd id="NEBjob.save" class="function">save</dd>
                <dd id="NEBjob.get_density_of_states" class="function">get_density_of_states</dd>

            </div>
            <div><dt>pyiron_atomistics.atomistics.job.interactive.GenericInteractive</dt>
                                <dd id="NEBjob.output" class="variable">output</dd>
                <dd id="NEBjob.interactive_input_functions" class="variable">interactive_input_functions</dd>
                <dd id="NEBjob.interactive_output_functions" class="variable">interactive_output_functions</dd>
                <dd id="NEBjob.interactive_cache" class="variable">interactive_cache</dd>
                <dd id="NEBjob.initial_structure" class="variable">initial_structure</dd>
                <dd id="NEBjob.current_structure" class="variable">current_structure</dd>
                <dd id="NEBjob.species_from_hdf" class="function">species_from_hdf</dd>
                <dd id="NEBjob.interactive_index_organizer" class="function">interactive_index_organizer</dd>
                <dd id="NEBjob.interactive_cell_organizer" class="function">interactive_cell_organizer</dd>
                <dd id="NEBjob.interactive_positions_organizer" class="function">interactive_positions_organizer</dd>
                <dd id="NEBjob.interactive_magmom_organizer" class="function">interactive_magmom_organizer</dd>
                <dd id="NEBjob.interactive_cells_getter" class="function">interactive_cells_getter</dd>
                <dd id="NEBjob.interactive_collect" class="function">interactive_collect</dd>
                <dd id="NEBjob.interactive_flush" class="function">interactive_flush</dd>
                <dd id="NEBjob.interactive_indices_getter" class="function">interactive_indices_getter</dd>
                <dd id="NEBjob.interactive_positions_getter" class="function">interactive_positions_getter</dd>
                <dd id="NEBjob.interactive_steps_getter" class="function">interactive_steps_getter</dd>
                <dd id="NEBjob.interactive_time_getter" class="function">interactive_time_getter</dd>
                <dd id="NEBjob.interactive_volume_getter" class="function">interactive_volume_getter</dd>
                <dd id="NEBjob.interactive_cells_setter" class="function">interactive_cells_setter</dd>
                <dd id="NEBjob.interactive_indices_setter" class="function">interactive_indices_setter</dd>
                <dd id="NEBjob.interactive_spins_getter" class="function">interactive_spins_getter</dd>
                <dd id="NEBjob.interactive_spin_constraints_getter" class="function">interactive_spin_constraints_getter</dd>
                <dd id="NEBjob.interactive_atom_spin_constraints_getter" class="function">interactive_atom_spin_constraints_getter</dd>
                <dd id="NEBjob.interactive_atom_spins_getter" class="function">interactive_atom_spins_getter</dd>
                <dd id="NEBjob.interactive_magnetic_forces_getter" class="function">interactive_magnetic_forces_getter</dd>
                <dd id="NEBjob.interactive_spin_constraints_setter" class="function">interactive_spin_constraints_setter</dd>
                <dd id="NEBjob.interactive_pressures_getter" class="function">interactive_pressures_getter</dd>
                <dd id="NEBjob.interactive_stress_getter" class="function">interactive_stress_getter</dd>
                <dd id="NEBjob.interactive_structure_setter" class="function">interactive_structure_setter</dd>
                <dd id="NEBjob.interactive_computation_time_getter" class="function">interactive_computation_time_getter</dd>
                <dd id="NEBjob.interactive_temperatures_getter" class="function">interactive_temperatures_getter</dd>
                <dd id="NEBjob.interactive_unwrapped_positions_getter" class="function">interactive_unwrapped_positions_getter</dd>

            </div>
            <div><dt>pyiron_atomistics.atomistics.job.atomistic.AtomisticGenericJob</dt>
                                <dd id="NEBjob.create_pipeline" class="function">create_pipeline</dd>
                <dd id="NEBjob.store_structure" class="function">store_structure</dd>
                <dd id="NEBjob.animate_structure" class="function">animate_structure</dd>
                <dd id="NEBjob.view_structure" class="function">view_structure</dd>
                <dd id="NEBjob.db_entry" class="function">db_entry</dd>
                <dd id="NEBjob.get_workdir_file" class="function">get_workdir_file</dd>
                <dd id="NEBjob.continue_with_restart_files" class="function">continue_with_restart_files</dd>
                <dd id="NEBjob.continue_with_final_structure" class="function">continue_with_final_structure</dd>
                <dd id="NEBjob.trajectory" class="function">trajectory</dd>
                <dd id="NEBjob.write_traj" class="function">write_traj</dd>
                <dd id="NEBjob.get_neighbors_snapshots" class="function">get_neighbors_snapshots</dd>
                <dd id="NEBjob.get_neighbors" class="function">get_neighbors</dd>
                <dd id="NEBjob.get_final_structure" class="function">get_final_structure</dd>
                <dd id="NEBjob.map" class="function">map</dd>
                <dd id="NEBjob.gui" class="function">gui</dd>

            </div>
            <div><dt>pyiron_base.jobs.job.interactive.InteractiveBase</dt>
                                <dd id="NEBjob.interactive_write_frequency" class="variable">interactive_write_frequency</dd>
                <dd id="NEBjob.interactive_is_activated" class="function">interactive_is_activated</dd>
                <dd id="NEBjob.interactive_open" class="function">interactive_open</dd>
                <dd id="NEBjob.interactive_store_in_cache" class="function">interactive_store_in_cache</dd>

            </div>
            <div><dt>pyiron_base.jobs.job.generic.GenericJob</dt>
                                <dd id="NEBjob.error" class="variable">error</dd>
                <dd id="NEBjob.version" class="variable">version</dd>
                <dd id="NEBjob.executable" class="variable">executable</dd>
                <dd id="NEBjob.server" class="variable">server</dd>
                <dd id="NEBjob.queue_id" class="variable">queue_id</dd>
                <dd id="NEBjob.logger" class="variable">logger</dd>
                <dd id="NEBjob.restart_file_list" class="variable">restart_file_list</dd>
                <dd id="NEBjob.restart_file_dict" class="variable">restart_file_dict</dd>
                <dd id="NEBjob.exclude_nodes_hdf" class="variable">exclude_nodes_hdf</dd>
                <dd id="NEBjob.exclude_groups_hdf" class="variable">exclude_groups_hdf</dd>
                <dd id="NEBjob.job_type" class="variable">job_type</dd>
                <dd id="NEBjob.working_directory" class="variable">working_directory</dd>
                <dd id="NEBjob.executor_type" class="variable">executor_type</dd>
                <dd id="NEBjob.calculate_kwargs" class="variable">calculate_kwargs</dd>
                <dd id="NEBjob.clear_job" class="function">clear_job</dd>
                <dd id="NEBjob.copy" class="function">copy</dd>
                <dd id="NEBjob.get_calculate_function" class="function">get_calculate_function</dd>
                <dd id="NEBjob.collect_output" class="function">collect_output</dd>
                <dd id="NEBjob.suspend" class="function">suspend</dd>
                <dd id="NEBjob.refresh_job_status" class="function">refresh_job_status</dd>
                <dd id="NEBjob.write_input" class="function">write_input</dd>
                <dd id="NEBjob.copy_to" class="function">copy_to</dd>
                <dd id="NEBjob.copy_file_to_working_directory" class="function">copy_file_to_working_directory</dd>
                <dd id="NEBjob.copy_template" class="function">copy_template</dd>
                <dd id="NEBjob.remove" class="function">remove</dd>
                <dd id="NEBjob.remove_child" class="function">remove_child</dd>
                <dd id="NEBjob.remove_and_reset_id" class="function">remove_and_reset_id</dd>
                <dd id="NEBjob.kill" class="function">kill</dd>
                <dd id="NEBjob.check_setup" class="function">check_setup</dd>
                <dd id="NEBjob.reset_job_id" class="function">reset_job_id</dd>
                <dd id="NEBjob.run" class="function">run</dd>
                <dd id="NEBjob.run_if_modal" class="function">run_if_modal</dd>
                <dd id="NEBjob.run_static" class="function">run_static</dd>
                <dd id="NEBjob.run_if_scheduler" class="function">run_if_scheduler</dd>
                <dd id="NEBjob.transfer_from_remote" class="function">transfer_from_remote</dd>
                <dd id="NEBjob.send_to_database" class="function">send_to_database</dd>
                <dd id="NEBjob.create_job" class="function">create_job</dd>
                <dd id="NEBjob.update_master" class="function">update_master</dd>
                <dd id="NEBjob.job_file_name" class="function">job_file_name</dd>
                <dd id="NEBjob.from_hdf_args" class="function">from_hdf_args</dd>
                <dd id="NEBjob.signal_intercept" class="function">signal_intercept</dd>
                <dd id="NEBjob.drop_status_to_aborted" class="function">drop_status_to_aborted</dd>
                <dd id="NEBjob.run_if_refresh" class="function">run_if_refresh</dd>
                <dd id="NEBjob.run_time_to_db" class="function">run_time_to_db</dd>

            </div>
            <div><dt>pyiron_base.jobs.job.core.JobCore</dt>
                                <dd id="NEBjob.content" class="variable">content</dd>
                <dd id="NEBjob.files" class="variable">files</dd>
                <dd id="NEBjob.job_name" class="variable">job_name</dd>
                <dd id="NEBjob.name" class="variable">name</dd>
                <dd id="NEBjob.status" class="variable">status</dd>
                <dd id="NEBjob.job_id" class="variable">job_id</dd>
                <dd id="NEBjob.id" class="variable">id</dd>
                <dd id="NEBjob.database_entry" class="variable">database_entry</dd>
                <dd id="NEBjob.parent_id" class="variable">parent_id</dd>
                <dd id="NEBjob.master_id" class="variable">master_id</dd>
                <dd id="NEBjob.child_ids" class="variable">child_ids</dd>
                <dd id="NEBjob.project_hdf5" class="variable">project_hdf5</dd>
                <dd id="NEBjob.files_to_compress" class="variable">files_to_compress</dd>
                <dd id="NEBjob.files_to_remove" class="variable">files_to_remove</dd>
                <dd id="NEBjob.relocate_hdf5" class="function">relocate_hdf5</dd>
                <dd id="NEBjob.project" class="variable">project</dd>
                <dd id="NEBjob.job_info_str" class="variable">job_info_str</dd>
                <dd id="NEBjob.path" class="variable">path</dd>
                <dd id="NEBjob.check_if_job_exists" class="function">check_if_job_exists</dd>
                <dd id="NEBjob.show_hdf" class="function">show_hdf</dd>
                <dd id="NEBjob.get_from_table" class="function">get_from_table</dd>
                <dd id="NEBjob.to_object" class="function">to_object</dd>
                <dd id="NEBjob.get" class="function">get</dd>
                <dd id="NEBjob.load" class="function">load</dd>
                <dd id="NEBjob.inspect" class="function">inspect</dd>
                <dd id="NEBjob.is_master_id" class="function">is_master_id</dd>
                <dd id="NEBjob.get_job_id" class="function">get_job_id</dd>
                <dd id="NEBjob.list_files" class="function">list_files</dd>
                <dd id="NEBjob.list_childs" class="function">list_childs</dd>
                <dd id="NEBjob.move_to" class="function">move_to</dd>
                <dd id="NEBjob.rename" class="function">rename</dd>
                <dd id="NEBjob.decompress" class="function">decompress</dd>
                <dd id="NEBjob.is_compressed" class="function">is_compressed</dd>
                <dd id="NEBjob.self_archive" class="function">self_archive</dd>
                <dd id="NEBjob.self_unarchive" class="function">self_unarchive</dd>
                <dd id="NEBjob.is_self_archived" class="function">is_self_archived</dd>

            </div>
            <div><dt>pyiron_base.interfaces.has_groups.HasGroups</dt>
                                <dd id="NEBjob.list_groups" class="function">list_groups</dd>
                <dd id="NEBjob.list_nodes" class="function">list_nodes</dd>
                <dd id="NEBjob.list_all" class="function">list_all</dd>

            </div>
            <div><dt>pyiron_atomistics.atomistics.structure.has_structure.HasStructure</dt>
                                <dd id="NEBjob.get_structure" class="function">get_structure</dd>
                <dd id="NEBjob.number_of_structures" class="variable">number_of_structures</dd>
                <dd id="NEBjob.iter_structures" class="function">iter_structures</dd>
                <dd id="NEBjob.transform_structures" class="function">transform_structures</dd>
                <dd id="NEBjob.collect_structures" class="function">collect_structures</dd>
                <dd id="NEBjob.animate_structures" class="function">animate_structures</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>